import{r as o,a as dn,R as un}from"./react-b1791c80.js";import{C as _r,X as gr,G as Hr,I as fn,a as hn,W as mn,A as pn,S as Nr,F as bn,Z as xr,b as gn,P as xn,c as yn,U as wn,D as vn,d as Vr,E as Mn,e as Cn,B as kn,f as er,g as Ur,h as Sn,R as Nn,i as zn,L as Pn,j as Tn,k as Jr,l as Rn,m as qt,n as En,o as qr,p as In,q as Wr,r as $n,s as Ln,M as Fn,t as Mr,u as Er,v as Kr,w as Zr,x as Qr,T as Dn,y as Bn,z as Gn,H as On,J as An,K as jn,N as Xn,O as Yn,Q as _n,V as Ir,Y as Hn,_ as Vn,$ as Un,a0 as Jn,a1 as qn,a2 as $r,a3 as Lr,a4 as en,a5 as Wn}from"./lucide-bd8faf6f.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))i(h);new MutationObserver(h=>{for(const a of h)if(a.type==="childList")for(const $ of a.addedNodes)$.tagName==="LINK"&&$.rel==="modulepreload"&&i($)}).observe(document,{childList:!0,subtree:!0});function w(h){const a={};return h.integrity&&(a.integrity=h.integrity),h.referrerPolicy&&(a.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?a.credentials="include":h.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(h){if(h.ep)return;h.ep=!0;const a=w(h);fetch(h.href,a)}})();var tn={exports:{}},yr={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kn=o,Zn=Symbol.for("react.element"),Qn=Symbol.for("react.fragment"),ea=Object.prototype.hasOwnProperty,ta=Kn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ra={key:!0,ref:!0,__self:!0,__source:!0};function rn(e,l,w){var i,h={},a=null,$=null;w!==void 0&&(a=""+w),l.key!==void 0&&(a=""+l.key),l.ref!==void 0&&($=l.ref);for(i in l)ea.call(l,i)&&!ra.hasOwnProperty(i)&&(h[i]=l[i]);if(e&&e.defaultProps)for(i in l=e.defaultProps,l)h[i]===void 0&&(h[i]=l[i]);return{$$typeof:Zn,type:e,key:a,ref:$,props:h,_owner:ta.current}}yr.Fragment=Qn;yr.jsx=rn;yr.jsxs=rn;tn.exports=yr;var Pr=tn.exports;const br=Pr.Fragment,t=Pr.jsx,u=Pr.jsxs;var zr={},Fr=dn;zr.createRoot=Fr.createRoot,zr.hydrateRoot=Fr.hydrateRoot;const na=["Standard","Kodak 2383","Kodak Portra 400","Kodak Ektar 100","Cinestill 800T","Fuji Velvia 50","Ilford HP5 Plus"],aa=({settings:e,onChange:l,washTemp:w,onWashChange:i,washIntensity:h,onWashIntensityChange:a,onUploadTexture:$,isOpen:j,onClose:Y,isMobile:R,onExport:B})=>{const[U,te]=o.useState(null),Q=v=>{te(U===v?null:v)},F=(v,m)=>{l(v==="skyEnabled"&&m===!0?{...e,skyEnabled:!0,useTexture:!1}:v==="useTexture"&&m===!0?{...e,useTexture:!0,skyEnabled:!1}:{...e,[v]:m})},ee=(v,m,L,he,oe,Ee,Fe="accent-zinc-400")=>u("div",{className:"space-y-1",children:[u("div",{className:"flex justify-between text-[9px] text-zinc-300 font-bold uppercase tracking-wider",children:[t("span",{children:v}),t("span",{className:"text-zinc-400 font-mono",children:Math.abs(m)<1&&m!==0?m.toFixed(2):Math.round(m)})]}),t("input",{type:"range",min:L,max:he,step:oe,value:m,onChange:ze=>Ee(Number(ze.target.value)),className:`w-full h-1 bg-zinc-700/50 rounded-full appearance-none cursor-pointer ${Fe}`})]}),D=({icon:v,active:m,onClick:L,color:he="text-zinc-400",label:oe})=>t("button",{onClick:L,title:oe,className:`p-2.5 rounded-full transition-all duration-200 group relative ${m?"bg-white/10 text-zinc-100 shadow-sm shadow-white/5 ring-1 ring-white/10":"bg-transparent text-zinc-500 hover:bg-white/5 hover:text-zinc-200"}`,children:t(v,{className:`w-4 h-4 ${m?"text-zinc-100":he}`,strokeWidth:m?2.5:1.5})}),O=()=>{switch(U){case"export":return u("div",{className:"grid grid-cols-1 gap-2",children:[t("button",{onClick:()=>B(!1),className:"h-8 bg-zinc-800/40 hover:bg-zinc-800/60 border border-white/10 hover:border-white/20 rounded-lg flex items-center justify-center gap-2 transition-all text-zinc-300",children:t("span",{className:"text-[9px] font-bold uppercase tracking-widest",children:"Standard PNG"})}),t("button",{onClick:()=>B(!0),className:"h-8 bg-indigo-500/20 hover:bg-indigo-500/30 border border-indigo-500/30 hover:border-indigo-500/50 rounded-lg flex items-center justify-center gap-2 transition-all text-indigo-300",children:t("span",{className:"text-[9px] font-bold uppercase tracking-widest",children:"4K High-Res"})})]});case"atmosphere":return u("div",{className:"space-y-4",children:[u("div",{className:"flex items-center justify-between",children:[t("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest",children:"Enable Sky"}),t("button",{onClick:()=>F("skyEnabled",!e.skyEnabled),className:`w-7 h-3.5 rounded-full p-0.5 transition-colors ${e.skyEnabled?"bg-orange-500":"bg-zinc-700"}`,children:t("div",{className:`w-2.5 h-2.5 rounded-full bg-white shadow-sm transition-transform duration-300 ${e.skyEnabled?"translate-x-3.5":"translate-x-0"}`})})]}),u("div",{className:`space-y-3 transition-opacity ${e.skyEnabled?"":"opacity-30 pointer-events-none"}`,children:[ee("Time",e.sunElevation,-.3,1,.01,v=>F("sunElevation",v),"accent-orange-500"),ee("Azimuth",e.sunAzimuth,0,1,.01,v=>F("sunAzimuth",v),"accent-orange-500"),ee("Density",e.atmosphereDensity,0,1,.01,v=>F("atmosphereDensity",v)),ee("Haze",e.gradientHumidity,0,1,.01,v=>F("gradientHumidity",v)),ee("Glow",e.sunDiffusion,0,1,.01,v=>F("sunDiffusion",v)),ee("Scale",e.skyScale,.5,3,.1,v=>F("skyScale",v))]})]});case"water":return u("div",{className:"space-y-4",children:[u("div",{className:"flex items-center justify-between",children:[t("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest",children:"Enable Water"}),t("button",{onClick:()=>F("waterEnabled",!e.waterEnabled),className:`w-7 h-3.5 rounded-full p-0.5 transition-colors ${e.waterEnabled?"bg-cyan-500":"bg-zinc-700"}`,children:t("div",{className:`w-2.5 h-2.5 rounded-full bg-white shadow-sm transition-transform duration-300 ${e.waterEnabled?"translate-x-3.5":"translate-x-0"}`})})]}),u("div",{className:`space-y-3 transition-opacity ${e.waterEnabled?"":"opacity-30 pointer-events-none"}`,children:[u("div",{className:"flex justify-between items-center",children:[t("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-wider",children:"Reflections"}),t("button",{onClick:()=>F("waterLayerReflections",!e.waterLayerReflections),className:`w-6 h-3 rounded-full relative ${e.waterLayerReflections?"bg-cyan-500/50":"bg-zinc-800"}`,children:t("div",{className:`w-2 h-2 bg-white rounded-full absolute top-0.5 transition-all ${e.waterLayerReflections?"left-[14px]":"left-0.5"}`})})]}),ee("Opacity",e.waterOpacity,0,1,.01,v=>F("waterOpacity",v),"accent-cyan-500"),ee("Turbulence X",e.waterTurbulenceX,0,1,.01,v=>F("waterTurbulenceX",v),"accent-cyan-500"),ee("Turbulence Y",e.waterTurbulenceY,0,1,.01,v=>F("waterTurbulenceY",v),"accent-cyan-500")]})]});case"lens":return u("div",{className:"space-y-4",children:[u("div",{className:"flex items-center justify-between",children:[t("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest",children:"Enable Flare"}),t("button",{onClick:()=>F("lensFlareEnabled",!e.lensFlareEnabled),className:`w-7 h-3.5 rounded-full p-0.5 transition-colors ${e.lensFlareEnabled?"bg-pink-500":"bg-zinc-700"}`,children:t("div",{className:`w-2.5 h-2.5 rounded-full bg-white shadow-sm transition-transform duration-300 ${e.lensFlareEnabled?"translate-x-3.5":"translate-x-0"}`})})]}),u("div",{className:`space-y-3 transition-opacity ${e.lensFlareEnabled?"":"opacity-30 pointer-events-none"}`,children:[ee("Intensity",e.lensFlareIntensity,0,1,.01,v=>F("lensFlareIntensity",v),"accent-pink-500"),ee("Scale",e.lensFlareScale,.1,3,.1,v=>F("lensFlareScale",v),"accent-pink-500"),u("div",{className:"flex justify-between items-center bg-zinc-800/30 p-2 rounded-lg",children:[t("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-wider",children:"Manual Handle"}),t("button",{onClick:()=>F("lensFlareHandleEnabled",!e.lensFlareHandleEnabled),className:`w-6 h-3 rounded-full relative ${e.lensFlareHandleEnabled?"bg-pink-500/50":"bg-zinc-800"}`,children:t("div",{className:`w-2 h-2 bg-white rounded-full absolute top-0.5 transition-all ${e.lensFlareHandleEnabled?"left-[14px]":"left-0.5"}`})})]})]})]});case"base":return u("div",{className:"space-y-4",children:[u("div",{className:"flex items-center justify-between",children:[t("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest",children:"Paper Texture"}),u("div",{className:"flex gap-2",children:[t("button",{onClick:()=>F("useTexture",!e.useTexture),className:`p-1.5 rounded-lg border ${e.useTexture?"bg-amber-900/20 border-amber-500/20 text-amber-500":"border-transparent text-zinc-600"}`,children:t(yn,{className:"w-3.5 h-3.5"})}),u("label",{className:"cursor-pointer p-1.5 text-zinc-600 hover:text-zinc-300 rounded-lg hover:bg-white/5",children:[t(wn,{className:"w-3.5 h-3.5"}),t("input",{type:"file",className:"hidden",onChange:$,accept:"image/*"})]})]})]}),t("div",{className:"h-px bg-white/10 w-full"}),ee("Wash Temp",w,0,1,.01,v=>i(v)),ee("Wash Strength",h,0,1,.01,v=>a(v))]});case"film":return u("div",{className:"space-y-4",children:[u("div",{className:"flex items-center justify-between mb-2",children:[t("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest",children:"Enable"}),t("button",{onClick:()=>F("filmEnabled",!e.filmEnabled),className:`w-7 h-3.5 rounded-full p-0.5 transition-colors ${e.filmEnabled?"bg-red-500":"bg-zinc-700"}`,children:t("div",{className:`w-2.5 h-2.5 rounded-full bg-white shadow-sm transition-transform duration-300 ${e.filmEnabled?"translate-x-3.5":"translate-x-0"}`})})]}),u("div",{className:`space-y-3 transition-opacity ${e.filmEnabled?"":"opacity-30 pointer-events-none"}`,children:[t("div",{className:"bg-zinc-800/40 p-1.5 rounded-lg border border-white/5",children:t("select",{value:e.filmStock,onChange:v=>F("filmStock",v.target.value),className:"w-full bg-transparent text-[9px] font-bold uppercase text-zinc-300 outline-none",children:na.map(v=>t("option",{value:v,children:v},v))})}),ee("Density",e.filmDensity,0,1,.01,v=>F("filmDensity",v),"accent-red-500"),ee("Halation",e.filmHalation,0,1,.01,v=>F("filmHalation",v)),ee("Bloom",e.filmBloom,0,1,.01,v=>F("filmBloom",v)),ee("Grain",e.filmGrain,0,1,.01,v=>F("filmGrain",v))]})]});case"fx":return u("div",{className:"space-y-4",children:[u("div",{className:"space-y-3",children:[u("div",{className:"flex items-center justify-between",children:[u("div",{className:"flex items-center gap-2",children:[t(gn,{className:"w-3 h-3 text-yellow-200"}),t("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest",children:"Soft Focus"})]}),t("button",{onClick:()=>F("pictorialismEnabled",!e.pictorialismEnabled),className:`w-7 h-3.5 rounded-full p-0.5 transition-colors ${e.pictorialismEnabled?"bg-yellow-200":"bg-zinc-700"}`,children:t("div",{className:`w-2.5 h-2.5 rounded-full bg-zinc-900 shadow-sm transition-transform duration-300 ${e.pictorialismEnabled?"translate-x-3.5":"translate-x-0"}`})})]}),e.pictorialismEnabled&&u("div",{className:"space-y-2 pl-2 border-l border-white/5",children:[ee("Diffusion",e.pictorialismSoftness,0,1,.01,v=>F("pictorialismSoftness",v),"accent-yellow-200"),ee("Grain",e.pictorialismNoise,0,1,.01,v=>F("pictorialismNoise",v),"accent-yellow-200")]})]}),t("div",{className:"h-px bg-white/10 w-full"}),u("div",{className:"space-y-3",children:[u("div",{className:"flex items-center justify-between",children:[u("div",{className:"flex items-center gap-2",children:[t(xn,{className:"w-3 h-3 text-emerald-400"}),t("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest",children:"Riso Print"})]}),t("button",{onClick:()=>F("risoEnabled",!e.risoEnabled),className:`w-7 h-3.5 rounded-full p-0.5 transition-colors ${e.risoEnabled?"bg-emerald-500":"bg-zinc-700"}`,children:t("div",{className:`w-2.5 h-2.5 rounded-full bg-white shadow-sm transition-transform duration-300 ${e.risoEnabled?"translate-x-3.5":"translate-x-0"}`})})]}),e.risoEnabled&&u("div",{className:"space-y-2 pl-2 border-l border-white/5",children:[ee("Dot Scale",e.risoGrainScale,.2,2,.1,v=>F("risoGrainScale",v),"accent-emerald-400"),u("div",{className:"flex gap-2",children:[t("input",{type:"color",value:e.risoColor1,onChange:v=>F("risoColor1",v.target.value),className:"w-full h-5 rounded cursor-pointer bg-transparent"}),t("input",{type:"color",value:e.risoColor2,onChange:v=>F("risoColor2",v.target.value),className:"w-full h-5 rounded cursor-pointer bg-transparent"})]})]})]}),t("div",{className:"h-px bg-white/10 w-full"}),u("div",{className:"space-y-3",children:[u("div",{className:"flex items-center justify-between",children:[u("div",{className:"flex items-center gap-2",children:[t(xr,{className:"w-3 h-3 text-fuchsia-400"}),t("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest",children:"Aberration"})]}),t("button",{onClick:()=>F("chromaticAberrationEnabled",!e.chromaticAberrationEnabled),className:`w-7 h-3.5 rounded-full p-0.5 transition-colors ${e.chromaticAberrationEnabled?"bg-fuchsia-500":"bg-zinc-700"}`,children:t("div",{className:`w-2.5 h-2.5 rounded-full bg-white shadow-sm transition-transform duration-300 ${e.chromaticAberrationEnabled?"translate-x-3.5":"translate-x-0"}`})})]}),e.chromaticAberrationEnabled&&t("div",{className:"pl-2 border-l border-white/5",children:ee("Shift",e.chromaticAberrationIntensity,0,1,.01,v=>F("chromaticAberrationIntensity",v),"accent-fuchsia-500")})]})]});default:return null}};return!j&&!R?null:t("div",{className:`fixed z-40 right-4 top-1/2 -translate-y-1/2 transition-transform duration-300 ${R?j?"translate-x-0":"translate-x-[200%]":""}`,children:t("div",{className:"pointer-events-auto bg-black/60 backdrop-blur-md border border-white/10 shadow-2xl ring-1 ring-black/20 transition-all duration-300 ease-spring overflow-hidden flex flex-col",style:{...U?{width:"200px",borderRadius:"20px"}:{width:"56px",borderRadius:"9999px"},maxHeight:"75vh"},children:U?u("div",{className:"flex flex-col h-full w-full animate-in fade-in slide-in-from-right-4 duration-200",children:[u("div",{className:"flex items-center justify-between p-3 border-b border-white/10 bg-white/5 shrink-0",children:[u("button",{onClick:()=>te(null),className:"flex items-center gap-1.5 text-zinc-400 hover:text-white transition-colors",children:[t(_r,{className:"w-3.5 h-3.5"}),t("span",{className:"text-[10px] font-bold uppercase tracking-widest",children:U})]}),t("button",{onClick:()=>te(null),className:"text-zinc-500 hover:text-white",children:t(gr,{className:"w-3.5 h-3.5"})})]}),t("div",{className:"p-3 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-700",children:O()})]}):u("div",{className:"flex flex-col gap-3 items-center py-4 px-1.5 w-full animate-in fade-in slide-in-from-left-4 duration-200",children:[t("div",{className:"text-zinc-500 cursor-grab active:cursor-grabbing",children:t(Hr,{className:"w-3.5 h-3.5"})}),t("div",{className:"flex flex-col gap-1 w-full items-center group relative",title:"Wash Temp",children:t("div",{className:"h-[50px] w-6 flex items-center justify-center relative",children:t("input",{type:"range",min:"0",max:"1",step:"0.01",value:w,onChange:v=>i(Number(v.target.value)),className:"appearance-none bg-zinc-700/60 rounded-lg cursor-pointer accent-orange-400 absolute",style:{width:"50px",height:"3px",transform:"rotate(-90deg)",transformOrigin:"center"}})})}),t("div",{className:"flex flex-col gap-1 w-full items-center group relative",title:"Wash Strength",children:t("div",{className:"h-[50px] w-6 flex items-center justify-center relative",children:t("input",{type:"range",min:"0",max:"1",step:"0.01",value:h,onChange:v=>a(Number(v.target.value)),className:"appearance-none bg-zinc-700/60 rounded-lg cursor-pointer accent-cyan-400 absolute",style:{width:"50px",height:"3px",transform:"rotate(-90deg)",transformOrigin:"center"}})})}),t("div",{className:"w-6 h-px bg-white/10 shrink-0"}),u("div",{className:"flex flex-col gap-1.5 w-full items-center",children:[t(D,{icon:fn,active:U==="export",onClick:()=>Q("export"),label:"Export"}),t(D,{icon:hn,active:U==="atmosphere",onClick:()=>Q("atmosphere"),color:"text-orange-400",label:"Atmosphere"}),t(D,{icon:mn,active:U==="water",onClick:()=>Q("water"),color:"text-cyan-400",label:"Water"}),t(D,{icon:pn,active:U==="lens",onClick:()=>Q("lens"),color:"text-pink-400",label:"Lens"}),t(D,{icon:Nr,active:U==="base",onClick:()=>Q("base"),label:"Canvas"}),t(D,{icon:bn,active:U==="film",onClick:()=>Q("film"),color:"text-red-400",label:"Film"}),t(D,{icon:xr,active:U==="fx",onClick:()=>Q("fx"),color:"text-purple-400",label:"FX"}),R&&u(br,{children:[t("div",{className:"w-6 h-px bg-white/10 shrink-0"}),t("button",{onClick:Y,className:"p-2 text-zinc-500 hover:text-white",children:t(gr,{className:"w-4 h-4"})})]})]})]})})})},nn=(e,l,w)=>{const i=document.createElement("canvas"),h=document.createElement("canvas");if(l<=0||w<=0)return i.width=1,i.height=1,h.width=1,h.height=1,{visual:i,heightMap:h};i.width=l,i.height=w;const a=i.getContext("2d");h.width=l,h.height=w;const $=h.getContext("2d");if(!a||!$)return{visual:i,heightMap:h};a.fillStyle="#ffffff",a.fillRect(0,0,l,w),a.drawImage(e,0,0,l,w);const j=a.getImageData(0,0,l,w),Y=$.createImageData(l,w),R=j.data,B=Y.data,U=R.length;for(let te=0;te<U;te+=4){const Q=R[te],F=R[te+1],ee=R[te+2],D=(.299*Q+.587*F+.114*ee)/255;R[te]=Q,R[te+1]=F,R[te+2]=ee,R[te+3]=255;let O=1-D;O<.02?O=0:O=Math.pow(O,3)*64,O=Math.min(1,Math.max(0,O));const ge=Math.floor(O*255);B[te]=0,B[te+1]=0,B[te+2]=0,B[te+3]=ge}return a.putImageData(j,0,0),$.putImageData(Y,0,0),{visual:i,heightMap:h}},oa=(e,l)=>{if(e<=0||l<=0){const B=document.createElement("canvas");return B.width=1,B.height=1,Promise.resolve({visual:B,heightMap:B})}const w=document.createElement("canvas");w.width=e,w.height=l;const i=w.getContext("2d");if(!i)return Promise.resolve({visual:w,heightMap:w});i.fillStyle="#ffffff",i.fillRect(0,0,e,l);const h=.4,a=e*l*h/10;for(let B=0;B<a;B++){const U=Math.random()*e,te=Math.random()*l,Q=1.5+Math.random()*2.5,F=230+Math.random()*25;i.beginPath(),i.ellipse(U,te,Q,Q*(.7+Math.random()*.6),Math.random()*Math.PI,0,Math.PI*2),i.fillStyle=`rgba(${F}, ${F}, ${F}, 0.5)`,i.fill()}const $=i.getImageData(0,0,e,l),j=$.data;for(let B=0;B<j.length;B+=4)if(Math.random()<.03){const te=j[B]*.9;j[B]=te,j[B+1]=te,j[B+2]=te}i.putImageData($,0,0),i.globalCompositeOperation="multiply";const Y=600;for(let B=0;B<Y;B++){const U=Math.random()*e,te=Math.random()*l,Q=Math.random()>.7,F=1+Math.random()*2;i.beginPath(),Q?i.ellipse(U,te,F*3,F*.2,Math.random()*Math.PI,0,Math.PI*2):i.arc(U,te,F*.5,0,Math.PI*2),i.fillStyle=`rgba(0,0,0, ${.02+Math.random()*.04})`,i.fill()}i.globalCompositeOperation="source-over",i.filter="blur(1.2px)",i.drawImage(w,0,0),i.filter="none";const R=new Image;return R.src=w.toDataURL(),new Promise(B=>{R.onload=()=>{B(nn(R,e,l))}})},Dr=e=>{const l=e.getContext("2d");l&&l.clearRect(0,0,e.width,e.height)},Ct=e=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return l?{r:parseInt(l[1],16),g:parseInt(l[2],16),b:parseInt(l[3],16)}:{r:0,g:0,b:0}},at=(e,l,w)=>({r:Math.round(e.r+(l.r-e.r)*w),g:Math.round(e.g+(l.g-e.g)*w),b:Math.round(e.b+(l.b-e.b)*w)}),la=(e,l,w)=>{let i=1-e.r/255,h=1-e.g/255,a=1-e.b/255,$=Math.min(i,Math.min(h,a));$<1?(i=(i-$)/(1-$),h=(h-$)/(1-$),a=(a-$)/(1-$)):(i=0,h=0,a=0);let j=1-l.r/255,Y=1-l.g/255,R=1-l.b/255,B=Math.min(j,Math.min(Y,R));B<1?(j=(j-B)/(1-B),Y=(Y-B)/(1-B),R=(R-B)/(1-B)):(j=0,Y=0,R=0);const U=i+(j-i)*w,te=h+(Y-h)*w,Q=a+(R-a)*w,F=$+(B-$)*w;e.r=255*(1-U)*(1-F),e.g=255*(1-te)*(1-F),e.b=255*(1-Q)*(1-F)},Cr=e=>{const l=e/255;return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)},kr=e=>{const l=e<=.0031308?12.92*e:1.055*Math.pow(e,.4166666666666667)-.055;return Math.max(0,Math.min(255,l*255))},Br=(e,l,w)=>{const i=Cr(e),h=Cr(l),a=Cr(w),$=.4122214708*i+.5363325363*h+.0514459929*a,j=.2119034982*i+.6806995451*h+.1073969566*a,Y=.0883024619*i+.2817188376*h+.6299787005*a,R=Math.cbrt($),B=Math.cbrt(j),U=Math.cbrt(Y);return{L:.2104542553*R+.793617785*B-.0040720468*U,a:1.9779984951*R-2.428592205*B+.4505937099*U,b:.0259040371*R+.7827717662*B-.808675766*U}},ia=(e,l,w)=>{const i=e+.3963377774*l+.2158037573*w,h=e-.1055613458*l-.0638541728*w,a=e-.0894841775*l-1.291485548*w,$=i*i*i,j=h*h*h,Y=a*a*a;return{r:kr(4.0766*$-3.3077*j+.2309*Y),g:kr(-1.2684*$+2.6097*j-.3413*Y),b:kr(-.0041*$-.7034*j+1.7076*Y)}},Gr=(e,l,w)=>{const i=Br(e.r,e.g,e.b),h=Br(l.r,l.g,l.b),a=i.L+(h.L-i.L)*w,$=i.a+(h.a-i.a)*w,j=i.b+(h.b-i.b)*w,Y=ia(a,$,j);e.r=Y.r,e.g=Y.g,e.b=Y.b},tr=(e,l,w)=>"#"+((1<<24)+(e<<16)+(l<<8)+w).toString(16).slice(1),Tt=e=>`rgb(${e.r}, ${e.g}, ${e.b})`,lr=(e,l,w,i)=>{const h=e.r/255,a=e.g/255,$=e.b/255,j=Math.max(h,a,$),Y=Math.min(h,a,$);let R=0,B=0,U=(j+Y)/2;if(j!==Y){const ee=j-Y;switch(B=U>.5?ee/(2-j-Y):ee/(j+Y),j){case h:R=(a-$)/ee+(a<$?6:0);break;case a:R=($-h)/ee+2;break;case $:R=(h-a)/ee+4;break}R/=6}R=(R+l/360)%1,R<0&&(R+=1),B=Math.max(0,Math.min(1,B+w)),U=Math.max(0,Math.min(1,U+i));let te,Q,F;if(B===0)te=Q=F=U;else{const ee=(ge,v,m)=>(m<0&&(m+=1),m>1&&(m-=1),m<.16666666666666666?ge+(v-ge)*6*m:m<.5?v:m<.6666666666666666?ge+(v-ge)*(.6666666666666666-m)*6:ge),D=U<.5?U*(1+B):U+B-U*B,O=2*U-D;te=ee(O,D,R+1/3),Q=ee(O,D,R),F=ee(O,D,R-1/3)}return{r:Math.round(te*255),g:Math.round(Q*255),b:Math.round(F*255)}},an=(e,l,w)=>{e/=255,l/=255,w/=255;const i=Math.max(e,l,w),h=Math.min(e,l,w);let a=0,$,j=i;const Y=i-h;if($=i===0?0:Y/i,i===h)a=0;else{switch(i){case e:a=(l-w)/Y+(l<w?6:0);break;case l:a=(w-e)/Y+2;break;case w:a=(e-l)/Y+4;break}a/=6}return{h:a*360,s:$,v:j}},Sr=e=>{let{r:l,g:w,b:i}=Ct(e);return an(l,w,i)},ur=(e,l,w)=>{let i=0,h=0,a=0;const $=Math.floor(e/60),j=e/60-$,Y=w*(1-l),R=w*(1-j*l),B=w*(1-(1-j)*l);switch($%6){case 0:i=w,h=B,a=Y;break;case 1:i=R,h=w,a=Y;break;case 2:i=Y,h=w,a=B;break;case 3:i=Y,h=R,a=w;break;case 4:i=B,h=Y,a=w;break;case 5:i=w,h=Y,a=R;break}return tr(Math.round(i*255),Math.round(h*255),Math.round(a*255))},ir={r:255,g:160,b:60},sr={r:40,g:70,b:110},sa=150*1024*1024,le={day:{zenith:{r:25,g:70,b:160},upper:{r:70,g:130,b:210},ozone:{r:110,g:170,b:230},glow:{r:180,g:210,b:240},horizon:{r:210,g:235,b:255},sun:{r:255,g:255,b:245}},golden:{zenith:{r:30,g:60,b:130},upper:{r:70,g:100,b:180},ozone:{r:140,g:150,b:200},glow:{r:255,g:180,b:100},horizon:{r:255,g:200,b:50},sun:{r:255,g:240,b:210}},sunset:{zenith:{r:30,g:42,b:58},upper:{r:65,g:80,b:100},ozone:{r:110,g:100,b:100},glow:{r:180,g:90,b:50},horizon:{r:130,g:50,b:20},sun:{r:255,g:200,b:140}},civil_twilight:{zenith:{r:15,g:25,b:40},upper:{r:40,g:50,b:70},ozone:{r:80,g:60,b:65},glow:{r:120,g:50,b:30},horizon:{r:60,g:25,b:10},sun:{r:255,g:50,b:50}},nautical_twilight:{zenith:{r:5,g:8,b:25},upper:{r:15,g:20,b:50},ozone:{r:30,g:35,b:70},glow:{r:60,g:50,b:80},horizon:{r:20,g:15,b:30},sun:{r:50,g:10,b:10}},night:{zenith:{r:0,g:1,b:8},upper:{r:1,g:3,b:15},ozone:{r:5,g:8,b:20},glow:{r:8,g:12,b:25},horizon:{r:10,g:15,b:30},sun:{r:0,g:0,b:0}}},ca=(e,l,w)=>{const i=(m,L,he)=>at(m,L,he);let h,a,$,j,Y,R,B,U=1;if(e>.2){const m=Math.max(0,Math.min(1,(e-.2)/.8));h=i(le.golden.zenith,le.day.zenith,m),a=i(le.golden.upper,le.day.upper,m),$=i(le.golden.ozone,le.day.ozone,m),j=i(le.golden.glow,le.day.glow,m),Y=i(le.golden.horizon,le.day.horizon,m),R=i(le.golden.sun,le.day.sun,m),B={r:255,g:255,b:255},U=2}else if(e>0){const m=e/.2;h=i(le.sunset.zenith,le.golden.zenith,m),a=i(le.sunset.upper,le.golden.upper,m),$=i(le.sunset.ozone,le.golden.ozone,m),j=i(le.sunset.glow,le.golden.glow,m),Y=i(le.sunset.horizon,le.golden.horizon,m),R=i(le.sunset.sun,le.golden.sun,m),B={r:255,g:200,b:150},U=4}else if(e>-.06){const m=(e- -.06)/.06;h=i(le.civil_twilight.zenith,le.sunset.zenith,m),a=i(le.civil_twilight.upper,le.sunset.upper,m),$=i(le.civil_twilight.ozone,le.sunset.ozone,m),j=i(le.civil_twilight.glow,le.sunset.glow,m),Y=i(le.civil_twilight.horizon,le.sunset.horizon,m),R=i(le.civil_twilight.sun,le.sunset.sun,m),B={r:255,g:100,b:50},U=3}else if(e>-.12){const m=(e- -.12)/.06;h=i(le.nautical_twilight.zenith,le.civil_twilight.zenith,m),a=i(le.nautical_twilight.upper,le.civil_twilight.upper,m),$=i(le.nautical_twilight.ozone,le.civil_twilight.ozone,m),j=i(le.nautical_twilight.glow,le.civil_twilight.glow,m),Y=i(le.nautical_twilight.horizon,le.civil_twilight.horizon,m),R=i(le.nautical_twilight.sun,le.civil_twilight.sun,m),B={r:100,g:50,b:100},U=1}else{const m=Math.max(0,Math.min(1,(e- -.25)/.13));h=i(le.night.zenith,le.nautical_twilight.zenith,m),a=i(le.night.upper,le.nautical_twilight.upper,m),$=i(le.night.ozone,le.nautical_twilight.ozone,m),j=i(le.night.glow,le.nautical_twilight.glow,m),Y=i(le.night.horizon,le.nautical_twilight.horizon,m),R={r:0,g:0,b:0},B={r:0,g:0,b:0},U=0}const te=.15,Q=l<te?(te-l)/te:0,F=Math.min(1,l*1.5),ee={r:135,g:206,b:250},D=Math.max(0,Math.min(1,e+.3)),O=Math.pow(F,.5)*D*.5;if(e>.1)h=i(h,ee,O*.4),a=i(a,ee,O*.3),$=i($,ee,O*.2);else{const m={r:50,g:60,b:80};h=i(h,m,O*.2),a=i(a,m,O*.2)}if(Q>0){const m={r:5,g:10,b:25};h=i(h,m,Q),a=i(a,m,Q*.9),$=i($,m,Q*.7),j=i(j,m,Q*.8),Y=i(Y,m,Q*.6)}const ge={r:215,g:225,b:235},v=w*.6+Math.max(0,l-.5)*.5;return Y=i(Y,ge,v*.3),j=i(j,ge,v*.2),v>.2&&e>-.1&&($=i($,j,v*.3)),{zenith:h,upper:a,ozone:$,glow:j,horizon:Y,sunColor:R,bloomColor:B,bloomSizeMult:U}},Or=(e,l,w)=>{const i=255-(255-e.r)*(255-l.r)/255,h=255-(255-e.g)*(255-l.g)/255,a=255-(255-e.b)*(255-l.b)/255;return at(e,{r:i,g:h,b:a},w)},da=(e,l,w)=>{const i=(j,Y)=>{if(j===0)return 0;if(Y===255)return 255;const R=j*255/(255-Y);return Math.min(255,R)},h=i(e.r,l.r),a=i(e.g,l.g),$=i(e.b,l.b);return at(e,{r:h,g:a,b:$},w)},ua=(e,l,w,i,h=1)=>{const a=o.useRef({layerCanvases:new Map,mask:null,temp:null,composite:null,heightMapPattern:null,snapshot:null,stars:null,skyState:null,skyLut:null,patternImage:null}),$=o.useRef(""),[j,Y]=o.useState([{id:"layer-1",name:"Layer 1",visible:!0,ignoreGlow:!1}]),[R,B]=o.useState("layer-1"),U=o.useRef("layer-1");o.useEffect(()=>{U.current=R},[R]);const te=o.useRef(new Map),Q=o.useRef(null),F=o.useRef(null),ee=o.useRef(l),[D,O]=o.useState({glowStyles:{},ambientStyles:{},gradeStyles:{},ambientParams:null,skyColors:null}),[ge,v]=o.useState(null),m=o.useRef(e);o.useEffect(()=>{m.current=e},[e]);const L=o.useRef({isDrawing:!1,lastPoint:{x:0,y:0,pressure:.5,tiltX:0,tiltY:0},angle:0,hasMoved:!1,paintLoad:1,bristles:[],history:[],historyIndex:-1}),he=()=>te.current.get(U.current)||null,oe=()=>a.current.layerCanvases.get(U.current)||null,Ee=o.useCallback((r,s)=>{const c=Ct(m.current.color),f=m.current.wetMode,g=[],M=!f;if(r==="pastel"||r==="pastel2"){const p=[],P=3+Math.floor(Math.random()*3);for(let b=0;b<P;b++)p.push({x:(Math.random()-.5)*1,y:(Math.random()-.5)*1,r:.15+Math.random()*.25});for(let b=0;b<60;b++){const E=Math.random()*Math.PI*2,x=Math.sqrt(Math.random()),A=x*Math.cos(E),J=x*Math.sin(E);let _=!1;for(const H of p)if(Math.hypot(A-H.x,J-H.y)<H.r){_=!0;break}_||g.push({dx:A,dy:J,length:.1,thickness:.5+Math.random()*2.5,tempBias:(Math.random()-.5)*1,hueBias:(Math.random()-.5)*1.5,feather:0,drySensitivity:Math.random(),color:{...c},hasPaint:!0,normX:A,normY:J})}}else{let y=1.5;r==="fan3"&&(y=3.5);const p=Math.floor(s*y);for(let P=0;P<p;P++){let b=0,E=0,x=1,A=1;if(r==="round"){const J=Math.pow(Math.random(),.5)*.5,_=Math.random()*Math.PI*2;b=J*Math.cos(_),E=J*Math.sin(_)*.5,A=1-J}else if(r==="fan")b=(Math.random()-.5)*1.2,E=(Math.random()-.5)*.1,x=.8+Math.random()*.4;else if(r==="fan2"){const J=(Math.random()-.5)*2.5;if(Math.abs(J)>.2&&Math.random()<.4)continue;b=J,E=(Math.random()-.5)*.1,x=.7+Math.random()*.5,A=.5+Math.random()*.8}else if(r==="fan3"){const J=(Math.random()-.5)*2;b=Math.sign(J)*Math.pow(Math.abs(J),3)*1.1,E=(Math.random()-.5)*.2,x=.6+Math.random()*.6,A=.4+Math.random()*.6}else r==="hog"?(b=(Math.random()-.5)*.8,E=(Math.random()-.5)*.4,x=.5+Math.random()*1):r==="chisel"?(b=P/p-.5,E=0,x=1,A=1.5):(b=P/p-.5,E=(Math.random()-.5)*.1);g.push({dx:b,dy:E,length:x*(.9+Math.random()*.2),thickness:A*(.8+Math.random()*.4),tempBias:Math.random()-.5+(Math.random()-.5),hueBias:(Math.random()-.5)*2,feather:(Math.random()-.5)*.5,drySensitivity:Math.random(),color:{...c},hasPaint:M})}}r!=="pastel"&&r!=="pastel2"?g.sort((y,p)=>y.dy-p.dy):g.sort(()=>Math.random()-.5),L.current.bristles=g},[e.wetMode]);o.useEffect(()=>{Ee(e.brushType,e.size)},[e.brushType,e.size,Ee]),o.useEffect(()=>{const r=Ct(e.color);L.current.bristles.forEach(s=>{e.wetMode||(s.color={...r})})},[e.color,e.wetMode]),o.useEffect(()=>{if(e.patternTexture){const r=new Image;r.src=e.patternTexture,r.onload=()=>{a.current.patternImage=r}}else a.current.patternImage=null},[e.patternTexture]);const Fe=o.useCallback(()=>{const r=`layer-${Date.now()}`;Y(s=>[...s,{id:r,name:`Layer ${s.length+1}`,visible:!0,ignoreGlow:!1}]),B(r)},[]),ze=o.useCallback(r=>{Y(s=>{if(s.length<=1)return s;const c=s.filter(f=>f.id!==r);if(U.current===r){const f=c[c.length-1];f&&B(f.id)}return c}),te.current.delete(r),a.current.layerCanvases.delete(r)},[]);o.useEffect(()=>{!j.find(s=>s.id===R)&&j.length>0&&B(j[j.length-1].id)},[j,R]);const Ce=o.useCallback(r=>{Y(s=>s.map(c=>c.id===r?{...c,visible:!c.visible}:c))},[]),qe=o.useCallback(r=>{Y(s=>s.map(c=>c.id===r?{...c,ignoreGlow:!c.ignoreGlow}:c))},[]);o.useEffect(()=>{let r=ge,s=0;if(e.isGradientMode){const ye=e.gradientTime;ye<.5?s=-.1+ye/.5*1.1:s=1-(ye-.5)/.5*1.1;const ke=i*e.skyHorizon,pe=w*.5,Te=i*.9,lt=ke-s*Te;r={x:pe,y:lt}}else if(e.skyEnabled){const ye=i*e.skyHorizon,ke=w*e.sunAzimuth,pe=i*.9,Te=ye-e.sunElevation*pe;r={x:ke,y:Te},s=e.sunElevation}if(!r){$.current!=="OFF"&&(O({glowStyles:{opacity:0},ambientStyles:{opacity:0},gradeStyles:{opacity:0},ambientParams:null,skyColors:null}),a.current.skyState=null,a.current.skyLut=null,$.current="OFF");return}const{gradientHumidity:c,sunIntensity:f,atmosphereDensity:g,sunDiffusion:M,skyHorizon:y,skyScale:p}=e,P=g??.5,b=ca(s,P,c);let E={},x={},A={opacity:0},J=null,_,H;if(e.skyEnabled){const ye=`${r.x}px`,ke=`${r.y}px`,pe=at(b.horizon,b.ozone,.5),Te=Math.min(.9,P*1.2);E={background:`radial-gradient(circle at ${ye} ${ke}, 
              rgba(${pe.r}, ${pe.g}, ${pe.b}, 0) 0%, 
              rgba(${pe.r}, ${pe.g}, ${pe.b}, ${Te*.2}) 30%, 
              rgba(${pe.r}, ${pe.g}, ${pe.b}, ${Te}) 100%
          )`,mixBlendMode:"screen",opacity:1,pointerEvents:"none"},J={type:"gradient",gradient:{x:r.x,y:r.y,stops:[{offset:0,color:`rgba(${pe.r}, ${pe.g}, ${pe.b}, 0)`},{offset:.3,color:`rgba(${pe.r}, ${pe.g}, ${pe.b}, ${Te*.2})`},{offset:1,color:`rgba(${pe.r}, ${pe.g}, ${pe.b}, ${Te})`}]},mixBlendMode:"screen",opacity:1};let et=b.zenith,it="normal",Nt=0,ft="none";if(s>.15?(et=b.ozone,it="soft-light",Nt=.15,ft="saturate(1.05)"):s>.02?(et=b.glow,it="overlay",Nt=.5,ft="saturate(1.3) contrast(1.1) sepia(0.2)"):s>-.1?(et=at(b.zenith,b.glow,.3),it="multiply",Nt=.6,ft="brightness(0.85) saturate(1.2) contrast(1.2)"):s>-.25?(et=b.zenith,it="multiply",Nt=.8,ft="brightness(0.6) saturate(1.1) contrast(1.3)"):(et={r:5,g:10,b:25},it="multiply",Nt=.93,ft="brightness(0.4) grayscale(0.5) contrast(1.4)"),x={backgroundColor:Tt(et),mixBlendMode:it,opacity:Nt,backdropFilter:ft,WebkitBackdropFilter:ft,pointerEvents:"none"},e.sunElevation<.2&&e.sunElevation>-.15){const Ot=Math.min(1,(.2-e.sunElevation)*5);if(Ot>.01){const tt=Math.max(0,Math.min(1,(.12-e.sunElevation)*10)),jt={r:255,g:0,b:110},Xt={r:255,g:100,b:50};let Wt=b.sunColor;tt>.5&&(Wt=jt),H={baseColor:Wt,midColor:Xt,opacity:Ot*.8,width:90*p,height:250*p}}}}else{let ye="#ffffff",ke="#808080",pe="overlay",Te=0;s>.4?(ye="#ffffff",ke="#ffffff",Te=0):s>.1?(ye="#fffaee",ke="#ffebcd",pe="soft-light",Te=.2):s>-.05?(ye="#d0ccc0",ke="#ff4500",pe="hard-light",Te=.4+c*.2):s>-.15?(ye="#8a8aa0",ke="#800080",pe="overlay",Te=.5):(ye="#1a2035",ke="#4b0082",pe="multiply",Te=.6),E={backgroundColor:ye,mixBlendMode:"multiply",opacity:1,pointerEvents:"none"},J={type:"solid",color:ye,mixBlendMode:"multiply",opacity:1},x={backgroundColor:ke,mixBlendMode:pe,opacity:Te,pointerEvents:"none"}}const T=f||0,ae=b.sunColor,ue=M??.6;if(e.skyEnabled&&T>.01&&s>-.01){const ye=`${r.x}px`,ke=`${r.y}px`;let pe=at(ae,b.glow,Math.min(1,P+.2));if(ue<.5){const ft=(.5-ue)*2;pe=at(pe,{r:255,g:40,b:10},ft*.8)}const Te=15+T*25,et=20+P*300*T*ue,it=Te+et,Nt=(1-e.skyHorizon)*100;A={background:`radial-gradient(circle at ${ye} ${ke}, 
                  rgba(${ae.r}, ${ae.g}, ${ae.b}, 1.0) 0%, 
                  rgba(${pe.r}, ${pe.g}, ${pe.b}, ${.8*(1-ue*.4)}) ${Te}px, 
                  rgba(${pe.r}, ${pe.g}, ${pe.b}, 0) ${it}px
              )`,mixBlendMode:"color-dodge",opacity:.8+T*.2,pointerEvents:"none",clipPath:`inset(0 0 ${Nt}% 0)`},_={color:pe,coreRadius:Te,outerRadius:it,intensity:.8+T*.2}}let se=at({r:10,g:15,b:35},b.horizon,.35);s<-.1&&(se=at(se,{r:2,g:2,b:5},.9));const K=[{offset:0,color:Tt(b.zenith)},{offset:45,color:Tt(b.upper)},{offset:75,color:Tt(b.ozone)},{offset:92,color:Tt(b.glow)},{offset:100,color:Tt(b.horizon)}],n=[{offset:0,...b.zenith},{offset:45,...b.upper},{offset:75,...b.ozone},{offset:92,...b.glow},{offset:100,...b.horizon}],S=new Uint8ClampedArray(i*4),q=y*100,me=p,Z=ye=>Math.max(0,(q-ye)/100*i),C=0,G=Math.floor(Z(60*me)),re=Math.floor(Z(30*me)),ce=Math.floor(Z(12*me)),Ue=Math.floor(i*y);for(let ye=0;ye<i;ye++){const ke=ye*4;let pe=se;if(ye<Ue){let Te,lt,et;ye<G?(Te=n[0],lt=n[1],et=(ye-C)/Math.max(1,G-C)):ye<re?(Te=n[1],lt=n[1],et=(ye-G)/Math.max(1,re-G)):ye<ce?(Te=n[2],lt=n[3],et=(ye-re)/Math.max(1,ce-re)):(Te=n[3],lt=n[4],et=(ye-ce)/Math.max(1,Ue-ce)),pe=at(Te,lt,Math.max(0,Math.min(1,et)))}S[ke]=pe.r,S[ke+1]=pe.g,S[ke+2]=pe.b,S[ke+3]=255}a.current.skyState={stops:K,stopsRgb:n,ground:se,sun:b.sunColor,sunPos:r,glow:_,reflection:H},a.current.skyLut=S;const Ye=e.skyEnabled||e.isGradientMode,je={glowStyles:A,ambientStyles:E,gradeStyles:x,ambientParams:J,skyColors:Ye?{stops:K,ground:Tt(se),sun:Tt(b.sunColor),sunX:r.x,sunY:r.y}:null},We=JSON.stringify(je);We!==$.current&&($.current=We,O(je))},[e.gradientTime,e.gradientHumidity,e.sunIntensity,e.skyEnabled,e.isGradientMode,e.sunElevation,e.skyHorizon,e.sunAzimuth,ge,w,i,e.atmosphereDensity,e.sunDiffusion,e.skyScale]),o.useEffect(()=>{ee.current=l},[l]);const ie=o.useCallback(()=>{const r=te.current.get(U.current),s=a.current.layerCanvases.get(U.current);if(!r||!s||!Q.current)return;const c=s.width,f=s.height;if(c<=0||f<=0)return;L.current.historyIndex<L.current.history.length-1&&L.current.history.splice(L.current.historyIndex+1),L.current.history.push({layerId:U.current,painting:r.getImageData(0,0,c,f),mask:Q.current.getImageData(0,0,c,f)}),L.current.historyIndex++;let g=L.current.history.reduce((M,y)=>M+y.painting.data.length+y.mask.data.length,0);for(;L.current.history.length>0&&g>sa;){const M=L.current.history.shift();M&&(g-=M.painting.data.length+M.mask.data.length,L.current.historyIndex--)}L.current.history.length>20&&(L.current.history.shift(),L.current.historyIndex--)},[]),Qe=o.useCallback(()=>{if(L.current.historyIndex<=0||!Q.current)return;L.current.historyIndex--;const r=L.current.history[L.current.historyIndex];if(r){const s=te.current.get(r.layerId);s&&s.putImageData(r.painting,0,0),Q.current.putImageData(r.mask,0,0)}},[]),V=o.useCallback(()=>{if(L.current.historyIndex>=L.current.history.length-1||!Q.current)return;L.current.historyIndex++;const r=L.current.history[L.current.historyIndex];if(r){const s=te.current.get(r.layerId);s&&s.putImageData(r.painting,0,0),Q.current.putImageData(r.mask,0,0)}},[]),z=o.useCallback((r,s)=>{const{temp:c,layerCanvases:f,mask:g,composite:M}=a.current,y=h,p=r*y,P=s*y;if(p<=0||P<=0)return;const b=x=>{if(x.width===p&&x.height===P)return!1;const A=document.createElement("canvas");A.width=x.width,A.height=x.height;const J=A.getContext("2d");J&&x.width>0&&x.height>0&&J.drawImage(x,0,0),x.width=p,x.height=P,x.style.width="100%",x.style.height="100%";const _=x.getContext("2d");return _&&(_.setTransform(y,0,0,y,0,0),_.imageSmoothingEnabled=!0,_.save(),_.setTransform(1,0,0,1,0,0),A.width>0&&A.height>0&&_.drawImage(A,0,0),_.restore()),!0};let E=!1;g&&b(g)&&(E=!0),c&&b(c),M&&b(M),f.forEach(x=>{b(x)&&(E=!0)}),E?(L.current.history=[],L.current.historyIndex=-1,ie()):L.current.history.length===0&&ie()},[ie,h]),X=o.useCallback((r,s,c)=>{j.forEach(M=>{const y=r(M.id);if(y){a.current.layerCanvases.set(M.id,y);const p=y.getContext("2d",{willReadFrequently:!0});p&&(p.imageSmoothingEnabled=!0,te.current.set(M.id,p))}}),a.current.mask=s,a.current.temp||(a.current.temp=document.createElement("canvas")),a.current.composite||(a.current.composite=document.createElement("canvas"));const f=s.getContext("2d",{willReadFrequently:!0}),g=a.current.temp.getContext("2d",{willReadFrequently:!0});f&&g&&(Q.current=f,F.current=g,c&&F.current&&(a.current.heightMapPattern=F.current.createPattern(c,"repeat")),z(w,i))},[w,i,z,j]);o.useEffect(()=>{z(w,i)},[w,i,z]);const Pe=o.useCallback(r=>{F.current&&(a.current.heightMapPattern=F.current.createPattern(r,"repeat"))},[]),Ae=o.useCallback((r,s,c,f)=>{if(!m.current.skyEnabled||!f||!f.glow||!f.sunPos)return r;const{glow:g,sunPos:M}=f,y=s-M.x,p=c-M.y,P=y*y+p*p;if(P<g.outerRadius*g.outerRadius){const E=Math.sqrt(P)/g.outerRadius,x=Math.pow(1-E,2)*g.intensity;if(x>.01)return da(r,g.color,x)}return r},[]),be=o.useCallback((r,s)=>{if(!m.current.skyEnabled||!a.current.skyState)return null;const{stopsRgb:c,ground:f,sun:g,sunPos:M,reflection:y}=a.current.skyState,{skyHorizon:p,skyScale:P,waterEnabled:b,waterOpacity:E}=m.current,x=i*p;let A={...f};if(s>x){const T=i-x,ae=Math.max(0,s-x),ue=Math.min(1,ae/(T*.4)),ve=c[4];A=at(ve,f,ue)}else{if(M){const ae=r-M.x,ue=s-M.y,ve=ae*ae+ue*ue,se=90*P/2;if(ve<se*se)return g}const T=a.current.skyLut;if(T){const ue=Math.floor(Math.max(0,Math.min(i-1,s)))*4;A={r:T[ue],g:T[ue+1],b:T[ue+2]}}}if(s>x&&y&&M){const T=s-x;if(T<y.height&&T>=0){const ae=Math.abs(r-M.x),ue=y.width/2,ve=15;let se=0;if(ae<ue)se=1;else{const K=ae-ue;K<ve*2&&(se=1-K/(ve*2))}if(se>0){const K=T/y.height;let n,S=1;if(K<.6){const me=K/.6;n=at(y.baseColor,y.midColor,me),S=1-me*.5}else{const me=(K-.6)/.4;n=y.midColor,S=.5*(1-me)}const q=y.opacity*se*S;A=Or(A,n,q)}}}const J=100,_=J/2;if(Math.abs(s-x)<_){const T=(s-(x-_))/J;let ae=0;T<.4?ae=T/.4:T>.6?ae=1-(T-.6)/.4:ae=1;const ue=ae*.6;ue>.01&&(A=Or(A,c[4],ue))}return A=Ae(A,r,s,a.current.skyState),A},[i,Ae]),Ze=o.useCallback((r,s,c,f)=>{const g=h,M=Math.floor(r*g),y=Math.floor(s*g),p=Math.ceil(c*g),P=Math.ceil(f*g);if(p<=0||P<=0)return null;let b=a.current.composite;b||(b=document.createElement("canvas"),a.current.composite=b),(b.width<p||b.height<P)&&(b.width=Math.max(b.width,p),b.height=Math.max(b.height,P));const E=b.getContext("2d",{willReadFrequently:!0});if(!E)return null;E.clearRect(0,0,p,P),j.forEach(x=>{if(x.visible){const A=a.current.layerCanvases.get(x.id);A&&E.drawImage(A,M,y,p,P,0,0,p,P)}});try{return{data:E.getImageData(0,0,p,P).data,width:p,height:P,x:M,y}}catch{return null}},[j,h]),pt=o.useCallback(()=>{const r=oe();return r?r.toDataURL():null},[R]),kt=o.useCallback((r,s,c,f)=>{const g=he(),M=a.current.patternImage;if(!g||!M)return;const y=c-r,p=f-s,P=Math.hypot(y,p);if(P<1)return;const b=m.current,E=b.patternJitterScale||0,x=b.patternJitterRotation||0,A=b.patternJitterHue||0,J=b.patternJitterSaturation||0,_=b.patternJitterValue||0,H=Math.max(15,50*b.patternScale),T=Math.max(5,H*.5),ae=Math.ceil(P/T);if(ae>2e3)return;const ue=y/P*T,ve=p/P*T;g.save();for(let se=0;se<=ae;se++){const K=r+ue*se,n=s+ve*se;let S=b.patternStampRotation;if(x>0){const ce=(Math.random()-.5)*2*(x*180);S=(S+ce)%360}const q=(S+b.patternAngle)*Math.PI/180;let me=b.patternScale;if(E>0){const ce=1+(Math.random()-.5)*2*E;me*=Math.max(.1,ce)}let Z="";if(A>0){const ce=(Math.random()-.5)*360*A;Z+=`hue-rotate(${ce}deg) `}if(J>0){const ce=100+(Math.random()-.5)*200*J;Z+=`saturate(${Math.max(0,ce)}%) `}if(_>0){const ce=100+(Math.random()-.5)*200*_;Z+=`brightness(${Math.max(0,ce)}%) `}const C=50/M.width*me,G=M.width*C,re=M.height*C;g.save(),g.translate(K,n),g.rotate(q),Z&&(g.filter=Z.trim()),g.drawImage(M,-G/2,-re/2,G,re),g.restore()}g.restore(),ie()},[ie]),Lt=o.useCallback(r=>{const s=he(),c=a.current.patternImage;if(!s||!c||r.length<3)return;const f=m.current;let g=r[0].x,M=r[0].x,y=r[0].y,p=r[0].y;r.forEach(K=>{g=Math.min(g,K.x),M=Math.max(M,K.x),y=Math.min(y,K.y),p=Math.max(p,K.y)});const P=Math.max(20,50*f.patternScale);g-=P,M+=P,y-=P,p+=P;const b=f.patternJitterScale||0,E=f.patternJitterRotation||0,x=f.patternJitterHue||0,A=f.patternJitterSaturation||0,J=f.patternJitterValue||0,_=Math.max(15,50*f.patternScale),H=_*.8,T=_*.8,ae=(M-g)/H,ue=(p-y)/T;if(ae*ue>5e3)return;s.save(),s.beginPath(),s.moveTo(r[0].x,r[0].y);for(let K=1;K<r.length-1;K++){const n=(r[K].x+r[K+1].x)/2,S=(r[K].y+r[K+1].y)/2;s.quadraticCurveTo(r[K].x,r[K].y,n,S)}r.length>2&&s.lineTo(r[r.length-1].x,r[r.length-1].y),s.closePath(),s.clip();const ve=Math.floor(g/H)*H,se=Math.floor(y/T)*T;for(let K=se;K<p;K+=T)for(let n=ve;n<M;n+=H){const S=Math.sin(n*12.9898+K*78.233)*43758.5453,q=S-Math.floor(S),me=S*1.5-Math.floor(S*1.5),Z=S*2-Math.floor(S*2),C=S*13.37%1,G=S*42.42%1;let re=f.patternStampRotation;if(E>0){const ke=(q-.5)*2*(E*180);re=(re+ke)%360}const ce=(re+f.patternAngle)*Math.PI/180;let Ue=f.patternScale;if(b>0){const ke=1+(me-.5)*2*b;Ue*=Math.max(.1,ke)}let Ye="";if(x>0){const ke=(Z-.5)*360*x;Ye+=`hue-rotate(${ke}deg) `}if(A>0){const ke=100+(Math.abs(C)-.5)*200*A;Ye+=`saturate(${Math.max(0,ke)}%) `}if(J>0){const ke=100+(Math.abs(G)-.5)*200*J;Ye+=`brightness(${Math.max(0,ke)}%) `}const je=50/c.width*Ue,We=c.width*je,ye=c.height*je;s.save(),s.translate(n+H/2,K+T/2),s.rotate(ce),Ye&&(s.filter=Ye.trim()),s.drawImage(c,-We/2,-ye/2,We,ye),s.restore()}m.current.useTexture&&a.current.heightMapPattern&&(s.globalCompositeOperation="destination-out",s.globalAlpha=.5,s.fillStyle=a.current.heightMapPattern,s.fill()),a.current.mask&&(s.globalCompositeOperation="destination-out",s.globalAlpha=1,s.drawImage(a.current.mask,0,0,s.canvas.width/h,s.canvas.height/h)),s.restore(),ie()},[ie,h]),dt=o.useCallback(r=>{const s=he(),c=oe();if(!s||!c||r.length<3)return;const f=h,g=c.width,M=c.height,y=m.current;let p=r[0].x,P=r[0].x,b=r[0].y,E=r[0].y;r.forEach(G=>{p=Math.min(p,G.x),P=Math.max(P,G.x),b=Math.min(b,G.y),E=Math.max(E,G.y)});const x=(y.patternAngle-90)*(Math.PI/180),A=Math.cos(x),J=Math.sin(x),_=[{x:p,y:b},{x:P,y:b},{x:P,y:E},{x:p,y:E}];let H=1/0,T=-1/0;_.forEach(G=>{const re=G.x*A+G.y*J;H=Math.min(H,re),T=Math.max(T,re)});const ae=Math.max(1,T-H),ue=Ct(y.color),ve=Tt(ue),se=Math.max(.5,y.size/10),K=Math.min(1,y.opacity),n=F.current;if(!n||!a.current.temp)return;n.save(),n.setTransform(f,0,0,f,0,0),n.clearRect(0,0,g/f,M/f),n.beginPath(),n.moveTo(r[0].x,r[0].y);for(let G=1;G<r.length-1;G++){const re=(r[G].x+r[G+1].x)/2,ce=(r[G].y+r[G+1].y)/2;n.quadraticCurveTo(r[G].x,r[G].y,re,ce)}r.length>2&&n.lineTo(r[r.length-1].x,r[r.length-1].y),n.closePath(),n.clip();const q=(P-p)*(E-b)/(se*se*2)*K*5,Z=Math.min(q,5e4),C=y.colorVariation>.01||y.hueVariation>.01;if(n.globalAlpha=1,C)for(let G=0;G<Z;G++){const re=p+Math.random()*(P-p),ce=b+Math.random()*(E-b),je=1-(re*A+ce*J-H)/ae;if(Math.random()<je){let We={...ue};if(y.hueVariation>.01){const ke=(Math.random()-.5)*2*y.hueVariation*60;We=lr(We,ke,0,0)}if(y.colorVariation>.01){const ke=(Math.random()-.5)*2*y.colorVariation,pe=ke>0?ir:sr;We=at(We,pe,Math.abs(ke))}n.fillStyle=Tt(We),n.beginPath();const ye=se*(.5+Math.random()*.5);n.arc(re,ce,ye,0,Math.PI*2),n.fill()}}else{n.fillStyle=ve,n.beginPath();for(let G=0;G<Z;G++){const re=p+Math.random()*(P-p),ce=b+Math.random()*(E-b),je=1-(re*A+ce*J-H)/ae;if(Math.random()<je){const We=se*(.5+Math.random()*.5);n.moveTo(re+We,ce),n.arc(re,ce,We,0,Math.PI*2)}}n.fill()}y.useTexture&&a.current.heightMapPattern&&(n.globalCompositeOperation="destination-out",n.globalAlpha=.5,n.fillStyle=a.current.heightMapPattern,n.fillRect(p,b,P-p,E-b)),a.current.mask&&(n.globalCompositeOperation="destination-out",n.globalAlpha=1,n.drawImage(a.current.mask,0,0,g/f,M/f)),n.restore(),s.save(),s.globalAlpha=1,s.globalCompositeOperation=y.isEraser?"destination-out":y.blendMode||"source-over",s.setTransform(1,0,0,1,0,0),s.drawImage(a.current.temp,0,0),s.restore(),n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,g,M),n.restore(),ie()},[ie,h]),Ft=o.useCallback(r=>{const s=Q.current;if(!(!s||r.length<3)){s.save(),s.globalCompositeOperation=m.current.lassoMode==="subtract"?"destination-out":"source-over",s.fillStyle="#2b6cb0",s.globalAlpha=1,s.beginPath(),s.moveTo(r[0].x,r[0].y);for(let c=1;c<r.length-1;c++){const f=(r[c].x+r[c+1].x)/2,g=(r[c].y+r[c+1].y)/2;s.quadraticCurveTo(r[c].x,r[c].y,f,g)}r.length>2&&s.lineTo(r[r.length-1].x,r[r.length-1].y),s.closePath(),s.fill(),s.restore(),ie()}},[ie]),St=o.useCallback((r,s)=>{const c=he(),f=F.current,g=oe();if(!c||!g||!a.current.temp||!f)return;const M=h,y=g.width,p=g.height,P=m.current,b=Math.min(r.x,s.x),E=Math.min(r.y,s.y),x=Math.abs(s.x-r.x),A=Math.abs(s.y-r.y);if(x<1||A<1)return;let J=Ct(P.color);if(P.hueVariation>.01){const H=(Math.random()-.5)*2*P.hueVariation*60;J=lr(J,H,0,0)}if(P.colorVariation>.01){const H=(Math.random()-.5)*2*P.colorVariation,T=H>0?ir:sr;J=at(J,T,Math.abs(H))}const _=Tt(J);if(f.save(),f.setTransform(M,0,0,M,0,0),f.clearRect(0,0,y/M,p/M),f.globalCompositeOperation="source-over",f.fillStyle=_,f.globalAlpha=P.opacity,f.fillRect(b,E,x,A),P.wetMode&&!P.isEraser){const H=Ze(b,E,x,A);if(H){const T=Math.floor(b*M),ae=Math.floor(E*M),ue=Math.ceil(x*M),ve=Math.ceil(A*M);if(ue>0&&ve>0){const se=f.getImageData(T,ae,ue,ve),K=se.data,n=H.data,S={r:0,g:0,b:0},q={r:0,g:0,b:0},me=K.length;for(let Z=0;Z<me;Z+=4)K[Z+3]>0&&Z<n.length&&n[Z+3]>20&&(S.r=K[Z],S.g=K[Z+1],S.b=K[Z+2],q.r=n[Z],q.g=n[Z+1],q.b=n[Z+2],Gr(S,q,.15),K[Z]=S.r,K[Z+1]=S.g,K[Z+2]=S.b);f.putImageData(se,T,ae)}}}if(P.useTexture&&a.current.heightMapPattern){f.globalCompositeOperation="destination-out";const H=.5;f.globalAlpha=H,f.fillStyle=a.current.heightMapPattern,f.fillRect(b,E,x,A)}a.current.mask&&(f.globalCompositeOperation="destination-out",f.globalAlpha=1,f.drawImage(a.current.mask,0,0,y/M,p/M)),f.restore(),c.save(),c.globalAlpha=1,c.globalCompositeOperation=P.isEraser?"destination-out":P.blendMode||"source-over",c.setTransform(1,0,0,1,0,0),c.drawImage(a.current.temp,0,0),c.restore(),f.save(),f.setTransform(1,0,0,1,0,0),f.clearRect(0,0,y,p),f.restore(),ie()},[ie,Ze,h]),Rt=o.useCallback(r=>{const s=he(),c=F.current,f=oe();if(!s||!f||!a.current.temp||!c||r.length<3)return;const g=h,M=f.width,y=f.height,p=m.current;let P=r[0].x,b=r[0].x,E=r[0].y,x=r[0].y;r.forEach(C=>{P=Math.min(P,C.x),b=Math.max(b,C.x),E=Math.min(E,C.y),x=Math.max(x,C.y)});const A=(b-P)*g,J=(x-E)*g;if(A<1||J<1)return;const _=Ct(p.color),H=Ct(p.gradColor2||"#ffffff"),T=r[0];let ae=0,ue=r[0];r.forEach(C=>{const G=(C.x-T.x)**2+(C.y-T.y)**2;G>ae&&(ae=G,ue=C)});const ve={x:ue.x-T.x,y:ue.y-T.y},se=ae||1;c.save(),c.setTransform(g,0,0,g,0,0),c.clearRect(0,0,M/g,y/g),c.beginPath(),c.moveTo(r[0].x,r[0].y);for(let C=1;C<r.length;C++)c.lineTo(r[C].x,r[C].y);c.closePath(),c.clip();const K=Math.floor(P*g),n=Math.floor(E*g),S=Math.ceil((b-P)*g),q=Math.ceil((x-E)*g);if(S<=0||q<=0){c.restore();return}c.fillStyle="#000000",c.fill();const me=c.getImageData(K,n,S,q),Z=me.data;for(let C=0;C<q;C++)for(let G=0;G<S;G++){const re=(C*S+G)*4;if(Z[re+3]>0){const ce=(K+G)/g,Ue=(n+C)/g,Ye=ce-T.x,je=Ue-T.y,We=(Ye*ve.x+je*ve.y)/se,ye=Math.max(0,Math.min(1,We));let Te=Math.random()<ye?H:_;if(p.hueVariation>.01){const lt=(Math.random()-.5)*2*p.hueVariation*60;Te=lr(Te,lt,0,0)}if(p.colorVariation>.01){const lt=(Math.random()-.5)*2*p.colorVariation,et=lt>0?ir:sr;Te=at(Te,et,Math.abs(lt))}Z[re]=Te.r,Z[re+1]=Te.g,Z[re+2]=Te.b,Z[re+3]=255*p.opacity}}if(c.putImageData(me,K,n),c.restore(),c.save(),c.setTransform(g,0,0,g,0,0),p.useTexture&&a.current.heightMapPattern){c.globalCompositeOperation="destination-out";const C=.5;c.globalAlpha=C,c.fillStyle=a.current.heightMapPattern,c.fillRect(P,E,b-P,x-E)}a.current.mask&&(c.globalCompositeOperation="destination-out",c.globalAlpha=1,c.drawImage(a.current.mask,0,0,M/g,y/g)),c.restore(),s.save(),s.globalCompositeOperation=p.blendMode||"source-over",s.setTransform(1,0,0,1,0,0),s.drawImage(a.current.temp,0,0),s.restore(),c.save(),c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,M,y),c.restore(),ie()},[ie,h]),ut=o.useCallback(r=>{const s=he(),c=F.current,f=oe();if(!s||!f||!a.current.temp||!c||r.length<3)return;const g=h,M=f.width,y=f.height,p=m.current;let P=r[0].x,b=r[0].x,E=r[0].y,x=r[0].y;r.forEach(T=>{P=Math.min(P,T.x),b=Math.max(b,T.x),E=Math.min(E,T.y),x=Math.max(x,T.y)});const A=(b-P)*g,J=(x-E)*g;if(A<1||J<1)return;let _=Ct(p.color);if(p.hueVariation>.01){const T=(Math.random()-.5)*2*p.hueVariation*60;_=lr(_,T,0,0)}if(p.colorVariation>.01){const T=(Math.random()-.5)*2*p.colorVariation,ae=T>0?ir:sr;_=at(_,ae,Math.abs(T))}const H=Tt(_);c.save(),c.setTransform(g,0,0,g,0,0),c.clearRect(0,0,M/g,y/g),c.globalCompositeOperation="source-over",c.fillStyle=H,c.globalAlpha=p.opacity,c.beginPath(),c.moveTo(r[0].x,r[0].y);for(let T=1;T<r.length-1;T++){const ae=(r[T].x+r[T+1].x)/2,ue=(r[T].y+r[T+1].y)/2;c.quadraticCurveTo(r[T].x,r[T].y,ae,ue)}if(r.length>2&&c.lineTo(r[r.length-1].x,r[r.length-1].y),c.closePath(),c.fill(),p.wetMode&&!p.isEraser){const T=Ze(P,E,b-P,x-E);if(T){const ae=Math.floor(P*g),ue=Math.floor(E*g),ve=Math.ceil((b-P)*g),se=Math.ceil((x-E)*g);if(ve>0&&se>0){const K=c.getImageData(ae,ue,ve,se),n=K.data,S=T.data,q={r:0,g:0,b:0},me={r:0,g:0,b:0},Z=n.length;for(let C=0;C<Z;C+=4)n[C+3]>0&&C<S.length&&S[C+3]>20&&(q.r=n[C],q.g=n[C+1],q.b=n[C+2],me.r=S[C],me.g=S[C+1],me.b=S[C+2],Gr(q,me,.15),n[C]=q.r,n[C+1]=q.g,n[C+2]=q.b);c.putImageData(K,ae,ue)}}}if(p.useTexture&&a.current.heightMapPattern){c.globalCompositeOperation="destination-out";const T=.5;c.globalAlpha=T,c.fillStyle=a.current.heightMapPattern,c.fill()}a.current.mask&&(c.globalCompositeOperation="destination-out",c.globalAlpha=1,c.drawImage(a.current.mask,0,0,M/g,y/g)),c.restore(),s.save(),s.globalAlpha=1,s.globalCompositeOperation=p.isEraser?"destination-out":p.blendMode||"source-over",s.setTransform(1,0,0,1,0,0),s.drawImage(a.current.temp,0,0),s.restore(),c.save(),c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,M,y),c.restore(),ie()},[ie,Ze,h]),ne=(r,s,c,f,g,M,y)=>{if(!L.current.isDrawing||!he()||!F.current)return;const p=F.current,P=h,{lastPoint:b}=L.current,{bristles:E}=L.current,x=m.current,A=x.brushType==="fan2",J=x.brushType==="fan3",_=x.brushType==="pastel",H=x.brushType==="pastel2",T=Math.hypot(r-b.x,s-b.y),ae=x.size;let ue=.08;if(x.pressureSensitivity){const G=Math.min(b.pressure,c);ue*=Math.max(.15,G)}let ve=Math.max(1.5,ae*ue);if(_&&(ve=Math.max(1.5,ae*.22)),H&&(ve=Math.max(1.5,ae*.25)),T<ve&&L.current.hasMoved)return;const se=Math.ceil(T/ve);if(T>4){const G=Math.atan2(s-b.y,r-b.x);if(!L.current.hasMoved)L.current.angle=G,L.current.hasMoved=!0;else{const re=x.brushType==="chisel"?.35:.08;let ce=G-L.current.angle;for(;ce<-Math.PI;)ce+=Math.PI*2;for(;ce>Math.PI;)ce-=Math.PI*2;L.current.angle+=ce*re}}const K=x.opacity;let n=.5;if(f!==void 0&&g!==void 0){const G=Math.max(Math.abs(f),Math.abs(g));n=Math.min(1,G/60)}let S=0;(A||J)&&f!==void 0&&(S=f/45*(Math.PI/4));const q=L.current.angle+Math.PI/2+S,Z=Math.min(T/15,1),C=!x.wetMode&&x.colorVariation<.01&&x.hueVariation<.01?Tt(Ct(x.color)):null;for(let G=0;G<=se;G++){const re=G/se,ce=b.x+(r-b.x)*re,Ue=b.y+(s-b.y)*re,Ye=b.pressure+(c-b.pressure)*re,je=ae*2;M.minX=Math.min(M.minX,ce-je),M.minY=Math.min(M.minY,Ue-je),M.maxX=Math.max(M.maxX,ce+je),M.maxY=Math.max(M.maxY,Ue+je);let We=ae;x.pressureSensitivity&&!A&&!J&&!_&&!H&&(We*=Ye);let ye=x.wetMode?1e-4:3e-4;x.wetMode&&L.current.paintLoad<.5&&(ye=5e-5),(_||H)&&!x.wetMode&&(ye=0);const ke=ye*(1+Z*3)*ve;L.current.paintLoad=Math.max(0,L.current.paintLoad-ke);const pe=Math.pow(Ye,2),Te=_||H?2:1;for(let lt=0;lt<Te;lt++){let et=q,it=We,Nt=1;if(_||H){et=Math.random()*Math.PI*2;const Ot=.08;it=We*(1-Math.random()*Ot),it*=.4+Ye*.6,Nt=1-Math.random()*.06}const ft=Math.cos(et),Bt=Math.sin(et);for(let Ot=0;Ot<E.length;Ot++){const tt=E[Ot];let jt=tt.dx*it,Xt=tt.dy*it;if(Xt*=Nt,A&&(jt*=.8+n*.4),J&&!_&&!H){const rt=1+Math.pow(Ye,2)*4;if(jt=tt.dx*We*rt,Ye>.25){const _t=(Ye-.25)*1.5;Xt+=Math.sin(Ot*.5)*_t*We*.4}}if(!_&&!H){const rt=(Math.sin(ce*.2)+Math.cos(Ue*.2))*.1;if((1-L.current.paintLoad)*.5+Z*.3+rt>tt.drySensitivity)continue}const Wt=jt*ft-Xt*Bt,wr=jt*Bt+Xt*ft,rr=_||H?(Math.random()-.5)*it*.03:0,Kt=_||H?(Math.random()-.5)*it*.03:0,Vt=ce+Wt+rr,Ut=Ue+wr+Kt;if(x.wetMode&&y){const rt=Vt*P|0,_t=Ut*P|0,Zt=rt-y.x,ar=_t-y.y;if(Zt>=0&&ar>=0&&Zt<y.width&&ar<y.height){const d=(ar*y.width+Zt)*4;if(y.data[d+3]>20){const I={r:y.data[d],g:y.data[d+1],b:y.data[d+2]};tt.hasPaint?(la(tt.color,I,.1),L.current.paintLoad=Math.min(1,L.current.paintLoad+.05)):(tt.color={...I},tt.hasPaint=!0,L.current.paintLoad=Math.max(L.current.paintLoad,.5))}}}if(x.wetMode&&!tt.hasPaint)continue;let Yt=Math.max(1,it*.05*tt.thickness*(1+pe));const Jt=it*.15*tt.length;let zt=K*L.current.paintLoad;if(!_&&!H){const rt=x.brushType==="chisel"?1:1-Math.pow(Math.abs(tt.dx)*1.8,3);zt*=rt,x.pressureSensitivity&&(A||J?zt*=Math.pow(Ye,2.5):zt*=.3+Ye*1.5),x.wetMode&&(zt*=.95)}else _?(zt=K*Math.pow(Ye,1.5),x.wetMode&&(zt*=.95)):H&&(zt=K*Math.pow(Ye,2.5),x.wetMode&&(zt*=.95));if(zt=Math.min(1,Math.max(0,zt)),zt<.01)continue;let nr;if(C)nr=C;else{let rt={...tt.color};if(x.hueVariation>.01&&Math.abs(tt.hueBias)>.01&&(rt=lr(rt,tt.hueBias*x.hueVariation*60,0,0)),x.colorVariation>.01&&Math.abs(tt.tempBias)>.05){const _t=Math.abs(tt.tempBias)*x.colorVariation;rt=at(rt,tt.tempBias>0?ir:sr,_t)}nr=Tt(rt)}if(p.globalAlpha=zt,p.globalCompositeOperation=x.blendMode||"source-over",p.fillStyle=nr,p.save(),p.translate(Vt,Ut),p.rotate(et),H){const rt=Math.max(.5,Yt*.6);p.beginPath(),p.rect(-rt,-rt,rt*2,rt*2),p.fill()}else{const rt=tt.feather*Jt;p.fillRect(-Yt/2,rt,Yt,Jt)}p.restore()}}}if(x.useTexture&&a.current.heightMapPattern){let G=1;if(_)G=1-Math.pow(c,2)*.85,G=Math.max(.1,Math.min(1,G));else if(H)G=1-Math.pow(c,3)*.9,G=Math.max(.1,Math.min(1,G));else{let re=1-c*1.3;const ce=Math.pow(1-L.current.paintLoad,.5);re=Math.max(re,ce),G=Math.min(1,Math.max(0,re))}if(G>.01){p.save(),p.globalCompositeOperation="destination-out",p.globalAlpha=G,p.fillStyle=a.current.heightMapPattern;const re=ae,ce=Math.min(L.current.lastPoint.x,r)-re,Ue=Math.min(L.current.lastPoint.y,s)-re,Ye=Math.max(L.current.lastPoint.x,r)+re,je=Math.max(L.current.lastPoint.y,s)+re;p.beginPath(),p.rect(ce,Ue,Ye-ce,je-Ue),p.fill(),p.restore()}}a.current.mask&&(p.save(),p.globalCompositeOperation="destination-out",p.globalAlpha=1,p.setTransform(P,0,0,P,0,0),p.drawImage(a.current.mask,0,0,a.current.mask.width/P,a.current.mask.height/P),p.restore()),L.current.lastPoint={x:r,y:s,pressure:c,tiltX:f,tiltY:g}},Ie=o.useCallback(r=>{const s=he(),c=oe();if(!s||!c||!a.current.temp||!F.current||r.length===0)return;const f=h,g=c.width/f,M=c.height/f;F.current.clearRect(0,0,g,M);const y={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};let p=null;const P=[];let b=L.current.lastPoint;if(r.forEach((E,x)=>{const A=x===r.length-1;(Math.hypot(E.x-b.x,E.y-b.y)>.5||A)&&(P.push(E),b=E)}),P.length!==0){if(m.current.wetMode){const E=L.current.lastPoint;let x=E.x,A=E.y,J=E.x,_=E.y;P.forEach(n=>{x=Math.min(x,n.x),A=Math.min(A,n.y),J=Math.max(J,n.x),_=Math.max(_,n.y)});const H=m.current.size*2*f,T=Math.max(0,Math.floor(x*f-H)),ae=Math.max(0,Math.floor(A*f-H)),ue=Math.min(c.width,Math.ceil(J*f+H)),ve=Math.min(c.height,Math.ceil(_*f+H)),se=ue-T,K=ve-ae;if(se>0&&K>0){const n=Ze(T/f,ae/f,se/f,K/f);n&&(p=n)}}if(P.forEach(E=>{ne(E.x,E.y,E.pressure,E.tiltX,E.tiltY,y,p)}),y.minX<y.maxX&&y.minY<y.maxY){s.save(),s.globalCompositeOperation=m.current.isEraser?"destination-out":m.current.blendMode||"source-over",s.setTransform(f,0,0,f,0,0);const E=2,x=Math.max(0,Math.floor(y.minX-E)),A=Math.max(0,Math.floor(y.minY-E)),J=Math.min(g,Math.ceil(y.maxX+E))-x,_=Math.min(M,Math.ceil(y.maxY+E))-A;J>0&&_>0&&s.drawImage(a.current.temp,x*f,A*f,J*f,_*f,x,A,J,_),s.restore()}p=null}},[ne,Ze,h]),xe=o.useCallback((r,s,c,f,g)=>{Ie([{x:r,y:s,pressure:c||.5,tiltX:f,tiltY:g}])},[Ie]),Ve=o.useCallback((r,s,c=.5,f=0,g=0)=>{if(L.current.isDrawing=!0,L.current.lastPoint={x:r,y:s,pressure:c,tiltX:f,tiltY:g},m.current.autoClean){const M=Ct(m.current.color);L.current.bristles.forEach(y=>{m.current.wetMode?y.hasPaint=!1:(y.color={...M},y.hasPaint=!0)}),L.current.paintLoad=1}else L.current.paintLoad=Math.max(L.current.paintLoad,.5);L.current.hasMoved=!1},[]),De=o.useCallback(()=>{L.current.isDrawing&&(L.current.isDrawing=!1,ie())},[ie]),vt=o.useCallback((r,s)=>{const c=h;for(let f=j.length-1;f>=0;f--){const g=j[f];if(!g.visible)continue;const M=te.current.get(g.id);if(M)try{if(M.canvas.width===0)return null;const p=M.getImageData(Math.floor(r*c),Math.floor(s*c),1,1).data;if(p[3]>0)return tr(p[0],p[1],p[2])}catch{}}if(m.current.skyEnabled){const f=be(r,s);if(f)return tr(f.r,f.g,f.b)}return ee.current},[j,be,h]),$e=o.useCallback(()=>{const r=oe();r&&(Dr(r),ie())},[ie]),Et=o.useCallback(()=>{const r=a.current.mask;r&&(Dr(r),ie())},[ie]),gt=o.useCallback(()=>{const r=a.current.mask,s=Q.current;if(!r||!s)return;const c=r.width,f=r.height;if(c<=0||f<=0)return;const g=s.getImageData(0,0,c,f),M=g.data;for(let y=0;y<M.length;y+=4)M[y+3]=255-M[y+3],M[y]=43,M[y+1]=108,M[y+2]=176;s.putImageData(g,0,0),ie()},[ie]),It=o.useCallback((r,s,c,f)=>{const g=Q.current;if(!g)return;const M=m.current.tapeWidth,y=c-r,p=f-s,P=Math.hypot(y,p);if(P<1)return;const b=-p/P,E=y/P,x=M/2,J=Math.ceil(P/2),_=[],H=[];for(let T=0;T<=J;T++){const ae=T/J,ue=r+y*ae,ve=s+p*ae,se=1.5,K=(Math.random()-.5)*se,n=(Math.random()-.5)*se;_.push({x:ue+b*(x+K),y:ve+E*(x+K)}),H.push({x:ue-b*(x+n),y:ve-E*(x+n)})}g.save(),g.globalCompositeOperation=m.current.lassoMode==="subtract"?"destination-out":"source-over",g.beginPath(),_.length>0&&g.moveTo(_[0].x,_[0].y);for(let T=1;T<_.length;T++)g.lineTo(_[T].x,_[T].y);for(let T=H.length-1;T>=0;T--)g.lineTo(H[T].x,H[T].y);g.closePath(),g.fillStyle="#2b6cb0",g.globalAlpha=1,g.fill(),g.restore(),ie()},[ie]),Dt=o.useCallback((r,s,c)=>{var x,A;const f=he(),g=oe(),M=F.current;if(!f||!g||!M||!a.current.temp)return;const y=h,p=g.width,P=g.height;if(p<=0||P<=0)return;c&&!a.current.snapshot&&(a.current.snapshot=f.getImageData(0,0,p,P)),c&&a.current.snapshot&&f.putImageData(a.current.snapshot,0,0),M.save(),M.setTransform(y,0,0,y,0,0),M.clearRect(0,0,p/y,P/y);const b=M.createLinearGradient(r.x,r.y,s.x,s.y),E=((x=a.current.skyState)==null?void 0:x.stops)||((A=D.skyColors)==null?void 0:A.stops);E?E.forEach(J=>b.addColorStop(J.offset/100,J.color)):(b.addColorStop(0,m.current.color),b.addColorStop(1,"rgba(255,255,255,0)")),M.globalCompositeOperation="source-over",M.globalAlpha=m.current.opacity,M.fillStyle=b,M.fillRect(0,0,p/y,P/y),a.current.mask&&(M.globalCompositeOperation="destination-out",M.globalAlpha=1,M.drawImage(a.current.mask,0,0,p/y,P/y)),M.restore(),f.save(),f.globalCompositeOperation=m.current.blendMode||"source-over",f.globalAlpha=1,f.setTransform(1,0,0,1,0,0),f.drawImage(a.current.temp,0,0),f.restore(),M.save(),M.setTransform(1,0,0,1,0,0),M.clearRect(0,0,p,P),M.restore(),c||(a.current.snapshot=null,ie())},[ie,D,h]),Gt=o.useCallback(()=>{a.current.snapshot=null},[]),ot=o.useCallback(()=>{const r=he();r&&a.current.snapshot&&(r.putImageData(a.current.snapshot,0,0),a.current.snapshot=null)},[]),At=o.useCallback((r,s,c,f=.5,g=0,M=0)=>{const y=h,p=r.canvas.width/y,P=r.canvas.height/y;r.clearRect(0,0,p,P);const{bristles:b,angle:E}=L.current,x=m.current.brushType==="fan2",A=m.current.brushType==="fan3",J=m.current.brushType==="pastel",_=m.current.brushType==="pastel2";let H=m.current.size;m.current.pressureSensitivity&&!x&&!A&&(H*=f);let T=.5;if(g!==0||M!==0){const K=Math.max(Math.abs(g),Math.abs(M));T=Math.min(1,K/60)}let ae=0;(x||A)&&(ae=g/45*(Math.PI/4));const ue=E+Math.PI/2+ae;r.save(),r.translate(s,c),r.rotate(ue),r.fillStyle=m.current.color,r.globalAlpha=.6;const ve=A||J||_?3:1;for(let K=0;K<b.length;K+=ve){const n=b[K],S=1+f*.8;let q=n.dx*H*S,me=n.dy*H*S;if(x&&(q*=.8+T*.4),A&&!J&&!_){const C=1+Math.pow(f,2)*4;if(q=n.dx*H*C,f>.25){const G=(f-.25)*1.5;me+=Math.sin(K*.5)*G*H*.4}}const Z=Math.max(1.5,H*.05*n.thickness);if(r.beginPath(),_){const C=Z/2;r.rect(q-C,me-C,C*2,C*2)}else r.arc(q,me,Z/2,0,Math.PI*2);r.fill()}r.globalAlpha=.3,r.strokeStyle=m.current.color,r.lineWidth=1,r.beginPath();const se=H*(x||A?.8:.4);J||_?(r.setLineDash([2,4]),r.arc(0,0,H*.5,0,Math.PI*2),r.stroke(),r.setLineDash([])):(m.current.brushType==="flat"||m.current.brushType==="chisel")&&(r.rect(-se,-2,se*2,4),r.stroke()),r.restore()},[h]);return{init:X,startStroke:Ve,endStroke:De,drawStroke:xe,drawBatch:Ie,clear:$e,pickColor:vt,drawTape:It,drawLasso:Ft,drawLassoFill:ut,drawRectLassoFill:St,drawStippleLasso:dt,drawPatternLasso:Lt,drawPatternLine:kt,drawGradBlendLasso:Rt,capturePattern:pt,clearMask:Et,invertMask:gt,renderBrushCursor:At,undo:Qe,redo:V,drawSkyGradient:Dt,commitSnapshot:Gt,cancelSnapshot:ot,atmosphere:D,layers:j,activeLayerId:R,setActiveLayerId:B,addLayer:Fe,removeLayer:ze,toggleLayerVisibility:Ce,toggleLayerGlow:qe,setPaperTexture:Pe}},fr={Standard:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 1 0","Kodak 2383":"1.1 0 0 0 -0.05  0 1.05 0 0 -0.02  0 0 0.9 0 0.05  0 0 0 1 0","Kodak Portra 400":"1.05 0 0 0 0.03  0 1.02 0 0 0.02  0 0 0.95 0 -0.02  0 0 0 1 0","Kodak Ektar 100":"1.3 0 0 0 -0.15  0 1.2 0 0 -0.1  0 0 1.1 0 -0.05  0 0 0 1 0","Cinestill 800T":"0.9 0 0 0 0  0 1.0 0 0 0.05  0 0 1.2 0 0.1  0 0 0 1 0","Fuji Velvia 50":"1.0 0 0 0 0  0 0.9 0 0 0  0 0 1.1 0 0.05  0 0 0 1 0","Ilford HP5 Plus":"0.33 0.33 0.33 0 0  0.33 0.33 0.33 0 0  0.33 0.33 0.33 0 0  0 0 0 1 0"},Ht=e=>{if(!e)return{r:0,g:0,b:0};if(e.startsWith("#"))return Ct(e);const l=e.match(/\d+/g);return l&&l.length>=3?{r:Number(l[0]),g:Number(l[1]),b:Number(l[2])}:{r:0,g:0,b:0}},Ar=e=>{const l=e,w=.5-.5*l;return`${l} 0 0 0 ${w}  0 ${l} 0 0 ${w}  0 0 ${l} 0 ${w}  0 0 0 1 0`},cr=(e,l=3)=>{let w=0,i=1,h=1,a=0;for(let $=0;$<l;$++)w+=Math.sin(e*h*10+$*13.2)*i,a+=i,i*=.5,h*=2.5;return w/a},fa=[{type:"streak",pos:0,baseSize:1400,height:3,color:[200,230,255],alpha:.15,blur:4},{type:"poly",sides:4,pos:.15,baseSize:40,color:[100,200,255],alpha:.4,blur:2,noise:!0},{type:"poly",sides:4,pos:.22,baseSize:25,color:[150,255,220],alpha:.3,blur:1,noise:!0},{type:"circle",pos:.45,baseSize:140,color:[200,255,150],alpha:.08,isSoft:!0},{type:"circle",pos:.6,baseSize:180,color:[220,255,100],alpha:.05,isSoft:!0},{type:"circle",pos:.85,baseSize:90,color:[255,180,100],alpha:.15,isSoft:!0,noise:!0},{type:"poly",sides:5,pos:1,baseSize:60,color:[255,100,50],alpha:.2,blur:3,noise:!0},{type:"circle",pos:1.1,baseSize:110,color:[255,50,50],alpha:.05,isSoft:!0}],jr=(e,l,w,i,h,a,$,j,Y,R,B,U)=>{if($<=.01)return;const te=B-i,Q=U-h,F=j*Y*Math.max(.8,R),ee=`rgba(255, 255, 255, ${.15*$})`;fa.forEach(D=>{const O=i+te*D.pos,ge=h+Q*D.pos,v=D.baseSize*F,m=.3,L=Math.round(D.color[0]*(1-m)+a.r*m),he=Math.round(D.color[1]*(1-m)+a.g*m),oe=Math.round(D.color[2]*(1-m)+a.b*m),Ee=D.alpha*$,Fe=`rgba(${L}, ${he}, ${oe}, ${Ee})`;if(e.save(),e.globalCompositeOperation="screen",D.type==="streak")e.translate(O,ge),D.blur&&(e.filter=`blur(${D.blur*F}px)`),e.fillStyle=Fe,e.beginPath(),e.ellipse(0,0,v,(D.height||2)*F,0,0,Math.PI*2),e.fill();else if(D.isSoft){const ze=e.createRadialGradient(O,ge,0,O,ge,v);ze.addColorStop(0,Fe),ze.addColorStop(1,`rgba(${L}, ${he}, ${oe}, 0)`),e.fillStyle=ze,e.beginPath(),e.arc(O,ge,v,0,Math.PI*2),e.fill()}else{if(D.blur&&(e.filter=`blur(${D.blur*F}px)`),e.fillStyle=Fe,e.beginPath(),D.type==="circle")e.arc(O,ge,v,0,Math.PI*2);else{const ze=D.sides||3;for(let Ce=0;Ce<ze;Ce++){const qe=Ce*2*Math.PI/ze-Math.PI/2,ie=O+v*Math.cos(qe),Qe=ge+v*Math.sin(qe);Ce===0?e.moveTo(ie,Qe):e.lineTo(ie,Qe)}e.closePath()}e.fill()}if(D.noise){e.globalCompositeOperation="overlay",e.fillStyle=ee;const ze=Math.min(10,Math.floor(v*.2));for(let Ce=0;Ce<ze;Ce++){const qe=O+(Math.random()-.5)*v,ie=ge+(Math.random()-.5)*v,Qe=(Math.random()*2+1)*F;e.fillRect(qe,ie,Qe,Qe)}}e.restore()})},on=o.forwardRef(({settings:e,onChange:l,canvasColor:w,triggerClear:i,triggerClearTape:h,triggerInvertMask:a,triggerUndo:$,triggerRedo:j,onPickColor:Y,zoom:R,pan:B,onPan:U,isSpacePressed:te,customTextureUrl:Q,grayscaleMode:F,onLayerMethodsReady:ee,width:D,height:O,washTemp:ge,washIntensity:v,isMobile:m},L)=>{const he=o.useRef(new Map),oe=o.useRef(null),Ee=o.useRef(null),Fe=o.useRef(null),ze=o.useRef(null),Ce=o.useRef(null),qe=o.useRef(null),ie=o.useRef(null),Qe=o.useRef(null),[V,z]=o.useState(null),[X,Pe]=o.useState(null),[Ae,be]=o.useState(null),[Ze,pt]=o.useState([]),[kt,Lt]=o.useState(!1),[dt,Ft]=o.useState(null),[St,Rt]=o.useState(null),ut=o.useRef(null),ne=o.useRef(!1),Ie=o.useRef({x:0,y:0}),[xe,Ve]=o.useState(!1),[De,vt]=o.useState(!1),[$e,Et]=o.useState(!1),[gt,It]=o.useState(null),[Dt,Gt]=o.useState(null),ot=o.useRef(!0),At=o.useRef(0),r=o.useMemo(()=>m?1:window.devicePixelRatio||1,[m]),s={r:255,g:160,b:60},c={r:40,g:70,b:110},f=o.useMemo(()=>{if(v<=.01)return w;const d=Ct(w),I=at(c,s,ge),k=at(d,I,v*.3);return tr(k.r,k.g,k.b)},[w,ge,v]),{init:g,startStroke:M,endStroke:y,drawBatch:p,clear:P,pickColor:b,drawTape:E,drawLasso:x,drawLassoFill:A,drawRectLassoFill:J,drawStippleLasso:_,drawPatternLasso:H,drawPatternLine:T,drawGradBlendLasso:ae,capturePattern:ue,clearMask:ve,invertMask:se,renderBrushCursor:K,undo:n,redo:S,drawSkyGradient:q,commitSnapshot:me,cancelSnapshot:Z,atmosphere:C,layers:G,activeLayerId:re,setActiveLayerId:ce,addLayer:Ue,removeLayer:Ye,toggleLayerVisibility:je,toggleLayerGlow:We,setPaperTexture:ye}=ua(e,f,D,O,r),ke=o.useRef(e),pe=o.useRef(C),Te=o.useRef(G),lt=o.useRef(null);o.useEffect(()=>{ke.current=e},[e]),o.useEffect(()=>{pe.current=C},[C]),o.useEffect(()=>{Te.current=G,ot.current=!0},[G]),o.useEffect(()=>{ot.current=!0},[e.waterLayerReflections]),o.useEffect(()=>{const d=k=>{k.key==="Alt"&&vt(!0)},I=k=>{k.key==="Alt"&&vt(!1)};return window.addEventListener("keydown",d),window.addEventListener("keyup",I),()=>{window.removeEventListener("keydown",d),window.removeEventListener("keyup",I)}},[]),o.useEffect(()=>{i>0&&(P(),ot.current=!0)},[i,P]),o.useEffect(()=>{$>0&&(n(),ot.current=!0)},[$,n]),o.useEffect(()=>{j>0&&(S(),ot.current=!0)},[j,S]),o.useEffect(()=>{h>0&&(ve(),ot.current=!0)},[h,ve]),o.useEffect(()=>{a>0&&(se(),ot.current=!0)},[a,se]),o.useEffect(()=>{oe.current&&g(I=>he.current.get(I)||null,oe.current),ie.current||(ie.current=document.createElement("canvas")),Qe.current||(Qe.current=document.createElement("canvas"))},[g,G,D,O]),o.useEffect(()=>{(async()=>{let I;if(Q){const k=new Image;k.crossOrigin="Anonymous",k.src=Q,await new Promise(W=>{k.onload=W}),I=nn(k,D,O)}else I=await oa(D,O);I&&(z(I.visual.toDataURL()),ye(I.heightMap))})()},[Q,D,O,ye]),o.useEffect(()=>{const d=r;Ce.current&&(Ce.current.width=D*d,Ce.current.height=O*d)},[D,O,r]);const et=o.useMemo(()=>({layers:G,activeLayerId:re,setActiveLayerId:ce,addLayer:Ue,removeLayer:Ye,toggleLayerVisibility:je,toggleLayerGlow:We}),[G,re,ce,Ue,Ye,je,We]);o.useEffect(()=>{ee&&ee(et)},[et,ee]),o.useEffect(()=>{e.isGradientMode&&ut.current&&q(ut.current.start,ut.current.end,!0)},[e.gradientTime,e.gradientHumidity,e.isGradientMode]),o.useEffect(()=>{e.isGradientMode||(me(),ut.current=null)},[e.isGradientMode,me]);const it=(d,I,k,W,fe,Xe,N,Ke,$t)=>{const Ge=I/(D||1),ht=k-W,st=e.waterTurbulenceX,de=e.waterTurbulenceY,we=e.waterFractal,Oe=D||1,Re=60+Math.floor(we*100),_e=1+Math.floor(we*3),Je=(30+st*120)*e.skyScale*(I/Oe);if(d.save(),d.beginPath(),d.rect(0,W,I,k-W),d.clip(),e.waterEnabled&&e.waterLayerReflections){const Le=ie.current;if(Le){const Ne=Math.floor(I*.5),Me=Math.floor(k*.5),bt=Le.width!==Ne||Le.height!==Me;bt&&(Le.width=Ne,Le.height=Me);const xt=Math.abs(At.current-W)>.5,Se=bt||xt||ot.current,nt=Le.getContext("2d");if(nt){Se&&(nt.clearRect(0,0,Ne,Me),nt.save(),nt.scale(.5,.5),nt.translate(0,W*3),nt.scale(1,-2),G.forEach(wt=>{if(wt.visible){const Pt=he.current.get(wt.id);Pt&&nt.drawImage(Pt,0,0,I,k)}}),nt.restore(),ot.current=!1,At.current=W),d.save(),d.globalAlpha=.8*e.waterOpacity;const Mt=(de*8+2)*Ge;d.filter=`blur(${Mt}px)`;for(let wt=0;wt<Re;wt++){const Pt=wt/Re,Qt=Pt+cr(Pt*10,2)*de*.1;if(Qt<0)continue;const or=W+Qt*ht,dr=(wt+1)/Re,vr=dr+cr(dr*10,2)*de*.1,sn=W+vr*ht,Tr=Math.max(1,sn-or+.5),cn=cr(Pt*10+wt*.5,_e)*st*60*e.skyScale*Ge,Rr=(W+Pt*ht)*.5;or<k&&Rr<Me&&d.drawImage(Le,0,Rr,Ne,Math.max(1,Tr*.5),cn,or,I,Tr)}d.restore()}}}if(e.sunElevation>-.04){d.save(),d.globalCompositeOperation="destination-out";const Le=Je*1.5,Ne=d.createLinearGradient(fe-Le,0,fe+Le,0);Ne.addColorStop(0,"rgba(0,0,0,0)"),Ne.addColorStop(.3,"rgba(0,0,0,0.2)"),Ne.addColorStop(.5,"rgba(0,0,0,1)"),Ne.addColorStop(.7,"rgba(0,0,0,0.2)"),Ne.addColorStop(1,"rgba(0,0,0,0)"),d.fillStyle=Ne,d.fillRect(0,W,I,k-W),d.restore()}d.save(),d.globalCompositeOperation="destination-over",d.translate(0,W*2),d.scale(1,-1),d.fillStyle=N,d.fillRect(0,W,I,k),d.restore();const ct=.5*e.waterOpacity;if(d.fillStyle=`rgba(10, 30, 60, ${ct})`,d.globalCompositeOperation="multiply",d.fillRect(0,W,I,k-W),e.sunElevation>-.04){d.save(),d.globalCompositeOperation="color-dodge";const Le=Math.max(0,1-Math.max(0,e.sunElevation)/.8),Ne=d.createLinearGradient(0,W,0,W+ht),bt=e.sunElevation<.1?Ke:"white";Ne.addColorStop(0,bt),Ne.addColorStop(.1+Le*.2,Ke),Ne.addColorStop(1,"transparent"),d.fillStyle=Ne,d.shadowColor=Ke,d.shadowBlur=20*Le*Ge;for(let xt=0;xt<Re;xt++){const Se=xt/Re,nt=Se+cr(Se*10,2)*de*.1;if(nt<0||nt>1)continue;const Mt=W+nt*ht,wt=Math.max(0,1-Se/(Le+.1));if(wt>.01){d.globalAlpha=wt*e.waterOpacity;const Pt=1+Se*4,Qt=cr(Se*10+xt*.5,_e),or=Qt*st*Je*Pt*.5,dr=Math.max(.1,Je*Pt*(.5+Math.abs(Qt)*.5)),vr=Math.max(.5,k/80*(1+Se*2)*(1+de));d.beginPath(),d.ellipse(fe+or,Mt,dr/2,vr/2,0,0,Math.PI*2),d.fill()}}d.restore()}const mt=(e.waterTurbulenceX+e.waterTurbulenceY)/2;mt>.1&&(d.globalCompositeOperation="overlay",d.fillStyle=`rgba(255,255,255,${mt*.1*e.waterOpacity})`,d.fillRect(0,W,I,k-W));const yt=40*Ge,He=d.createLinearGradient(0,W,0,W+yt);He.addColorStop(0,$t),He.addColorStop(1,"rgba(0,0,0,0)"),d.save(),d.globalCompositeOperation="source-over",d.fillStyle=He,d.fillRect(0,W,I,yt),d.restore(),d.restore()};o.useEffect(()=>{lt.current=it}),o.useEffect(()=>{let d;const I=()=>{const k=r,W=Ee.current,fe=W==null?void 0:W.getContext("2d"),Xe=Fe.current,N=Xe==null?void 0:Xe.getContext("2d"),Ke=ke.current,$t=pe.current;if(Te.current,Ke.skyEnabled&&W&&fe&&$t.skyColors){(W.width!==D*k||W.height!==O*k)&&(W.width=D*k,W.height=O*k,fe.setTransform(k,0,0,k,0,0)),Xe&&(Xe.width!==D*k||Xe.height!==O*k)&&(Xe.width=D*k,Xe.height=O*k,N==null||N.setTransform(k,0,0,k,0,0));const{stops:Be,sun:Ge,sunX:ht,sunY:st,ground:de}=$t.skyColors,we=Ke.skyHorizon*100,Oe=Ke.skyScale,Re=O*Ke.skyHorizon,_e=we-60*Oe,Je=we-30*Oe,ct=we-12*Oe,mt=we,yt=we+.4*(100-we),He=fe.createLinearGradient(0,0,0,O),Le=Ne=>Math.max(0,Math.min(1,Ne/100));if(He.addColorStop(Le(0),Be[0].color),He.addColorStop(Le(_e),Be[1].color),He.addColorStop(Le(Je),Be[2].color),He.addColorStop(Le(ct),Be[3].color),He.addColorStop(Le(mt),Be[4].color),de&&(He.addColorStop(Le(Math.min(100,yt)),de),He.addColorStop(1,de)),fe.globalCompositeOperation="source-over",fe.fillStyle=He,fe.fillRect(0,0,D,O),Ke.sunEnabled){const Ne=Qe.current;if(Ne){if(Ne.width!==W.width||Ne.height!==W.height){Ne.width=W.width,Ne.height=W.height;const bt=Ne.getContext("2d");bt&&bt.setTransform(k,0,0,k,0,0)}const Me=Ne.getContext("2d");if(Me){Me.clearRect(0,0,D,O),Me.save();const bt=90*Ke.skyScale/2;let xt=1;if(st+bt>Re){const Mt=st+bt-Re;xt=Math.max(.6,1-Mt/(bt*2)*.5)}Me.translate(ht,st),Me.scale(1,xt),Me.translate(-ht,-st),Me.shadowBlur=Ke.sunDiffusion>.5?40:10,Me.shadowColor=Ge,Me.fillStyle=Ge,Me.beginPath(),Me.arc(ht,st,bt,0,Math.PI*2),Me.fill(),Me.restore(),Me.save(),Me.globalCompositeOperation="destination-out";const Se=20*Ke.skyScale,nt=Me.createLinearGradient(0,Re,0,Re+Se);nt.addColorStop(0,"rgba(0,0,0,0.2)"),nt.addColorStop(1,"rgba(0,0,0,1)"),Me.fillStyle=nt,Me.fillRect(0,Re,D,Se*2),Me.fillStyle="black",Me.fillRect(0,Re+Se,D,O-(Re+Se)),Me.restore(),fe.save(),fe.globalCompositeOperation="source-over",fe.drawImage(Ne,0,0,D,O),fe.restore()}}}oe.current&&(fe.globalCompositeOperation="destination-out",fe.drawImage(oe.current,0,0,D,O),fe.globalCompositeOperation="source-over"),N&&(N.clearRect(0,0,D,O),Ke.waterEnabled&&lt.current&&(lt.current(N,D,O,Re,ht,st,He,Ge,Be[4].color),oe.current&&(N.globalCompositeOperation="destination-out",N.drawImage(oe.current,0,0,D,O),N.globalCompositeOperation="source-over")))}else if(Ee.current){const Be=Ee.current.getContext("2d");if(Be&&Be.clearRect(0,0,Ee.current.width,Ee.current.height),Fe.current){const Ge=Fe.current.getContext("2d");Ge&&Ge.clearRect(0,0,Fe.current.width,Fe.current.height)}}d=requestAnimationFrame(I)};return I(),()=>cancelAnimationFrame(d)},[D,O,r]),o.useEffect(()=>{const d=ze.current;if(!d)return;const I=d.getContext("2d");if(!I)return;const k=r;if(d.width!==D*k||d.height!==O*k?(d.width=D*k,d.height=O*k,I.setTransform(k,0,0,k,0,0)):I.clearRect(0,0,D,O),e.skyEnabled&&e.lensFlareEnabled&&C.skyColors&&e.sunEnabled){const{sunX:W,sunY:fe,sun:Xe}=C.skyColors;let N,Ke;if(e.flareTipPos?(N=e.flareTipPos.x*D,Ke=e.flareTipPos.y*O):(N=D-W,Ke=O-fe),e.lensFlareHandleEnabled&&!e.flareTipPos&&l){const Be=N/D,Ge=Ke/O;setTimeout(()=>l({...e,flareTipPos:{x:Be,y:Ge}}),0)}const $t=Ht(Xe);jr(I,D,O,W,fe,$t,e.lensFlareIntensity,1,e.lensFlareScale||1,e.skyScale,N,Ke)}},[e.skyEnabled,e.sunEnabled,e.lensFlareEnabled,e.lensFlareIntensity,e.lensFlareScale,e.lensFlareHandleEnabled,e.flareTipPos,e.skyScale,C.skyColors,D,O,r]);const Nt=e.skyEnabled&&e.sunEnabled&&e.lensFlareEnabled&&e.lensFlareHandleEnabled&&C.skyColors;let ft=0,Bt=0;C.skyColors&&(e.flareTipPos?(ft=e.flareTipPos.x*D,Bt=e.flareTipPos.y*O):(ft=D-C.skyColors.sunX,Bt=O-C.skyColors.sunY));const Ot=d=>{if(d.button===1||te){ne.current=!0,Ie.current={x:d.clientX,y:d.clientY};return}if(Nt){const Xe=d.currentTarget.getBoundingClientRect(),N=(d.clientX-Xe.left)/R,Ke=(d.clientY-Xe.top)/R;if((N-ft)**2+(Ke-Bt)**2<900){Ve(!0),d.currentTarget.setPointerCapture(d.pointerId);return}}const I=d.currentTarget.getBoundingClientRect(),k=(d.clientX-I.left)/R,W=(d.clientY-I.top)/R;if(d.altKey||De){const Xe=b(k,W);Xe&&Y(Xe),d.currentTarget.setPointerCapture(d.pointerId);return}Et(!0);const fe=d.pressure||.5;e.isGradientMode?(Ft({x:k,y:W}),Rt({x:k,y:W})):e.isTapeMode||e.isPatternLine?(Pe({x:k,y:W}),be({x:k,y:W})):e.isRectLassoFill?(It({x:k,y:W}),Gt({x:k,y:W})):e.isLassoMode||e.isLassoFill||e.isStippleFill||e.isPatternLasso||e.isGradBlend?(Lt(!0),pt([{x:k,y:W}])):M(k,W,fe,d.tiltX,d.tiltY),d.currentTarget.setPointerCapture(d.pointerId)},tt=d=>{if(ne.current){const fe=d.clientX-Ie.current.x,Xe=d.clientY-Ie.current.y;U(fe,Xe),Ie.current={x:d.clientX,y:d.clientY};return}const I=d.currentTarget.getBoundingClientRect(),k=(d.clientX-I.left)/R,W=(d.clientY-I.top)/R;if(xe){const fe=k/D,Xe=W/O;l&&l({...e,flareTipPos:{x:fe,y:Xe}});return}if(Ce.current&&!ne.current){const fe=Ce.current.getContext("2d");fe&&K(fe,k,W,d.pressure,d.tiltX,d.tiltY)}if((d.altKey||De)&&d.buttons===1){const fe=b(k,W);fe&&Y(fe);return}if(e.isGradientMode&&dt)Rt({x:k,y:W}),ut.current={start:dt,end:{x:k,y:W}},q(dt,{x:k,y:W},!0);else if((e.isTapeMode||e.isPatternLine)&&X)be({x:k,y:W});else if(e.isRectLassoFill&&gt)Gt({x:k,y:W});else if((e.isLassoMode||e.isLassoFill||e.isStippleFill||e.isPatternLasso||e.isGradBlend)&&kt)pt(fe=>[...fe,{x:k,y:W}]);else if(d.buttons===1){const Xe=(d.nativeEvent instanceof PointerEvent&&d.nativeEvent.getCoalescedEvents?d.nativeEvent.getCoalescedEvents():[d.nativeEvent]).map(N=>{const Ke=(N.clientX-I.left)/R,$t=(N.clientY-I.top)/R;return{x:Ke,y:$t,pressure:N.pressure||.5,tiltX:N.tiltX,tiltY:N.tiltY}});p(Xe),ot.current=!0}},jt=d=>{if(ne.current=!1,Et(!1),xe){Ve(!1),d.currentTarget.releasePointerCapture(d.pointerId);return}if(d.altKey||De){d.currentTarget.releasePointerCapture(d.pointerId);return}const I=(d.clientX-d.currentTarget.getBoundingClientRect().left)/R,k=(d.clientY-d.currentTarget.getBoundingClientRect().top)/R;e.isGradientMode&&dt?(q(dt,{x:I,y:k},!1),Ft(null),Rt(null)):e.isTapeMode&&X?(E(X.x,X.y,I,k),Pe(null),be(null)):e.isPatternLine&&X?(T(X.x,X.y,I,k),Pe(null),be(null)):e.isRectLassoFill&&gt?(J(gt,{x:I,y:k}),It(null),Gt(null)):(e.isLassoMode||e.isLassoFill||e.isStippleFill||e.isPatternLasso||e.isGradBlend)&&kt?(Lt(!1),e.isLassoFill?A(Ze):e.isStippleFill?_(Ze):e.isPatternLasso?H(Ze):e.isGradBlend?ae(Ze):x(Ze),pt([])):y(),ot.current=!0,d.currentTarget.releasePointerCapture(d.pointerId)},Xt=d=>{if(Ce.current){const I=Ce.current.getContext("2d");I&&I.clearRect(0,0,Ce.current.width,Ce.current.height)}},Wt=te||ne.current?"cursor-grab active:cursor-grabbing":De||e.isGradientMode||e.isTapeMode||e.isLassoMode||e.isLassoFill||e.isStippleFill||e.isPatternLasso||e.isPatternLine||e.isRectLassoFill||e.isGradBlend?"cursor-crosshair":"cursor-none",wr=Ze.map(d=>`${d.x},${d.y}`).join(" "),rr=e.filmEnabled,[Kt]=o.useState(()=>Math.random().toString(36).slice(2,9)),Vt=`film-${Kt}`,Ut=`pictorialism-${Kt}`,Yt=`riso-${Kt}`,Jt=`ca-${Kt}`,zt=o.useMemo(()=>{if(!rr)return null;const d=fr[e.filmStock]||fr.Standard,I=1+e.filmDensity*1.5,k=1+e.filmDensity*.5,W=-(.5*k)+.5,fe=2+e.filmHalation*3,Xe=5+e.filmBloom*10,N=e.filmGrain,Ke=`1 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 ${e.filmHalation} 0`,$t=Ar(N),Be=Math.max(.15,.5-N*.35);return u("filter",{id:Vt,colorInterpolationFilters:"sRGB",x:"0%",y:"0%",width:"100%",height:"100%",children:[t("feColorMatrix",{in:"SourceGraphic",type:"matrix",values:d,result:"graded"}),t("feColorMatrix",{in:"graded",type:"saturate",values:String(I),result:"saturated"}),u("feComponentTransfer",{in:"saturated",result:"densified",children:[t("feFuncR",{type:"linear",slope:k,intercept:W}),t("feFuncG",{type:"linear",slope:k,intercept:W}),t("feFuncB",{type:"linear",slope:k,intercept:W})]}),t("feColorMatrix",{in:"densified",type:"matrix",values:"0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0",result:"luminance"}),u("feComponentTransfer",{in:"luminance",result:"highlights",children:[t("feFuncR",{type:"linear",slope:"3",intercept:"-1.5"}),t("feFuncG",{type:"linear",slope:"3",intercept:"-1.5"}),t("feFuncB",{type:"linear",slope:"3",intercept:"-1.5"})]}),t("feGaussianBlur",{in:"highlights",stdDeviation:fe,result:"highlightBlur"}),t("feColorMatrix",{in:"highlightBlur",type:"matrix",values:Ke,result:"redHalation"}),t("feGaussianBlur",{in:"densified",stdDeviation:Xe,result:"bloom"}),t("feColorMatrix",{in:"bloom",type:"matrix",values:`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${e.filmBloom} 0`,result:"fadedBloom"}),t("feTurbulence",{type:"fractalNoise",baseFrequency:`${Be}`,numOctaves:"3",stitchTiles:"stitch",result:"rawNoise"}),t("feColorMatrix",{in:"rawNoise",type:"matrix",values:$t,result:"coloredGrain"}),t("feBlend",{mode:"screen",in:"redHalation",in2:"densified",result:"step1"}),t("feBlend",{mode:"screen",in:"fadedBloom",in2:"step2",result:"step2"}),t("feBlend",{mode:"overlay",in:"coloredGrain",in2:"step2",result:"final"})]})},[rr,e.filmStock,e.filmDensity,e.filmHalation,e.filmBloom,e.filmGrain,Vt]),nr=o.useMemo(()=>{const d="0.1 0.15 0.25 0.40 0.55 0.70 0.82 0.90 0.95 0.97 0.98 0.99 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0",I=.05+e.pictorialismNoise*.2,k=.5+e.pictorialismSoftness*4;return u("filter",{id:Ut,colorInterpolationFilters:"sRGB",x:"0%",y:"0%",width:"100%",height:"100%",children:[t("feColorMatrix",{type:"matrix",values:"0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0",result:"luma"}),u("feComponentTransfer",{in:"luma",result:"exposed",children:[t("feFuncR",{type:"linear",slope:"0.574"}),t("feFuncG",{type:"linear",slope:"0.574"}),t("feFuncB",{type:"linear",slope:"0.574"})]}),u("feComponentTransfer",{in:"exposed",result:"toneMapped",children:[t("feFuncR",{type:"table",tableValues:d}),t("feFuncG",{type:"table",tableValues:d}),t("feFuncB",{type:"table",tableValues:d})]}),t("feGaussianBlur",{in:"toneMapped",stdDeviation:`${k}`,result:"blurred"}),t("feColorMatrix",{in:"blurred",type:"matrix",values:"1.00 0 0 0 0  0 0.97 0 0 0  0 0 0.84 0 0  0 0 0 1 0",result:"tinted"}),t("feTurbulence",{type:"fractalNoise",baseFrequency:"0.8",numOctaves:"3",stitchTiles:"stitch",result:"grain"}),t("feColorMatrix",{in:"grain",type:"matrix",values:"1 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 0 1 0",result:"monoGrain"}),t("feComponentTransfer",{in:"monoGrain",result:"softGrain",children:t("feFuncA",{type:"linear",slope:`${I}`})}),t("feBlend",{mode:"overlay",in:"softGrain",in2:"tinted",result:"grained"}),t("feFlood",{floodColor:"#000000",result:"black"}),t("feDiffuseLighting",{in:"black",lightingColor:"white",surfaceScale:"0",diffuseConstant:"1",result:"vignetteMap",children:t("fePointLight",{x:"50%",y:"50%",z:"600"})}),t("feBlend",{mode:"multiply",in:"grained",in2:"vignetteMap",result:"final"})]})},[Ut,e.pictorialismNoise,e.pictorialismSoftness]),rt=o.useMemo(()=>{const d=Ht(e.risoColor1),I=Ht(e.risoColor2),k={r:d.r/255,g:d.g/255,b:d.b/255},W={r:I.r/255,g:I.g/255,b:I.b/255},fe=e.risoGrainScale;return u("filter",{id:Yt,colorInterpolationFilters:"sRGB",x:"0%",y:"0%",width:"100%",height:"100%",children:[t("feColorMatrix",{in:"SourceGraphic",type:"matrix",values:"0 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0",result:"sourceAlpha"}),t("feColorMatrix",{in:"SourceGraphic",type:"matrix",values:"0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0",result:"luma"}),t("feTurbulence",{type:"fractalNoise",baseFrequency:`${fe}`,numOctaves:"1",stitchTiles:"stitch",result:"noise"}),t("feColorMatrix",{type:"matrix",values:"1 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 0 1 0",in:"noise",result:"grayNoise"}),t("feComposite",{operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"-0.5",in:"luma",in2:"grayNoise",result:"screened"}),u("feComponentTransfer",{in:"screened",result:"binaryHalftone",children:[t("feFuncR",{type:"linear",slope:"20",intercept:"-10"}),t("feFuncG",{type:"linear",slope:"20",intercept:"-10"}),t("feFuncB",{type:"linear",slope:"20",intercept:"-10"})]}),u("feComponentTransfer",{in:"binaryHalftone",result:"duotone",children:[t("feFuncR",{type:"table",tableValues:`${k.r} ${W.r}`}),t("feFuncG",{type:"table",tableValues:`${k.g} ${W.g}`}),t("feFuncB",{type:"table",tableValues:`${k.b} ${W.b}`})]}),t("feComposite",{operator:"in",in:"duotone",in2:"sourceAlpha",result:"final"})]})},[Yt,e.risoGrainScale,e.risoColor1,e.risoColor2]),_t=o.useMemo(()=>{const d=e.chromaticAberrationIntensity*20;return u("filter",{id:Jt,colorInterpolationFilters:"sRGB",x:"-10%",y:"-10%",width:"120%",height:"120%",children:[t("feColorMatrix",{type:"matrix",values:"1 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0",in:"SourceGraphic",result:"red"}),t("feOffset",{in:"red",dx:`${d}`,dy:"0",result:"red_shifted"}),t("feColorMatrix",{type:"matrix",values:"0 0 0 0 0  0 1 0 0 0  0 0 0 0 0  0 0 0 1 0",in:"SourceGraphic",result:"green"}),t("feColorMatrix",{type:"matrix",values:"0 0 0 0 0  0 0 0 0 0  0 0 1 0 0  0 0 0 1 0",in:"SourceGraphic",result:"blue"}),t("feOffset",{in:"blue",dx:`${-d}`,dy:"0",result:"blue_shifted"}),t("feBlend",{mode:"screen",in:"red_shifted",in2:"green",result:"rg"}),t("feBlend",{mode:"screen",in:"rg",in2:"blue_shifted",result:"final"})]})},[Jt,e.chromaticAberrationIntensity]),Zt=o.useMemo(()=>e.risoEnabled?`url(#${Yt})`:"none",[e.risoEnabled,Yt]),ar=o.useMemo(()=>{if(m&&$e)return"none";const d=[];return e.chromaticAberrationEnabled&&d.push(`url(#${Jt})`),e.filmEnabled&&(e.filmDensity!==0||e.filmHalation!==0||e.filmBloom!==0||e.filmGrain!==0||e.filmStock!=="Standard")&&d.push(`url(#${Vt})`),e.pictorialismEnabled&&d.push(`url(#${Ut})`),d.length>0?d.join(" "):"none"},[e.filmEnabled,e.filmDensity,e.filmHalation,e.filmBloom,e.filmGrain,e.filmStock,Vt,e.chromaticAberrationEnabled,Jt,e.pictorialismEnabled,Ut,m,$e]);return o.useImperativeHandle(L,()=>({capturePattern:()=>ue(),downloadImage:d=>{const I=(d==null?void 0:d.width)||D,k=(d==null?void 0:d.height)||O,W=Be=>{const Ge=document.createElement("a");Ge.download=`gouache-${Date.now()}.png`,Ge.href=Be.toDataURL("image/png"),document.body.appendChild(Ge),Ge.click(),document.body.removeChild(Ge)},fe=I/D,Xe=document.createElement("canvas");Xe.width=I,Xe.height=k;const N=Xe.getContext("2d");if(!N)return;N.imageSmoothingEnabled=!0,N.imageSmoothingQuality="high",N.globalCompositeOperation="source-over",N.globalAlpha=1,N.fillStyle=f,N.fillRect(0,0,I,k);const Ke=Be=>{const Ge=document.createElement("canvas");Ge.width=I,Ge.height=k;const ht=Ge.getContext("2d");if(ht)if(G.forEach(st=>{if(st.visible&&st.ignoreGlow===Be){const de=he.current.get(st.id);de&&ht.drawImage(de,0,0,I,k)}}),e.risoEnabled){const st=`riso-export-${Be?"glow":"norm"}-${Date.now()}`,de=Ht(e.risoColor1),we=Ht(e.risoColor2),Oe={r:de.r/255,g:de.g/255,b:de.b/255},Re={r:we.r/255,g:we.g/255,b:we.b/255},_e=e.risoGrainScale/fe,Je=`<svg xmlns="http://www.w3.org/2000/svg" style="display:none;">
                  <filter id="${st}" color-interpolation-filters="sRGB" x="0%" y="0%" width="100%" height="100%">
                    <feColorMatrix in="SourceGraphic" type="matrix" values="0 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0" result="sourceAlpha"/>
                    <feColorMatrix in="SourceGraphic" type="matrix" values="0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0" result="luma"/>
                    <feTurbulence type="fractalNoise" baseFrequency="${_e}" numOctaves="1" stitchTiles="stitch" result="noise"/>
                    <feColorMatrix type="matrix" values="1 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 0 1 0" in="noise" result="grayNoise"/>
                    <feComposite operator="arithmetic" k1="0" k2="1" k3="1" k4="-0.5" in="luma" in2="grayNoise" result="screened"/>
                    <feComponentTransfer in="binaryHalftone" result="binaryHalftone">
                        <feFuncR type="linear" slope="20" intercept="-10"/><feFuncG type="linear" slope="20" intercept="-10"/><feFuncB type="linear" slope="20" intercept="-10"/>
                    </feComponentTransfer>
                    <feComponentTransfer in="binaryHalftone" result="duotone">
                       <feFuncR type="table" tableValues="${Oe.r} ${Re.r}"/><feFuncG type="table" tableValues="${Oe.g} ${Re.g}"/><feFuncB type="table" tableValues="${Oe.b} ${Re.b}"/>
                    </feComponentTransfer>
                    <feComposite operator="in" in="duotone" in2="sourceAlpha" result="final"/>
                  </filter>
                </svg>`,ct=document.createElement("div");ct.innerHTML=Je,document.body.appendChild(ct),N.save(),N.filter=`url(#${st})`,N.drawImage(Ge,0,0),N.restore(),document.body.removeChild(ct)}else N.drawImage(Ge,0,0)};if(e.skyEnabled&&C.skyColors){const{stops:Be,sun:Ge,sunX:ht,sunY:st,ground:de}=C.skyColors,we=e.skyHorizon*100,Oe=e.skyScale,Re=k*e.skyHorizon,_e=0,Je=we-60*Oe,ct=we-30*Oe,mt=we-12*Oe,yt=we,He=xt=>Math.max(0,Math.min(1,xt/100)),Le=N.createLinearGradient(0,0,0,k);Le.addColorStop(He(_e),Be[0].color),Le.addColorStop(He(Je),Be[1].color),Le.addColorStop(He(ct),Be[2].color),Le.addColorStop(He(mt),Be[3].color),Le.addColorStop(He(yt),Be[4].color),de&&(Le.addColorStop(He(Math.min(100,we+.4*(100-we))),de),Le.addColorStop(1,de)),N.fillStyle=Le,N.fillRect(0,0,I,k);const Ne=ht/D*I,Me=st/O*k,bt=90*e.skyScale*fe/2;if(e.sunEnabled){const xt=document.createElement("canvas");xt.width=I,xt.height=k;const Se=xt.getContext("2d");if(Se){Se.save();let nt=1;if(Me+bt>Re){const Pt=Me+bt-Re;nt=Math.max(.6,1-Pt/(bt*2)*.5)}Se.translate(Ne,Me),Se.scale(1,nt),Se.translate(-Ne,-Me),Se.shadowColor=Ge,Se.shadowBlur=(e.sunDiffusion>.5?40:10)*fe,Se.beginPath(),Se.arc(Ne,Me,bt,0,Math.PI*2),Se.fillStyle=Ge,Se.fill(),Se.restore(),Se.save(),Se.globalCompositeOperation="destination-out";const Mt=20*e.skyScale*fe,wt=Se.createLinearGradient(0,Re,0,Re+Mt);wt.addColorStop(0,"rgba(0,0,0,0.2)"),wt.addColorStop(1,"rgba(0,0,0,1)"),Se.fillStyle=wt,Se.fillRect(0,Re,I,Mt*2),Se.fillStyle="black",Se.fillRect(0,Re+Mt,I,k-(Re+Mt)),Se.restore(),N.drawImage(xt,0,0)}}oe.current&&(N.save(),N.globalCompositeOperation="destination-out",N.drawImage(oe.current,0,0,I,k),N.restore()),e.waterEnabled&&(it(N,I,k,Re,Ne,Me,Le,Ge,Be[4].color),oe.current&&(N.save(),N.globalCompositeOperation="destination-out",N.drawImage(oe.current,0,0,I,k),N.restore())),N.globalCompositeOperation="destination-over",N.fillStyle=f,N.fillRect(0,0,I,k),N.globalCompositeOperation="source-over"}else N.fillStyle=f,N.fillRect(0,0,I,k);const $t=Be=>{if(N.globalAlpha=1,N.globalCompositeOperation="source-over",Be){N.save(),N.globalCompositeOperation="multiply",N.globalAlpha=.4;const de=N.createPattern(Be,"repeat");de?(N.fillStyle=de,N.fillRect(0,0,I,k)):N.drawImage(Be,0,0,I,k),N.restore()}if(Ke(!1),e.skyEnabled&&C.skyColors&&e.sunEnabled){const{sunX:de,sunY:we,sun:Oe,stops:Re}=C.skyColors,_e=de/D*I,Je=we/O*k,ct=e.sunIntensity,mt=e.sunDiffusion,yt=(15+ct*25)*fe,He=e.atmosphereDensity??.5,Ne=(20+He*300*ct*mt)*fe,Me=yt+Ne,bt=Ht(Oe),xt=Ht(Re[3].color);let Se=at(bt,xt,Math.min(1,He+.2));if(mt<.5){const Pt=(.5-mt)*2;Se=at(Se,{r:255,g:40,b:10},Pt*.8)}const nt=`rgba(${Se.r}, ${Se.g}, ${Se.b}`,Mt=N.createRadialGradient(_e,Je,0,_e,Je,Me);Mt.addColorStop(0,Oe),Mt.addColorStop(yt/Me,`${nt}, ${.8*(1-mt*.4)})`),Mt.addColorStop(1,`${nt}, 0)`);const wt=k*e.skyHorizon;N.save(),N.beginPath(),N.rect(0,0,I,wt),N.clip(),N.globalCompositeOperation="color-dodge",N.globalAlpha=.8+ct*.2,N.fillStyle=Mt,N.fillRect(_e-Me,Je-Me,Me*2,Me*2),N.restore()}if(N.globalAlpha=1,Ke(!0),C.ambientParams){const de=C.ambientParams;if(N.save(),N.globalCompositeOperation=de.mixBlendMode||"source-over",N.globalAlpha=de.opacity,de.type==="gradient"&&de.gradient){const{x:we,y:Oe,stops:Re}=de.gradient,_e=we/D*I,Je=Oe/O*k,ct=Math.hypot(_e,Je),mt=Math.hypot(I-_e,Je),yt=Math.hypot(_e,k-Je),He=Math.hypot(I-_e,k-Je),Le=Math.max(ct,mt,yt,He),Ne=N.createRadialGradient(_e,Je,0,_e,Je,Le);Re.forEach(Me=>{Ne.addColorStop(Me.offset,Me.color)}),N.fillStyle=Ne}else de.type==="solid"&&de.color&&(N.fillStyle=de.color);N.fillRect(0,0,I,k),N.restore()}if(C.gradeStyles){const de=C.gradeStyles.backdropFilter||C.gradeStyles.WebkitBackdropFilter;if(de&&de!=="none"){const we=document.createElement("canvas");we.width=I,we.height=k;const Oe=we.getContext("2d");Oe&&(Oe.drawImage(Xe,0,0),N.save(),N.globalCompositeOperation="copy",N.filter=de,N.drawImage(we,0,0),N.restore(),N.filter="none")}C.gradeStyles.backgroundColor&&(N.save(),N.globalCompositeOperation=C.gradeStyles.mixBlendMode||"overlay",N.globalAlpha=(Number(C.gradeStyles.opacity)||0)*.95,N.fillStyle=C.gradeStyles.backgroundColor,N.fillRect(0,0,I,k),N.restore())}if(e.skyEnabled&&e.lensFlareEnabled&&C.skyColors&&e.sunEnabled){const{sunX:de,sunY:we,sun:Oe}=C.skyColors,Re=de/D*I,_e=we/O*k;let Je,ct;e.flareTipPos?(Je=e.flareTipPos.x*I,ct=e.flareTipPos.y*k):(Je=I-Re,ct=k-_e);const mt=document.createElement("canvas");mt.width=I,mt.height=k;const yt=mt.getContext("2d");if(yt){const He=Ht(Oe);jr(yt,I,k,Re,_e,He,e.lensFlareIntensity,1,e.lensFlareScale||1,e.skyScale,Je,ct),N.save(),N.globalCompositeOperation="color-dodge",N.drawImage(mt,0,0),N.restore()}}const Ge=[];let ht="";if(e.chromaticAberrationEnabled){const de=`ca-export-${Date.now()}`,we=e.chromaticAberrationIntensity*20*fe;ht+=`<filter id="${de}" color-interpolation-filters="sRGB" x="-10%" y="-10%" width="120%" height="120%"><feColorMatrix type="matrix" values="1 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0" in="SourceGraphic" result="red"/><feOffset in="red" dx="${we}" dy="0" result="red_shifted"/><feColorMatrix type="matrix" values="0 0 0 0 0  0 1 0 0 0  0 0 0 0 0  0 0 0 1 0" in="SourceGraphic" result="green"/><feColorMatrix type="matrix" values="0 0 0 0 0  0 0 0 0 0  0 0 1 0 0  0 0 0 1 0" in="SourceGraphic" result="blue"/><feOffset in="blue" dx="${-we}" dy="0" result="blue_shifted"/><feBlend mode="screen" in="red_shifted" in2="green" result="rg"/><feBlend mode="screen" in="rg" in2="blue_shifted" result="final"/></filter>`,Ge.push(`url(#${de})`)}const st=e.filmDensity===0&&e.filmHalation===0&&e.filmBloom===0&&e.filmGrain===0&&e.filmStock==="Standard";if(e.filmEnabled&&!st){const de=`film-export-${Date.now()}`,we=fr[e.filmStock]||fr.Standard,Oe=e.filmDensity===0?0:e.filmDensity,Re=Oe===0?1:1+Oe*1.2,_e=Oe===0?1:1+Oe*.2,Je=Oe===0?0:-(.5*_e)+.5,ct=(2+e.filmHalation*3)*fe,mt=(5+e.filmBloom*10)*fe,yt=e.filmGrain,He=Math.max(.01,Math.max(.15,.5-yt*.35)/fe),Le=`1 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 ${e.filmHalation} 0`,Ne=Ar(yt);ht+=`<filter id="${de}" color-interpolation-filters="sRGB" x="0%" y="0%" width="100%" height="100%"><feColorMatrix in="SourceGraphic" type="matrix" values="${we}" result="graded" /><feColorMatrix in="graded" type="saturate" values="${Math.max(0,Re).toFixed(3)}" result="saturated" /><feComponentTransfer in="saturated" result="densified"><feFuncR type="linear" slope="${_e.toFixed(3)}" intercept="${Je.toFixed(3)}" /><feFuncG type="linear" slope="${_e.toFixed(3)}" intercept="${Je.toFixed(3)}" /><feFuncB type="linear" slope="${_e.toFixed(3)}" intercept="${Je.toFixed(3)}" /></feComponentTransfer><feColorMatrix in="densified" type="matrix" values="0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0" result="luminance" /><feComponentTransfer in="luminance" result="highlights"><feFuncR type="linear" slope="3" intercept="-1.5"/><feFuncG type="linear" slope="3" intercept="-1.5"/><feFuncB type="linear" slope="3" intercept="-1.5"/></feComponentTransfer><feGaussianBlur in="highlights" stdDeviation="${ct}" result="highlightBlur" /><feColorMatrix in="highlightBlur" type="matrix" values="${Le}" result="redHalation" /><feGaussianBlur in="densified" stdDeviation="${mt}" result="bloom" /><feColorMatrix in="bloom" type="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${e.filmBloom} 0" result="fadedBloom" /><feTurbulence type="fractalNoise" baseFrequency="${He}" numOctaves="3" stitchTiles="stitch" result="rawNoise" /><feColorMatrix in="rawNoise" type="matrix" values="${Ne}" result="coloredGrain" /><feBlend mode="screen" in="redHalation" in2="densified" result="step1" /><feBlend mode="screen" in="fadedBloom" in2="step2" result="step2" /><feBlend mode="overlay" in="coloredGrain" in2="step2" result="final" /></filter>`,Ge.push(`url(#${de})`)}if(e.pictorialismEnabled){const de=`pic-export-${Date.now()}`,we="0.1 0.15 0.25 0.40 0.55 0.70 0.82 0.90 0.95 0.97 0.98 0.99 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0",Oe=.05+e.pictorialismNoise*.2,Re=(.5+e.pictorialismSoftness*4)*fe,_e=.8/fe;ht+=`<filter id="${de}" color-interpolation-filters="sRGB" x="0%" y="0%" width="100%" height="100%"><feColorMatrix type="matrix" values="0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0" result="luma"/><feComponentTransfer in="luma" result="exposed"><feFuncR type="linear" slope="0.574" /><feFuncG type="linear" slope="0.574" /><feFuncB type="linear" slope="0.574" /></feComponentTransfer><feComponentTransfer in="exposed" result="toneMapped"><feFuncR type="table" tableValues="${we}"/><feFuncG type="table" tableValues="${we}"/><feFuncB type="table" tableValues="${we}"/></feComponentTransfer><feGaussianBlur in="toneMapped" stdDeviation="${Re}" result="blurred"/><feColorMatrix in="blurred" type="matrix" values="1.00 0 0 0 0  0 0.97 0 0 0  0 0 0.84 0 0  0 0 0 1 0" result="tinted"/><feTurbulence type="fractalNoise" baseFrequency="${_e}" numOctaves="3" stitchTiles="stitch" result="grain"/><feColorMatrix in="grain" type="matrix" values="1 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 0 1 0" result="monoGrain"/><feComponentTransfer in="monoGrain" result="softGrain"><feFuncA type="linear" slope="${Oe}"/></feComponentTransfer><feBlend mode="overlay" in="softGrain" in2="tinted" result="grained"/><feFlood floodColor="#000000" result="black"/><feDiffuseLighting in="black" lightingColor="white" surfaceScale="0" diffuseConstant="1" result="vignetteMap"><fePointLight x="50%" y="50%" z="600" /></feDiffuseLighting><feBlend mode="multiply" in="grained" in2="vignetteMap" result="final"/></filter>`,Ge.push(`url(#${de})`)}if(Ge.length>0){const de=document.createElement("div");de.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" style="display:none;">${ht}</svg>`,document.body.appendChild(de);const we=document.createElement("canvas");we.width=I,we.height=k;const Oe=we.getContext("2d");Oe&&(Oe.drawImage(Xe,0,0),N.clearRect(0,0,I,k),N.save(),N.filter=Ge.join(" "),N.drawImage(we,0,0),N.restore()),setTimeout(()=>{document.body.removeChild(de)},100)}W(Xe)};if(V){const Be=new Image;Be.crossOrigin="Anonymous",Be.src=V,Be.onload=()=>$t(Be)}else $t()}}),[e,C,w,D,O,G,f,Ue,me]),u("div",{ref:qe,className:"absolute inset-0 bg-[#09090b] flex items-center justify-center overflow-hidden",children:[t("svg",{className:"absolute w-0 h-0 pointer-events-none",children:u("defs",{children:[zt,nr,rt,_t]})}),u("div",{className:`relative shadow-2xl ring-1 ring-white/10 origin-center ${Wt}`,style:{width:D,height:O,transform:`translate(${B.x}px, ${B.y}px) scale(${R})`,flexShrink:0,filter:F?"grayscale(100%)":"none",touchAction:"none",willChange:"transform"},onPointerDown:Ot,onPointerUp:jt,onPointerLeave:Xt,onPointerMove:tt,children:[u("div",{className:"absolute inset-0 w-full h-full overflow-hidden",style:{filter:ar,willChange:rr?"filter":"auto"},children:[t("div",{className:"absolute inset-0 w-full h-full transition-colors duration-200 ease-linear",style:{backgroundColor:f,zIndex:0}}),e.skyEnabled&&t("canvas",{ref:Ee,className:"absolute inset-0 block w-full h-full",style:{zIndex:1}}),e.skyEnabled&&e.waterEnabled&&t("canvas",{ref:Fe,className:"absolute inset-0 block w-full h-full",style:{zIndex:2}}),V&&t("div",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{backgroundImage:`url(${V})`,backgroundRepeat:"repeat",mixBlendMode:"multiply",opacity:.4,zIndex:5}}),t("div",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{filter:Zt,zIndex:5},children:G.filter(d=>!d.ignoreGlow).map(d=>t("canvas",{ref:I=>{I?he.current.set(d.id,I):he.current.delete(d.id)},className:`absolute inset-0 block touch-none w-full h-full transition-opacity duration-200 ${d.visible?"opacity-100":"opacity-0"}`,style:{pointerEvents:"auto"}},d.id))}),t("div",{className:"absolute inset-0 pointer-events-none transition-all duration-500 ease-in-out",style:{...C.glowStyles,zIndex:10}}),t("div",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{filter:Zt,zIndex:15},children:G.filter(d=>d.ignoreGlow).map(d=>t("canvas",{ref:I=>{I?he.current.set(d.id,I):he.current.delete(d.id)},className:`absolute inset-0 block touch-none w-full h-full transition-opacity duration-200 ${d.visible?"opacity-100":"opacity-0"}`,style:{pointerEvents:"auto"}},d.id))}),t("div",{className:"absolute inset-0 pointer-events-none transition-all duration-500 ease-in-out",style:{...C.ambientStyles,zIndex:18}}),t("div",{className:"absolute inset-0 pointer-events-none transition-all duration-500 ease-in-out",style:{...C.gradeStyles,zIndex:19}}),t("canvas",{ref:ze,className:"absolute inset-0 block pointer-events-none w-full h-full",style:{zIndex:35,opacity:e.skyEnabled?1:0,mixBlendMode:"color-dodge"}})]}),t("canvas",{ref:oe,className:"absolute inset-0 block touch-none w-full h-full",style:{mixBlendMode:e.skyEnabled?"normal":"multiply",opacity:e.skyEnabled?.6:.8,pointerEvents:"none",zIndex:30}}),t("canvas",{ref:Ce,className:"absolute inset-0 block pointer-events-none w-full h-full",style:{zIndex:50}}),(e.isTapeMode||e.isPatternLine)&&X&&Ae&&t("svg",{className:"absolute inset-0 pointer-events-none w-full h-full overflow-visible",style:{zIndex:40},children:t("line",{x1:X.x,y1:X.y,x2:Ae.x,y2:Ae.y,stroke:e.isPatternLine?"#10b981":"#4299e1",strokeWidth:e.isPatternLine?e.size:e.tapeWidth,strokeOpacity:"0.5",strokeLinecap:"butt",strokeDasharray:"10 5"})}),e.isRectLassoFill&&gt&&Dt&&t("svg",{className:"absolute inset-0 pointer-events-none w-full h-full overflow-visible",style:{zIndex:40},children:t("rect",{x:Math.min(gt.x,Dt.x),y:Math.min(gt.y,Dt.y),width:Math.abs(Dt.x-gt.x),height:Math.abs(Dt.y-gt.y),fill:"rgba(20, 184, 166, 0.2)",stroke:"#14b8a6",strokeWidth:"2",strokeDasharray:"5 5"})}),(e.isLassoMode||e.isLassoFill||e.isStippleFill||e.isPatternLasso||e.isGradBlend)&&kt&&t("svg",{className:"absolute inset-0 pointer-events-none w-full h-full overflow-visible",style:{zIndex:40},children:t("polygon",{points:wr,fill:e.isPatternLasso?"rgba(16, 185, 129, 0.2)":e.isStippleFill?"rgba(234, 179, 8, 0.2)":e.isLassoFill?"rgba(20, 184, 166, 0.2)":e.isGradBlend?"rgba(168, 85, 247, 0.2)":e.lassoMode==="add"?"rgba(66, 153, 225, 0.2)":"rgba(255, 99, 71, 0.2)",stroke:e.isPatternLasso?"#10b981":e.isStippleFill?"#ca8a04":e.isLassoFill?"#14b8a6":e.isGradBlend?"#a855f7":e.lassoMode==="add"?"#4299e1":"#ff6347",strokeWidth:"2",strokeDasharray:"5 5"})}),e.isGradientMode&&dt&&St&&u("svg",{className:"absolute inset-0 pointer-events-none w-full h-full overflow-visible",style:{zIndex:40},children:[t("circle",{cx:dt.x,cy:dt.y,r:10,fill:"rgba(255, 200, 100, 0.5)",stroke:"white",strokeWidth:"1"}),t("line",{x1:dt.x,y1:dt.y,x2:St.x,y2:St.y,stroke:"rgba(255, 255, 255, 0.5)",strokeWidth:"1",strokeDasharray:"4 4"}),t("circle",{cx:St.x,cy:St.y,r:4,fill:"rgba(255, 255, 255, 0.3)"})]}),Nt&&u("svg",{className:"absolute inset-0 w-full h-full overflow-visible pointer-events-none",style:{zIndex:100},children:[C.skyColors&&t("line",{x1:C.skyColors.sunX,y1:C.skyColors.sunY,x2:ft,y2:Bt,stroke:"rgba(255,255,255,0.15)",strokeWidth:"1.5",strokeDasharray:"4 6"}),t("circle",{cx:ft,cy:Bt,r:8,fill:xe?"rgba(34,211,238,0.8)":"rgba(34,211,238,0.1)",stroke:"rgba(34,211,238,0.9)",strokeWidth:"2",className:"pointer-events-auto cursor-move hover:fill-[rgba(34,211,238,0.3)] transition-colors drop-shadow-[0_0_10px_rgba(34,211,238,0.5)]"}),t("circle",{cx:ft,cy:Bt,r:12,fill:"transparent",stroke:"rgba(255,255,255,0.5)",strokeWidth:"1",strokeDasharray:"2 2",className:"pointer-events-none opacity-50"}),t("circle",{cx:ft,cy:Bt,r:30,fill:"transparent",className:"pointer-events-auto cursor-move"})]})]})]})});on.displayName="Canvas";const Xr={flat:$n,round:Ln,chisel:Fn,hog:er,fan:Mr,fan2:Mr,fan3:Mr,pastel:Er,pastel2:Er},ha={r:255,g:160,b:60},ma={r:40,g:70,b:110},pa=({value:e,onChange:l,size:w=200})=>{const i=o.useRef(null),h=w/2,a=14,$=w/2-a-20,j=180,Y=270,R=oe=>j+oe*Y,B=(oe,Ee=$)=>{const Fe=oe*Math.PI/180;return{x:h+Ee*Math.cos(Fe),y:h+Ee*Math.sin(Fe)}},U=oe=>{if(!i.current)return;const Ee=i.current.getBoundingClientRect(),Fe=oe.clientX-(Ee.left+h),ze=oe.clientY-(Ee.top+h);let Ce=Math.atan2(ze,Fe)*180/Math.PI;Ce<0&&(Ce+=360);let qe=Ce-180;qe<0&&(qe+=360);let ie=0;qe>270?qe>315?ie=0:ie=1:ie=qe/270,l(Math.max(0,Math.min(1,ie)))},te=R(e),Q=B(te),F=B(j),ee=B(j+Y),D=1,O=["M",F.x,F.y,"A",$,$,0,D,1,ee.x,ee.y].join(" "),ge=$+22,v=B(180,ge),m=B(270,ge),L=B(360,ge),he=B(450,ge);return u("div",{className:"relative flex flex-col items-center justify-center p-2 no-drag select-none",children:[u("svg",{ref:i,width:w,height:w,className:"cursor-pointer touch-none drop-shadow-xl",onPointerDown:oe=>{oe.currentTarget.setPointerCapture(oe.pointerId),U(oe)},onPointerMove:oe=>{oe.buttons>0&&U(oe)},onPointerUp:oe=>oe.currentTarget.releasePointerCapture(oe.pointerId),children:[t("defs",{children:u("linearGradient",{id:"trackGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t("stop",{offset:"0%",stopColor:"#ea580c"}),t("stop",{offset:"50%",stopColor:"#3b82f6"}),t("stop",{offset:"100%",stopColor:"#312e81"})]})}),t("path",{d:O,fill:"none",stroke:"#18181b",strokeWidth:a,strokeLinecap:"round"}),t("path",{d:O,fill:"none",stroke:"url(#trackGrad)",strokeWidth:a,strokeLinecap:"round"}),[0,.33,.66,1].map((oe,Ee)=>{const Fe=B(R(oe),$-a/2),ze=B(R(oe),$+a/2);return t("line",{x1:Fe.x,y1:Fe.y,x2:ze.x,y2:ze.y,stroke:"rgba(255,255,255,0.3)",strokeWidth:"2"},Ee)}),t("circle",{cx:Q.x,cy:Q.y,r:14,fill:"#fff",stroke:"#000",strokeWidth:2,className:"shadow-lg shadow-black/50"}),t("g",{transform:`translate(${v.x}, ${v.y})`,className:"text-zinc-500",children:t(Kr,{size:18,stroke:"currentColor",x:-9,y:-9})}),t("g",{transform:`translate(${m.x}, ${m.y})`,className:"text-zinc-500",children:t(qt,{size:20,stroke:"currentColor",x:-10,y:-10})}),t("g",{transform:`translate(${L.x}, ${L.y})`,className:"text-zinc-500",children:t(Zr,{size:18,stroke:"currentColor",x:-9,y:-9})}),t("g",{transform:`translate(${he.x}, ${he.y})`,className:"text-zinc-500",children:t(Qr,{size:18,stroke:"currentColor",x:-9,y:-9})})]}),u("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center pointer-events-none mt-4",children:[t("span",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-widest block mb-1",children:"Local Time"}),t("span",{className:"text-xl font-mono text-white font-bold tracking-tight",children:e<.2?"DAWN":e<.45?"DAY":e<.75?"DUSK":"NIGHT"})]})]})},ba=({settings:e,onChange:l,onClearMasks:w,onInvertMask:i,visible:h,onClose:a,grayscaleMode:$,onToggleGrayscale:j,isMobile:Y})=>{const[R,B]=o.useState(()=>Sr(e.color)),[U,te]=o.useState("hsv"),[Q,F]=o.useState(!1),[ee,D]=o.useState(0),O=o.useRef(null),ge=o.useRef(null),v=o.useRef(!1),[m,L]=o.useState(0),he=o.useRef(null),oe=o.useRef(null),Ee=o.useRef(!1),[Fe,ze]=o.useState({x:0,y:0}),[Ce,qe]=o.useState({w:260,h:320}),[ie,Qe]=o.useState(!1),V=o.useRef(null),z=o.useRef(null),X=o.useRef(!1),Pe=o.useRef(null),Ae=o.useRef(null),be=o.useRef(null),Ze=o.useRef(null),pt=o.useRef({});o.useEffect(()=>{let n,S;Y?(n=(window.innerWidth-Ce.w)/2,S=100):(n=Math.max(20,window.innerWidth-Ce.w-20),S=20),ze({x:n,y:S}),Qe(!0)},[]),o.useEffect(()=>{const n=()=>{ze(S=>{const q=window.innerWidth-50,me=window.innerHeight-50;let Z=S.x,C=S.y;return Z>q&&(Z=q),C>me&&(C=me),Z<0&&(Z=20),C<0&&(C=20),{x:Z,y:C}})};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),o.useEffect(()=>{!Pe.current&&!v.current&&!Ee.current&&(B(Sr(e.color)),D(0),L(0))},[e.color]);const kt=n=>{if(!(n.target instanceof SVGElement||n.target.tagName==="BUTTON"||n.target.closest(".no-drag")||n.target.tagName==="INPUT")&&(n.preventDefault(),n.stopPropagation(),n.currentTarget.setPointerCapture(n.pointerId),z.current)){const S=z.current.getBoundingClientRect();V.current={x:n.clientX-S.left,y:n.clientY-S.top}}},Lt=n=>{if(V.current&&z.current){n.preventDefault(),n.stopPropagation();let S=n.clientX-V.current.x,q=n.clientY-V.current.y;const me=window.innerWidth-50,Z=window.innerHeight-50;S=Math.max(0,Math.min(S,me)),q=Math.max(0,Math.min(q,Z)),z.current.style.left=`${S}px`,z.current.style.top=`${q}px`}},dt=n=>{if(V.current&&z.current){const S=z.current.getBoundingClientRect();ze({x:S.left,y:S.top})}n.preventDefault(),V.current=null,n.currentTarget.releasePointerCapture(n.pointerId)},Ft=n=>{Y||(n.preventDefault(),n.stopPropagation(),n.currentTarget.setPointerCapture(n.pointerId),X.current=!0)},St=n=>{if(X.current&&!Y){n.preventDefault(),n.stopPropagation();const S=Math.max(260,n.clientX-Fe.x),q=Math.max(300,n.clientY-Fe.y);qe({w:S,h:q})}},Rt=n=>{X.current&&(n.preventDefault(),n.stopPropagation(),X.current=!1,n.currentTarget.releasePointerCapture(n.pointerId))},ut=n=>{B(n);const S=ur(n.h,n.s,n.v);l({...e,color:S})},ne=(n,S,q)=>{const me=tr(n,S,q);B(an(n,S,q)),l({...e,color:me})},Ie=(n,S)=>{if(!Ae.current)return;const q=Ae.current,me=Math.max(0,Math.min(1,(n-q.left)/q.width)),Z=Math.max(0,Math.min(1,(S-q.top)/q.height));ut({...R,s:me,v:1-Z})},xe=n=>{if(!Ae.current)return;const S=Ae.current,q=Math.max(0,Math.min(1,(n-S.left)/S.width));ut({...R,h:q*360})},Ve=(n,S)=>{if(!Ae.current)return;const q=Ae.current,me=Math.max(0,Math.min(1,(n-q.left)/q.width));if(S==="h"&&ut({...R,h:me*360}),S==="s"&&ut({...R,s:me}),S==="v"&&ut({...R,v:me}),["r","g","b"].includes(S)){const{r:Z,g:C,b:G}=Ct(e.color),re=Math.round(me*255);S==="r"&&ne(re,C,G),S==="g"&&ne(Z,re,G),S==="b"&&ne(Z,C,re)}},De=(n,S)=>{n.preventDefault(),n.stopPropagation(),n.currentTarget.setPointerCapture(n.pointerId),Pe.current={type:S};let q=null;S==="sv"?q=be.current:S==="hue"?q=Ze.current:q=pt.current[S],q&&(Ae.current=q.getBoundingClientRect()),S==="sv"?Ie(n.clientX,n.clientY):S==="hue"?xe(n.clientX):Ve(n.clientX,S)},vt=n=>{if(!Pe.current)return;n.preventDefault(),n.stopPropagation();const S=Pe.current.type;S==="sv"?Ie(n.clientX,n.clientY):S==="hue"?xe(n.clientX):Ve(n.clientX,S)},$e=n=>{n.preventDefault(),Pe.current&&(n.currentTarget.releasePointerCapture(n.pointerId),Pe.current=null,Ae.current=null)},Et=n=>{if(!ge.current||!O.current)return;const S=ge.current.getBoundingClientRect(),q=(n-S.left)/S.width,Z=Math.max(0,Math.min(1,q))*2-1;D(Z);const C=Ct(O.current),G=Z>0?ha:ma,re=Math.abs(Z)*.5,ce=at(C,G,re);l({...e,color:tr(ce.r,ce.g,ce.b)})},gt=n=>{n.preventDefault(),n.stopPropagation(),n.currentTarget.setPointerCapture(n.pointerId),v.current=!0,O.current=e.color,Et(n.clientX)},It=n=>{v.current&&(n.preventDefault(),n.stopPropagation(),Et(n.clientX))},Dt=n=>{n.preventDefault(),v.current&&(n.currentTarget.releasePointerCapture(n.pointerId),v.current=!1,O.current=null)},Gt=n=>{if(!oe.current||!he.current)return;const S=oe.current.getBoundingClientRect(),q=(n-S.left)/S.width,Z=Math.max(0,Math.min(1,q))*2-1;L(Z);let{h:C,s:G,v:re}=Sr(he.current);const ce=Math.abs(Z),Ue=Math.pow(ce,1.5);if(Z>0){let je=50-C;je>180&&(je-=360),je<-180&&(je+=360),C=(C+je*(Ue*.5))%360,C<0&&(C+=360),re=Math.min(1,re+(1-re)*(Ue*.7)),G=Math.max(0,G-G*Ue*.4)}else{let je=240-C;je>180&&(je-=360),je<-180&&(je+=360),C=(C+je*(Ue*.9))%360,C<0&&(C+=360),G=Math.min(1,G+(1-G)*(Ue*.6));const We=1-Ue*.98;re=re*We,ce>.99&&(re=0)}l({...e,color:ur(C,G,re)})},ot=n=>{n.preventDefault(),n.stopPropagation(),n.currentTarget.setPointerCapture(n.pointerId),Ee.current=!0,he.current=e.color,Gt(n.clientX)},At=n=>{Ee.current&&(n.preventDefault(),n.stopPropagation(),Gt(n.clientX))},r=n=>{n.preventDefault(),Ee.current&&(n.currentTarget.releasePointerCapture(n.pointerId),Ee.current=!1,he.current=null)},s=()=>({isTapeMode:!1,isLassoMode:!1,isGradientMode:!1,isLassoFill:!1,isRectLassoFill:!1,isStippleFill:!1,isPatternLasso:!1,isPatternLine:!1,isGradBlend:!1}),c=n=>{l({...e,...s(),brushType:n})},f=()=>{l({...e,...s(),isLassoMode:!e.isLassoMode})},g=()=>{l({...e,...s(),isLassoFill:!e.isLassoFill})},M=()=>{l({...e,...s(),isRectLassoFill:!e.isRectLassoFill})},y=()=>{l({...e,...s(),isStippleFill:!e.isStippleFill})},p=()=>{l({...e,...s(),isTapeMode:!e.isTapeMode})},P=()=>{l({...e,...s(),isGradientMode:!e.isGradientMode})},b=()=>{l({...e,...s(),isGradBlend:!e.isGradBlend})},E=()=>{l({...e,...s(),isPatternLasso:!e.isPatternLasso})},x=()=>{l({...e,...s(),isPatternLine:!e.isPatternLine})},A=Ct(e.color),J=.299*A.r+.587*A.g+.114*A.b,_=$?`rgb(${J}, ${J}, ${J})`:e.color,H=Ce.w<160,T=(n,S,q,me,Z)=>u("div",{className:"flex-1 min-h-[18px] flex items-center gap-2 text-[10px] font-mono group",children:[t("span",{className:"w-2.5 font-bold text-zinc-500 flex-shrink-0",children:Z}),t("div",{ref:C=>{pt.current[n]=C},className:"flex-1 h-2 relative rounded-full cursor-pointer ring-1 ring-white/5 overflow-hidden",style:{background:me,touchAction:"none"},onPointerDown:C=>De(C,n),onPointerMove:vt,onPointerUp:$e,onPointerCancel:$e,children:t("div",{className:"absolute top-0 bottom-0 w-2 h-2 rounded-full bg-white shadow-sm -translate-x-1/2 pointer-events-none ring-1 ring-black/20",style:{left:`${S/q*100}%`}})}),!H&&t("span",{className:"w-6 text-right text-zinc-400 flex-shrink-0",children:Math.round(S)})]}),ae=()=>u("div",{className:"flex-1 min-h-[18px] flex items-center gap-2 text-[10px] font-mono group mt-1",title:"Color Temperature Shift",children:[t(Dn,{className:"w-3 h-3 text-zinc-500 flex-shrink-0"}),u("div",{ref:ge,className:"flex-1 h-2 relative rounded-full cursor-ew-resize ring-1 ring-white/5 overflow-hidden bg-zinc-800",onPointerDown:gt,onPointerMove:It,onPointerUp:Dt,onPointerCancel:Dt,style:{touchAction:"none"},children:[t("div",{className:"absolute inset-0 opacity-80",style:{background:"linear-gradient(to right, #3b82f6, #71717a, #f97316)"}}),t("div",{className:"absolute top-0 bottom-0 w-px bg-white/30 left-1/2"}),t("div",{className:"absolute top-0 bottom-0 w-2 h-2 rounded-full bg-white shadow-sm -translate-x-1/2 pointer-events-none ring-1 ring-black/20 transition-transform duration-75",style:{left:`${(ee+1)/2*100}%`}})]}),!H&&u("span",{className:"w-6 text-right text-zinc-400 flex-shrink-0",children:[ee>0?"+":"",Math.round(ee*100)]})]}),ue=()=>u("div",{className:"flex-1 min-h-[18px] flex items-center gap-2 text-[10px] font-mono group",title:"Composite Brightness (Natural Light)",children:[m>0?t(qt,{className:"w-3 h-3 text-zinc-500 flex-shrink-0"}):t(Eclipse,{className:"w-3 h-3 text-zinc-500 flex-shrink-0"}),u("div",{ref:oe,className:"flex-1 h-2 relative rounded-full cursor-ew-resize ring-1 ring-white/5 overflow-hidden bg-zinc-800",onPointerDown:ot,onPointerMove:At,onPointerUp:r,onPointerCancel:r,style:{touchAction:"none"},children:[t("div",{className:"absolute inset-0 opacity-80",style:{background:"linear-gradient(to right, #1e3a8a, #71717a, #fef08a)"}}),t("div",{className:"absolute top-0 bottom-0 w-px bg-white/30 left-1/2"}),t("div",{className:"absolute top-0 bottom-0 w-2 h-2 rounded-full bg-white shadow-sm -translate-x-1/2 pointer-events-none ring-1 ring-black/20 transition-transform duration-75",style:{left:`${(m+1)/2*100}%`}})]}),!H&&u("span",{className:"w-6 text-right text-zinc-400 flex-shrink-0",children:[m>0?"+":"",Math.round(m*100)]})]});if(!ie||!h)return null;let ve=qt;const se=e.gradientTime;se<.2||se>.8?ve=Qr:se<.4?ve=Kr:se<.6?ve=qt:ve=Zr;const K={left:Fe.x,top:Fe.y,width:Ce.w,height:Ce.h};return u("div",{ref:z,className:`fixed bg-zinc-900/60 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl shadow-black/50 flex flex-col text-zinc-200 select-none z-50 overflow-hidden transition-[width,height] duration-200 ${Y?"animate-in fade-in zoom-in-95":""}`,style:{...K,touchAction:"none"},children:[u("div",{className:"flex items-center justify-between p-2 border-b border-white/5 cursor-move group touch-none shrink-0 bg-white/[0.02]",onPointerDown:kt,onPointerMove:Lt,onPointerUp:dt,onPointerCancel:dt,children:[t("div",{className:"flex items-center gap-2",children:e.isGradientMode?u("div",{className:"flex items-center gap-2",children:[" ",t(ve,{className:"w-4 h-4 text-orange-400"})," ",!H&&t("span",{className:"font-bold text-[10px] tracking-widest text-zinc-400 uppercase",children:"Atmosphere"})," "]}):u(br,{children:[" ",t("div",{className:"w-4 h-4 rounded-full shadow-inner ring-1 ring-white/10 transition-colors",style:{backgroundColor:_}})," ",!H&&t("span",{className:"font-bold text-[10px] tracking-widest text-zinc-400 uppercase",children:$?"Value":"Color"})," "]})}),u("div",{className:"flex items-center gap-1 no-drag",children:[(e.isTapeMode||e.isPatternLine)&&u("div",{className:"flex items-center gap-1.5 mr-2 no-drag",children:[" ",t("span",{className:"text-[9px] font-bold text-zinc-500 uppercase tracking-wider whitespace-nowrap",children:"Width"})," ",t("input",{type:"range",min:"5",max:"150",value:e.tapeWidth,onChange:n=>l({...e,tapeWidth:Number(n.target.value)}),className:"w-16 h-1 bg-zinc-700 rounded-full appearance-none cursor-pointer accent-indigo-500",title:"Tape Width",onPointerDown:n=>n.stopPropagation()})," "]}),!e.isTapeMode&&!e.isGradientMode&&!e.isPatternLine&&!e.isPatternLasso&&!e.isGradBlend&&u("div",{className:"flex gap-0.5 bg-zinc-800/50 p-0.5 rounded-lg border border-white/5",children:[t("button",{onClick:()=>l({...e,wetMode:!e.wetMode}),className:`p-1.5 rounded-md transition-colors ${e.wetMode?"text-blue-400 bg-blue-500/10":"text-zinc-500 hover:text-zinc-200"}`,title:"Wet Blend",children:t(vn,{className:"w-3.5 h-3.5"})}),t("button",{onClick:()=>l({...e,autoClean:!e.autoClean}),className:`p-1.5 rounded-md transition-colors ${e.autoClean?"text-cyan-400 bg-cyan-500/10":"text-zinc-500 hover:text-zinc-200"}`,title:"Auto-Clean",children:t(Vr,{className:"w-3.5 h-3.5"})}),t("button",{onClick:()=>l({...e,pressureSensitivity:!e.pressureSensitivity}),className:`p-1.5 rounded-md transition-colors ${e.pressureSensitivity?"text-amber-400 bg-amber-500/10":"text-zinc-500 hover:text-zinc-200"}`,title:"Pressure",children:t(xr,{className:"w-3.5 h-3.5"})}),t("button",{onClick:()=>l({...e,isEraser:!e.isEraser}),className:`p-1.5 rounded-md transition-colors ${e.isEraser?"text-red-400 bg-red-500/10":"text-zinc-500 hover:text-zinc-200"}`,title:"Eraser",children:t(Mn,{className:"w-3.5 h-3.5"})})]}),t("div",{className:"w-px h-4 bg-white/10 mx-1"}),t("button",{onClick:i,className:"p-1.5 text-zinc-500 hover:text-zinc-200 hover:bg-white/5 rounded-md transition-colors",title:"Invert Mask",children:t(Cn,{className:"w-3.5 h-3.5"})}),t("button",{onClick:w,className:"p-1.5 text-zinc-500 hover:text-red-400 hover:bg-red-500/10 rounded-md transition-colors",title:"Clear Mask",children:t(kn,{className:"w-3.5 h-3.5"})}),t("div",{className:"w-px h-4 bg-white/10 mx-1"}),t("button",{onClick:()=>F(!Q),className:`p-1.5 rounded-md transition-colors ${Q?"bg-indigo-500/20 text-indigo-400 ring-1 ring-indigo-500/30":"text-zinc-400 hover:text-zinc-100 hover:bg-white/5"}`,children:t(er,{className:"w-3.5 h-3.5"})}),t("div",{className:"w-px h-4 bg-white/10 mx-1"}),!Y&&t(Ur,{className:"w-3.5 h-3.5 text-zinc-600 pointer-events-none"}),t("button",{onClick:a,className:"text-zinc-500 hover:text-white p-1 hover:bg-white/5 rounded-md transition-colors",onPointerDown:n=>n.stopPropagation(),children:t(gr,{className:"w-3.5 h-3.5"})})]})]}),u("div",{className:"flex-1 flex flex-col p-2 gap-2 overflow-hidden relative",children:[Q&&u("div",{className:"flex flex-col gap-1 p-1 bg-zinc-800/50 rounded-lg animate-in fade-in slide-in-from-top-2 shrink-0 no-drag border border-white/5",children:[u("div",{className:`grid ${H?"grid-cols-4":"grid-cols-6"} gap-1`,children:[Object.keys(Xr).map(n=>{const S=Xr[n],q=e.brushType===n&&!e.isTapeMode&&!e.isLassoMode&&!e.isGradientMode&&!e.isLassoFill&&!e.isRectLassoFill&&!e.isStippleFill&&!e.isPatternLasso&&!e.isPatternLine&&!e.isGradBlend;return u("button",{onClick:()=>c(n),className:`h-8 flex items-center justify-center rounded-md transition-all ${q?"bg-zinc-100 text-zinc-900 shadow-sm":"text-zinc-500 hover:bg-white/5 hover:text-zinc-300"}`,children:[" ",t(S,{className:"w-4 h-4"})," "]},n)}),t("button",{onClick:g,className:`h-8 flex items-center justify-center rounded-md transition-all ${e.isLassoFill?"bg-teal-500/20 text-teal-400 ring-1 ring-teal-500/40":"text-zinc-500 hover:bg-white/5 hover:text-zinc-300"}`,title:"Lasso Fill",children:t(Sn,{className:"w-4 h-4"})}),t("button",{onClick:M,className:`h-8 flex items-center justify-center rounded-md transition-all ${e.isRectLassoFill?"bg-teal-500/20 text-teal-400 ring-1 ring-teal-500/40":"text-zinc-500 hover:bg-white/5 hover:text-zinc-300"}`,title:"Rect Lasso Fill",children:t(Nn,{className:"w-4 h-4"})}),t("button",{onClick:b,className:`h-8 flex items-center justify-center rounded-md transition-all ${e.isGradBlend?"bg-purple-500/20 text-purple-400 ring-1 ring-purple-500/40":"text-zinc-500 hover:bg-white/5 hover:text-zinc-300"}`,title:"Grad Blend Lasso",children:t(Blend,{className:"w-4 h-4"})}),t("button",{onClick:y,className:`h-8 flex items-center justify-center rounded-md transition-all ${e.isStippleFill?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/40":"text-zinc-500 hover:bg-white/5 hover:text-zinc-300"}`,title:"Stipple Fill",children:t(zn,{className:"w-4 h-4"})}),t("button",{onClick:f,className:`h-8 flex items-center justify-center rounded-md transition-all ${e.isLassoMode?"bg-indigo-500/20 text-indigo-400 ring-1 ring-indigo-500/40":"text-zinc-500 hover:bg-white/5 hover:text-zinc-300"}`,title:"Lasso Mask",children:t(Pn,{className:"w-4 h-4"})}),t("button",{onClick:p,className:`h-8 flex items-center justify-center rounded-md transition-all ${e.isTapeMode?"bg-blue-500/20 text-blue-400 ring-1 ring-blue-500/40":"text-zinc-500 hover:bg-white/5 hover:text-zinc-300"}`,title:"Tape Mask",children:t(Tn,{className:"w-4 h-4"})}),t("button",{onClick:E,className:`h-8 flex items-center justify-center rounded-md transition-all ${e.isPatternLasso?"bg-emerald-500/20 text-emerald-400 ring-1 ring-emerald-500/40":"text-zinc-500 hover:bg-white/5 hover:text-zinc-300"}`,title:"Pattern Lasso Fill",children:t(Jr,{className:"w-4 h-4"})}),t("button",{onClick:x,className:`h-8 flex items-center justify-center rounded-md transition-all ${e.isPatternLine?"bg-emerald-500/20 text-emerald-400 ring-1 ring-emerald-500/40":"text-zinc-500 hover:bg-white/5 hover:text-zinc-300"}`,title:"Pattern Line Stamp",children:t(Rn,{className:"w-4 h-4"})}),t("button",{onClick:P,className:`h-8 flex items-center justify-center rounded-md transition-all ${e.isGradientMode?"bg-orange-500/20 text-orange-400 ring-1 ring-orange-500/40":"text-zinc-500 hover:bg-white/5 hover:text-zinc-300"}`,title:"Sky Gradient",children:t(qt,{className:"w-4 h-4"})})]}),e.isGradBlend&&u("div",{className:"mt-1 pt-1 border-t border-white/5 px-1 pb-1",children:[u("div",{className:"flex items-center justify-between text-[9px] font-bold uppercase text-zinc-400 tracking-wider",children:[t("span",{children:"Secondary Color"}),t("div",{className:"w-4 h-4 rounded-full shadow-inner ring-1 ring-white/10",style:{backgroundColor:e.gradColor2}})]}),t("input",{type:"color",value:e.gradColor2,onChange:n=>l({...e,gradColor2:n.target.value}),className:"w-full h-6 mt-1 bg-transparent cursor-pointer rounded overflow-hidden"})]}),u("div",{className:"mt-1 pt-1 border-t border-white/5 px-1 space-y-2 pb-1",children:[u("div",{className:"space-y-1",children:[u("div",{className:"flex justify-between text-[8px] text-zinc-400 font-bold uppercase tracking-wider",children:[t("span",{children:"Thermal Drift"}),u("span",{className:e.colorVariation>0?"text-orange-400":"text-zinc-600",children:[Math.round(e.colorVariation*100),"%"]})]}),t("input",{type:"range",min:"0",max:"1",step:"0.01",value:e.colorVariation,onChange:n=>l({...e,colorVariation:Number(n.target.value)}),className:"w-full h-1 bg-zinc-700/50 rounded-full appearance-none cursor-pointer accent-orange-500"})]}),u("div",{className:"space-y-1",children:[u("div",{className:"flex justify-between text-[8px] text-zinc-400 font-bold uppercase tracking-wider",children:[t("span",{children:"Hue Jitter"}),u("span",{className:e.hueVariation>0?"text-pink-400":"text-zinc-600",children:[Math.round(e.hueVariation*100),"%"]})]}),t("input",{type:"range",min:"0",max:"1",step:"0.01",value:e.hueVariation,onChange:n=>l({...e,hueVariation:Number(n.target.value)}),className:"w-full h-1 bg-zinc-700/50 rounded-full appearance-none cursor-pointer accent-pink-500"})]})]})]}),e.isGradientMode?t("div",{className:"flex-1 flex flex-col items-center p-2 animate-in fade-in zoom-in-95 overflow-hidden",children:u("div",{className:"flex-1 flex flex-col justify-center w-full",children:[u("div",{className:"mb-4 flex justify-center",children:[" ",t(pa,{value:e.gradientTime,onChange:n=>l({...e,gradientTime:n}),size:Math.min(Ce.w-20,240)})," "]}),u("div",{className:"w-full px-2 space-y-3",children:[u("div",{children:[" ",u("div",{className:"flex justify-between items-end text-zinc-400 text-xs font-bold uppercase tracking-wider mb-1",children:[" ",u("span",{className:"flex items-center gap-1",children:[t(qt,{size:12})," Clear"]})," ",u("span",{className:"flex items-center gap-1",children:["Hazy ",t(En,{size:12})]})," "]})," ",u("div",{className:"relative h-5 w-full rounded-full ring-1 ring-white/10 overflow-hidden group",children:[" ",t("div",{className:"absolute inset-0 transition-colors duration-300",style:{background:"linear-gradient(to right, #38bdf8, #94a3b8)"}})," ",t("div",{className:"absolute inset-0 bg-white pointer-events-none transition-opacity duration-100",style:{opacity:e.gradientHumidity*.5}})," ",t("input",{type:"range",min:"0",max:"1",step:"0.01",value:e.gradientHumidity,onChange:n=>l({...e,gradientHumidity:Number(n.target.value)}),className:"absolute inset-0 w-full h-full opacity-0 cursor-ew-resize"})," ",t("div",{className:"absolute top-0 bottom-0 w-1 bg-white shadow-lg pointer-events-none transition-transform duration-75",style:{left:`${e.gradientHumidity*100}%`}})," "]})," "]}),u("div",{children:[" ",u("div",{className:"flex justify-between items-end text-zinc-400 text-xs font-bold uppercase tracking-wider mb-1",children:[" ",u("span",{className:"flex items-center gap-1",children:[t(qr,{size:12})," Glow"]})," ",u("span",{className:"text-[10px] text-orange-400",children:[Math.round(e.sunIntensity*100),"%"]})," "]})," ",u("div",{className:"relative h-5 w-full rounded-full ring-1 ring-white/10 overflow-hidden group",children:[" ",t("div",{className:"absolute inset-0 transition-colors duration-300",style:{background:"linear-gradient(to right, #444, #ea580c)"}})," ",t("input",{type:"range",min:"0",max:"1",step:"0.01",value:e.sunIntensity,onChange:n=>l({...e,sunIntensity:Number(n.target.value)}),className:"absolute inset-0 w-full h-full opacity-0 cursor-ew-resize"})," ",t("div",{className:"absolute top-0 bottom-0 w-1 bg-white shadow-lg pointer-events-none transition-transform duration-75",style:{left:`${e.sunIntensity*100}%`}})," "]})," "]})]})]})}):u(br,{children:[u("div",{className:"flex p-1 bg-zinc-800/50 rounded-lg shrink-0 gap-1 no-drag border border-white/5",children:[t("button",{onClick:()=>te("hsv"),className:`flex-1 py-1 rounded-md flex items-center justify-center text-[10px] font-bold uppercase transition-all ${U==="hsv"?"bg-zinc-100 text-zinc-900 shadow-sm":"text-zinc-500 hover:text-zinc-300"}`,children:"HSV"}),t("button",{onClick:()=>te("rgb"),className:`flex-1 py-1 rounded-md flex items-center justify-center text-[10px] font-bold uppercase transition-all ${U==="rgb"?"bg-zinc-100 text-zinc-900 shadow-sm":"text-zinc-500 hover:text-zinc-300"}`,children:"RGB"}),t("button",{onClick:()=>te("box"),className:`flex-1 py-1 rounded-md flex items-center justify-center transition-all ${U==="box"?"bg-zinc-100 text-zinc-900 shadow-sm":"text-zinc-500 hover:text-zinc-300"}`,title:"Box",children:t(In,{className:"w-3.5 h-3.5"})}),t("div",{className:"w-px bg-white/10 my-0.5 mx-0.5"}),t("button",{onClick:j,className:`flex-1 py-1 rounded-md flex items-center justify-center transition-colors ${$?"bg-white text-black":"text-zinc-500 hover:text-zinc-200"}`,title:"Value Check",children:t(Wr,{className:"w-3.5 h-3.5"})})]}),u("div",{className:"flex-1 flex flex-col gap-2 min-h-0 pt-1",children:[U==="hsv"&&u("div",{className:"flex flex-col gap-2 justify-center flex-1 min-h-0",children:[" ",T("h",R.h,360,"linear-gradient(to right, #f00, #ff0, #0f0, #0ff, #00f, #f0f, #f00)","H")," ",T("s",R.s*100,100,`linear-gradient(to right, #808080, ${ur(R.h,1,R.v)})`,"S")," ",T("v",R.v*100,100,`linear-gradient(to right, #000, ${ur(R.h,R.s,1)})`,"V")," ",t("div",{className:"min-h-[16px] flex-grow-[0.5] rounded-md mt-1 ring-1 ring-white/10",style:{backgroundColor:_}})," "]}),U==="rgb"&&u("div",{className:"flex flex-col gap-2 justify-center flex-1 min-h-0",children:[" ",T("r",A.r,255,"linear-gradient(to right, #000, #f00)","R")," ",T("g",A.g,255,"linear-gradient(to right, #000, #0f0)","G")," ",T("b",A.b,255,"linear-gradient(to right, #000, #00f)","B")," ",t("div",{className:"min-h-[16px] flex-grow-[0.5] rounded-md mt-1 ring-1 ring-white/10",style:{backgroundColor:_}})," "]}),U==="box"&&u(br,{children:[" ",u("div",{ref:be,className:"flex-1 w-full rounded-lg relative overflow-hidden cursor-crosshair shadow-inner ring-1 ring-white/10",style:{backgroundColor:`hsl(${R.h}, 100%, 50%)`,touchAction:"none"},onPointerDown:n=>De(n,"sv"),onPointerMove:vt,onPointerUp:$e,onPointerCancel:$e,children:[" ",t("div",{className:"absolute inset-0",style:{background:"linear-gradient(to right, #fff, transparent)"}})," ",t("div",{className:"absolute inset-0",style:{background:"linear-gradient(to top, #000, transparent)"}})," ",t("div",{className:"absolute w-3 h-3 rounded-full border-2 border-white shadow-sm -translate-x-1/2 -translate-y-1/2 pointer-events-none",style:{left:`${R.s*100}%`,top:`${(1-R.v)*100}%`,backgroundColor:e.color}})," "]})," ",u("div",{ref:Ze,className:"w-full h-3 rounded-full relative cursor-pointer ring-1 ring-white/10 overflow-hidden shrink-0 mt-1",style:{background:"linear-gradient(to right, #f00, #ff0, #0f0, #0ff, #00f, #f0f, #f00)",touchAction:"none"},onPointerDown:n=>De(n,"hue"),onPointerMove:vt,onPointerUp:$e,onPointerCancel:$e,children:[" ",t("div",{className:"absolute w-2 h-full bg-white shadow-sm -translate-x-1/2 top-0 pointer-events-none ring-1 ring-black/20",style:{left:`${R.h/360*100}%`}})," "]})," "]}),ae(),ue()]})]})]}),!Y&&u("div",{className:"absolute bottom-0 right-0 w-4 h-4 cursor-nwse-resize flex items-center justify-center text-zinc-600 hover:text-zinc-400 transition-colors z-50 touch-none",onPointerDown:Ft,onPointerMove:St,onPointerUp:Rt,onPointerCancel:Rt,children:[" ",u("svg",{width:"8",height:"8",viewBox:"0 0 10 10",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",className:"pointer-events-none",children:[" ",t("path",{d:"M6 9L9 6"})," ",t("path",{d:"M2 9L9 2"})," "]})," "]})]})},hr=[{name:"Classic",warm:["#a81c31","#e34234","#e67e22","#f1c40f","#8a3324"],cool:["#1c39bb","#007ba7","#007f5c","#ffffff","#1a1a1a"]},{name:"Zorn",warm:["#e34234","#d6a659","#e97451","#6b4423","#4a3c31"],cool:["#1a1a1a","#ffffff","#708090","#8c959d","#536878"]},{name:"Studio",warm:["#e32636","#e34234","#e97451","#d68a59","#8a3324","#fada5e","#fff44f"],cool:["#0047ab","#007ba7","#5e8c31","#ffcc99","#ffffff","#000000"]},{name:"Vivid",warm:["#ff0055","#ff5500","#ffaa00","#ffff00","#aa00ff"],cool:["#0044ff","#00ccff","#00ffaa","#ffffff","#000000"]},{name:"Portrait",warm:["#ffcccc","#ffdfc1","#e0ac69","#8d5524","#593c1f"],cool:["#708090","#5f9ea0","#4682b4","#f0f8ff","#2f4f4f"]},{name:"Pastel",warm:["#ffb7b2","#ffdac1","#fffac8","#e2f0cb","#c7ceea"],cool:["#b5ead7","#9fd3c7","#385170","#ffffff","#5c5c5c"]},{name:"Botanic",warm:["#d63447","#f57b51","#f6c90e","#588c7e","#3e4444"],cool:["#283655","#4d648d","#d0e1f9","#ffffff","#0a0a0a"]}],Yr=({color:e,size:l,onClick:w})=>t("button",{onClick:w,className:"group transition-transform hover:scale-105 active:scale-95 focus:outline-none flex-shrink-0 rounded-sm shadow-sm ring-1 ring-white/10 hover:ring-white/30","aria-label":`Select color ${e}`,onPointerDown:i=>i.stopPropagation(),style:{width:l,height:l,backgroundColor:e}}),ga=({settings:e,onChange:l,visible:w,onClose:i,isMobile:h})=>{const[a,$]=o.useState({x:20,y:300}),[j,Y]=o.useState({w:170,h:130}),[R,B]=o.useState(0),[U,te]=o.useState(!1),Q=o.useRef(null),F=o.useRef(!1),ee=hr[R];o.useEffect(()=>{const V=window.innerHeight-300;$({x:20,y:V}),te(!0)},[]),o.useEffect(()=>{const V=()=>{$(z=>{const X=window.innerWidth-50,Pe=window.innerHeight-50;let Ae=z.x,be=z.y;return Ae>X&&(Ae=X),be>Pe&&(be=Pe),Ae<0&&(Ae=20),be<0&&(be=20),{x:Ae,y:be}})};return window.addEventListener("resize",V),()=>window.removeEventListener("resize",V)},[]);const D=V=>{h||V.target instanceof SVGElement||V.target.tagName==="BUTTON"||V.target.closest(".no-drag")||(V.preventDefault(),V.stopPropagation(),V.currentTarget.setPointerCapture(V.pointerId),Q.current={x:V.clientX-a.x,y:V.clientY-a.y})},O=V=>{if(Q.current&&!h){V.preventDefault(),V.stopPropagation();let z=V.clientX-Q.current.x,X=V.clientY-Q.current.y;const Pe=window.innerWidth-50,Ae=window.innerHeight-50;z=Math.max(0,Math.min(z,Pe)),X=Math.max(0,Math.min(X,Ae)),$({x:z,y:X})}},ge=V=>{V.preventDefault(),Q.current=null,V.currentTarget.releasePointerCapture(V.pointerId)},v=V=>{h||(V.preventDefault(),V.stopPropagation(),V.currentTarget.setPointerCapture(V.pointerId),F.current=!0)},m=V=>{if(F.current&&!h){V.preventDefault(),V.stopPropagation();const z=window.innerWidth-a.x,X=window.innerHeight-a.y,Pe=Math.min(Math.max(140,V.clientX-a.x),z),Ae=Math.min(Math.max(100,V.clientY-a.y),X);Y({w:Pe,h:Ae})}},L=V=>{F.current&&(V.preventDefault(),V.stopPropagation(),F.current=!1,V.currentTarget.releasePointerCapture(V.pointerId))},he=()=>B(V=>(V+1)%hr.length),oe=()=>B(V=>(V-1+hr.length)%hr.length),Ee=32,Fe=16,ze=j.w*Math.max(0,j.h-Ee-Fe),qe=Math.sqrt(ze/13)*.85,ie=Math.max(24,Math.min(64,qe));if(!U||!w)return null;const Qe=h?{left:0,bottom:"72px",width:"100%",height:"auto",maxHeight:"40vh",borderBottomLeftRadius:0,borderBottomRightRadius:0}:{left:a.x,top:a.y,width:j.w,height:j.h};return u("div",{className:`fixed bg-zinc-900/95 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl flex flex-col text-zinc-200 select-none z-50 ring-1 ring-black/50 overflow-hidden ${h?"animate-in slide-in-from-bottom-10":""}`,style:{...Qe,touchAction:"none"},children:[u("div",{className:"flex items-center justify-between p-1.5 border-b border-white/5 cursor-move group touch-none shrink-0 bg-white/5",onPointerDown:D,onPointerMove:O,onPointerUp:ge,onPointerCancel:ge,children:[u("div",{className:"flex items-center gap-0.5 no-drag bg-black/20 rounded p-0.5",children:[t("button",{onClick:oe,className:"p-0.5 hover:text-white text-zinc-500 transition-colors",onPointerDown:V=>V.stopPropagation(),children:t(_r,{className:"w-3 h-3"})}),t("span",{className:"text-[9px] font-bold uppercase w-16 text-center text-zinc-300 select-none tracking-wide truncate",children:ee.name}),t("button",{onClick:he,className:"p-0.5 hover:text-white text-zinc-500 transition-colors",onPointerDown:V=>V.stopPropagation(),children:t(Bn,{className:"w-3 h-3"})})]}),u("div",{className:"flex items-center gap-1",children:[!h&&t("div",{className:"text-zinc-600 group-hover:text-zinc-500 transition-colors",children:t(Ur,{className:"w-3.5 h-3.5"})}),t("button",{onClick:i,className:"text-zinc-500 hover:text-white p-0.5 no-drag",onPointerDown:V=>V.stopPropagation(),children:t(gr,{className:"w-3.5 h-3.5"})})]})]}),u("div",{className:"p-2 space-y-2 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-700 flex-1 min-h-0",children:[t("div",{className:"flex flex-wrap gap-1.5 justify-center content-start",children:ee.warm.map((V,z)=>t(Yr,{color:V,size:ie,onClick:()=>l({...e,color:V})},`warm-${z}`))}),t("div",{className:"w-full h-px bg-white/5 mx-auto w-[90%]"}),t("div",{className:"flex flex-wrap gap-1.5 justify-center content-start",children:ee.cool.map((V,z)=>t(Yr,{color:V,size:ie,onClick:()=>l({...e,color:V})},`cool-${z}`))})]}),!h&&t("div",{className:"absolute bottom-0 right-0 w-4 h-4 cursor-nwse-resize flex items-center justify-center text-zinc-600 hover:text-white transition-colors z-50 touch-none",onPointerDown:v,onPointerMove:m,onPointerUp:L,onPointerCancel:L,children:u("svg",{width:"8",height:"8",viewBox:"0 0 10 10",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",className:"pointer-events-none",children:[t("path",{d:"M6 9L9 6"}),t("path",{d:"M2 9L9 2"})]})})]})},mr=[{id:"source-over",label:"Normal",short:"N"},{id:"multiply",label:"Multiply",short:"M"},{id:"screen",label:"Screen",short:"S"},{id:"color-dodge",label:"Color Dodge",short:"CD"},{id:"overlay",label:"Overlay",short:"O"},{id:"lighten",label:"Lighten",short:"L"},{id:"darken",label:"Darken",short:"D"}],xa=({settings:e,onChange:l,onClear:w,onDownload:i,onUndo:h,onRedo:a,visible:$,onClose:j,isMobile:Y,layers:R,activeLayerId:B,onSetActiveLayer:U,onAddLayer:te,onRemoveLayer:Q,onToggleLayerVisibility:F,onToggleLayerGlow:ee,onCapturePattern:D})=>{const[O,ge]=o.useState({x:16,y:100}),[v,m]=o.useState("brush"),L=o.useRef(null),he=o.useRef(null),oe=o.useRef(null);o.useEffect(()=>{const X=Math.max(60,(window.innerHeight-350)/2);ge({x:16,y:X})},[]),o.useEffect(()=>{if(v!=="pattern"||!oe.current)return;const z=oe.current,X=z.getContext("2d");if(!X)return;if(X.fillStyle="#18181b",X.fillRect(0,0,z.width,z.height),!e.patternTexture){X.fillStyle="#27272a",X.fillRect(0,0,z.width,z.height),X.font="9px monospace",X.textAlign="center",X.textBaseline="middle",X.fillStyle="#52525b",X.fillText("NO PATTERN",z.width/2,z.height/2);return}const Pe=new Image;Pe.src=e.patternTexture,Pe.onload=()=>{const Ae=Math.max(15,50*e.patternScale),be=Ae,Ze=Ae,pt=e.patternJitterScale||0,kt=e.patternJitterRotation||0,Lt=e.patternJitterHue||0,dt=e.patternJitterSaturation||0,Ft=e.patternJitterValue||0,St=z.width,Rt=z.height,ut=St%be/2-be,ne=Rt%Ze/2-Ze;X.save();for(let Ie=ne;Ie<Rt+Ze;Ie+=Ze)for(let xe=ut;xe<St+be;xe+=be){const Ve=Math.sin(xe*12.9898+Ie*78.233)*43758.5453,De=Ve-Math.floor(Ve),vt=Ve*1.5-Math.floor(Ve*1.5),$e=Ve*2-Math.floor(Ve*2),Et=Ve*13.37%1,gt=Ve*42.42%1;let It=e.patternStampRotation;if(kt>0){const c=(De-.5)*2*(kt*180);It=(It+c)%360}const Dt=(It+e.patternAngle)*Math.PI/180;let Gt=e.patternScale;if(pt>0){const c=1+(vt-.5)*2*pt;Gt*=Math.max(.1,c)}let ot="";if(Lt>0){const c=($e-.5)*360*Lt;ot+=`hue-rotate(${c}deg) `}if(dt>0){const c=100+(Math.abs(Et)-.5)*200*dt;ot+=`saturate(${Math.max(0,c)}%) `}if(Ft>0){const c=100+(Math.abs(gt)-.5)*200*Ft;ot+=`brightness(${Math.max(0,c)}%) `}const At=50/Pe.width*Gt,r=Pe.width*At,s=Pe.height*At;X.save(),X.translate(xe+be/2,Ie+Ze/2),X.rotate(Dt),ot&&(X.filter=ot.trim()),X.drawImage(Pe,-r/2,-s/2,r,s),X.restore()}X.restore()}},[e.patternTexture,e.patternScale,e.patternAngle,e.patternStampRotation,e.patternJitterRotation,e.patternJitterScale,e.patternJitterHue,e.patternJitterSaturation,e.patternJitterValue,v]);const Ee=z=>{if(!(z.target instanceof SVGElement||z.target.tagName==="BUTTON"||z.target.tagName==="INPUT"||z.target.tagName==="SELECT"||z.target.closest(".no-drag"))&&(z.preventDefault(),z.stopPropagation(),z.currentTarget.setPointerCapture(z.pointerId),he.current)){const X=he.current.getBoundingClientRect();L.current={x:z.clientX-X.left,y:z.clientY-X.top}}},Fe=z=>{if(L.current&&he.current){z.preventDefault(),z.stopPropagation();let X=z.clientX-L.current.x,Pe=z.clientY-L.current.y;const Ae=he.current.getBoundingClientRect(),be=window.innerWidth-Ae.width,Ze=window.innerHeight-Ae.height;X=Math.max(0,Math.min(X,be)),Pe=Math.max(0,Math.min(Pe,Ze)),he.current.style.left=`${X}px`,he.current.style.top=`${Pe}px`}},ze=z=>{if(L.current&&he.current){const X=he.current.getBoundingClientRect();ge({x:X.left,y:X.top})}z.preventDefault(),L.current=null,z.currentTarget.releasePointerCapture(z.pointerId)};if(!$)return null;mr.find(z=>z.id===e.blendMode)||mr[0];const Ce=R?[...R].reverse():[],qe={width:v==="brush"?"200px":"240px",borderRadius:"24px"},ie=()=>{var z;return u("div",{className:"flex flex-col items-center gap-4 w-full px-2 py-2 animate-in fade-in zoom-in-95 duration-200",children:[u("div",{className:"flex flex-col gap-2 w-full group relative",title:"Brush Size",children:[u("div",{className:"flex justify-between text-[10px] font-bold text-zinc-400 uppercase tracking-wider",children:[t("span",{children:"Size"}),u("span",{className:"text-amber-500",children:[Math.round(e.size),"px"]})]}),t("input",{type:"range",min:"1",max:"200",value:e.size,onChange:X=>l({...e,size:Number(X.target.value)}),className:"w-full h-1 bg-zinc-700/50 rounded-full appearance-none cursor-pointer accent-amber-500"})]}),u("div",{className:"flex flex-col gap-2 w-full group relative",title:"Brush Flow",children:[u("div",{className:"flex justify-between text-[10px] font-bold text-zinc-400 uppercase tracking-wider",children:[t("span",{children:"Flow"}),u("span",{className:"text-blue-500",children:[Math.round(e.opacity*100),"%"]})]}),t("input",{type:"range",min:"1",max:"100",value:e.opacity*100,onChange:X=>l({...e,opacity:Number(X.target.value)/100}),className:"w-full h-1 bg-zinc-700/50 rounded-full appearance-none cursor-pointer accent-blue-500"})]}),t("div",{className:"w-full h-px bg-white/10 shrink-0"}),u("div",{className:"w-full flex items-center justify-between",children:[t("span",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-wider",children:"Blend"}),u("div",{className:"relative w-24 h-6 bg-zinc-800 hover:bg-zinc-700 rounded-md flex items-center justify-center group transition-colors border border-transparent hover:border-white/10",title:"Blend Mode",children:[t("span",{className:"text-[10px] font-bold text-zinc-300 uppercase truncate px-2",children:((z=mr.find(X=>X.id===e.blendMode))==null?void 0:z.label)||"Normal"}),t("select",{value:e.blendMode,onChange:X=>l({...e,blendMode:X.target.value}),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer text-xs",children:mr.map(X=>t("option",{value:X.id,children:X.label},X.id))})]})]})]})},Qe=()=>u("div",{className:"flex flex-col w-full h-64 animate-in fade-in slide-in-from-left-4 duration-200",children:[u("div",{className:"flex items-center justify-between mb-2 px-1",children:[t("span",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-widest",children:"Layers"}),t("button",{onClick:te,className:"p-1 hover:bg-white/10 rounded text-zinc-400 hover:text-white transition-colors",title:"New Layer",children:t(Yn,{className:"w-3.5 h-3.5"})})]}),t("div",{className:"flex-1 overflow-y-auto space-y-1 scrollbar-thin scrollbar-thumb-zinc-700 pr-1",children:Ce.map(z=>u("div",{onClick:()=>U==null?void 0:U(z.id),className:`group flex items-center gap-2 p-2 rounded-lg border border-transparent cursor-pointer transition-all duration-200 ${z.id===B?"bg-indigo-500/20 border-indigo-500/30":"hover:bg-white/5 hover:border-white/5"}`,children:[t("button",{onClick:X=>{X.stopPropagation(),F==null||F(z.id)},className:`p-0.5 rounded hover:bg-white/10 transition-colors ${z.visible?"text-zinc-400":"text-zinc-600"}`,children:z.visible?t(Wr,{className:"w-3 h-3"}):t(_n,{className:"w-3 h-3"})}),t("div",{className:"flex-1 min-w-0",children:t("span",{className:`text-[10px] font-semibold truncate block ${z.id===B?"text-indigo-200":"text-zinc-400"}`,children:z.name})}),t("button",{onClick:X=>{X.stopPropagation(),ee==null||ee(z.id)},className:`p-1 rounded transition-colors ${z.ignoreGlow?"text-orange-400":"text-zinc-700 hover:text-zinc-400"}`,title:"Toggle Light Interaction",children:t(qt,{className:"w-3 h-3"})}),Ce.length>1&&t("button",{onClick:X=>{X.stopPropagation(),Q==null||Q(z.id)},className:"p-1 text-zinc-700 hover:text-red-400 transition-colors opacity-0 group-hover:opacity-100",children:t(Ir,{className:"w-3 h-3"})})]},z.id))})]}),V=()=>u("div",{className:"flex flex-col w-full h-80 animate-in fade-in slide-in-from-left-4 duration-200 space-y-3 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-700 pr-1",children:[u("div",{className:"space-y-2 shrink-0",children:[u("div",{className:"flex justify-between items-end text-[9px] text-zinc-500 font-bold uppercase tracking-wider",children:[t("span",{children:"Seamless Preview"}),t("span",{className:e.patternTexture?"text-emerald-400":"text-zinc-600",children:e.patternTexture?"Active":"Empty"})]}),u("div",{className:"w-full aspect-video rounded-lg ring-1 ring-white/10 overflow-hidden bg-black/40 shadow-inner relative group shrink-0",children:[t("canvas",{ref:oe,width:200,height:110,className:"w-full h-full object-cover opacity-80"}),e.patternTexture&&t("button",{onClick:()=>l({...e,patternTexture:null}),className:"absolute top-2 right-2 p-1.5 bg-red-500/20 text-red-400 rounded-md opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-500 hover:text-white",title:"Delete Pattern",children:t(Ir,{className:"w-3 h-3"})})]}),u("button",{onClick:D,className:"w-full py-1.5 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-400 border border-emerald-500/20 hover:border-emerald-500/40 rounded-lg flex items-center justify-center gap-2 transition-all active:scale-95 shrink-0",children:[t(Hn,{className:"w-3.5 h-3.5"}),t("span",{className:"text-[9px] font-bold uppercase tracking-widest",children:"Capture"})]})]}),t("div",{className:"w-full h-px bg-white/10 shrink-0"}),t("div",{className:"space-y-3 shrink-0",children:[{label:"Scale",icon:Vn,val:e.patternScale,min:.1,max:3,step:.1,key:"patternScale",format:z=>z.toFixed(1)+"x"},{label:"Grid Angle",icon:Un,val:e.patternAngle,min:0,max:360,step:1,key:"patternAngle",format:z=>Math.round(z)+""},{label:"Stamp Rot",icon:Jn,val:e.patternStampRotation,min:0,max:360,step:1,key:"patternStampRotation",format:z=>Math.round(z)+""}].map(z=>u("div",{className:"space-y-1",children:[u("div",{className:"flex justify-between items-center text-[9px] text-zinc-400 font-bold uppercase tracking-wider",children:[u("span",{className:"flex items-center gap-1",children:[t(z.icon,{className:"w-3 h-3"})," ",z.label]}),t("span",{className:"text-emerald-400",children:z.format(z.val)})]}),t("input",{type:"range",min:z.min,max:z.max,step:z.step,value:z.val,onChange:X=>l({...e,[z.key]:Number(X.target.value)}),className:"w-full h-1 bg-zinc-700/50 rounded-full appearance-none cursor-pointer accent-emerald-500"})]},z.key))}),t("div",{className:"w-full h-px bg-white/10 shrink-0"}),u("div",{className:"space-y-3 shrink-0",children:[u("div",{className:"flex items-center gap-2 text-[9px] font-bold uppercase text-zinc-500 tracking-widest mb-1",children:[t(qn,{className:"w-3 h-3"})," ",t("span",{children:"Chaos Engine"})]}),[{label:"Scale Jitter",key:"patternJitterScale",val:e.patternJitterScale},{label:"Rot Jitter",key:"patternJitterRotation",val:e.patternJitterRotation},{label:"Hue Shift",key:"patternJitterHue",val:e.patternJitterHue}].map(z=>u("div",{className:"space-y-1",children:[u("div",{className:"flex justify-between items-center text-[9px] text-zinc-400 font-bold uppercase tracking-wider",children:[t("span",{children:z.label}),u("span",{className:"text-emerald-400",children:[Math.round(z.val*100),"%"]})]}),t("input",{type:"range",min:"0",max:"1",step:"0.01",value:z.val,onChange:X=>l({...e,[z.key]:Number(X.target.value)}),className:"w-full h-1 bg-zinc-700/50 rounded-full appearance-none cursor-pointer accent-emerald-500"})]},z.key))]})]});return u("div",{ref:he,className:"fixed z-40 flex flex-col bg-zinc-900/60 backdrop-blur-md border border-white/10 shadow-2xl transition-[width,height,border-radius] duration-300 ease-spring ring-1 ring-black/50 overflow-hidden",style:{left:O.x,top:O.y,touchAction:"none",...qe,maxHeight:"80vh"},children:[u("div",{className:"flex items-center justify-between p-1 border-b border-white/10 bg-white/5 shrink-0 no-drag",children:[u("div",{className:"flex gap-1 w-full",onPointerDown:Ee,onPointerMove:Fe,onPointerUp:ze,onPointerCancel:ze,children:[t("button",{onClick:()=>m("brush"),className:`flex-1 p-1.5 rounded-lg flex justify-center transition-colors ${v==="brush"?"bg-zinc-700 text-white shadow-sm":"text-zinc-500 hover:text-zinc-300"}`,title:"Brush Tools",children:t(er,{className:"w-3.5 h-3.5"})}),t("button",{onClick:()=>m("layers"),className:`flex-1 p-1.5 rounded-lg flex justify-center transition-colors ${v==="layers"?"bg-indigo-500/20 text-indigo-200 shadow-sm":"text-zinc-500 hover:text-zinc-300"}`,title:"Layers",children:t(Gn,{className:"w-3.5 h-3.5"})}),t("button",{onClick:()=>m("pattern"),className:`flex-1 p-1.5 rounded-lg flex justify-center transition-colors ${v==="pattern"?"bg-emerald-500/20 text-emerald-200 shadow-sm":"text-zinc-500 hover:text-zinc-300"}`,title:"Pattern",children:t(Jr,{className:"w-3.5 h-3.5"})})]}),v!=="brush"&&t("div",{className:"pl-1 cursor-move text-zinc-600 hover:text-white",onPointerDown:Ee,onPointerMove:Fe,onPointerUp:ze,onPointerCancel:ze,children:t(Hr,{className:"w-3.5 h-3.5"})})]}),u("div",{className:"flex-1 flex flex-col p-2 min-h-0",children:[v==="brush"&&ie(),v==="layers"&&Qe(),v==="pattern"&&V()]}),t("div",{className:"w-full h-px bg-white/10 shrink-0"}),u("div",{className:"flex justify-between items-center p-2 no-drag shrink-0 gap-1 bg-white/[0.02]",children:[t("button",{onClick:h,className:"p-1.5 rounded-lg text-zinc-400 hover:text-white hover:bg-zinc-700 transition-all",title:"Undo",children:t(On,{className:"w-3.5 h-3.5"})}),t("button",{onClick:a,className:"p-1.5 rounded-lg text-zinc-400 hover:text-white hover:bg-zinc-700 transition-all",title:"Redo",children:t(An,{className:"w-3.5 h-3.5"})}),t("button",{onClick:i,className:"p-1.5 rounded-lg text-zinc-400 hover:text-white hover:bg-zinc-700 transition-all",title:"Save",children:t(jn,{className:"w-3.5 h-3.5"})}),t("button",{onClick:w,className:"p-1.5 rounded-lg text-red-400 hover:bg-red-900/30 transition-all",title:"Clear",children:t(Xn,{className:"w-3.5 h-3.5"})})]})]})},pr=({icon:e,active:l,onClick:w,label:i})=>u("button",{onClick:w,className:`flex flex-col items-center gap-1 p-2 rounded-xl transition-all active:scale-95 min-w-[60px] ${l?"bg-white/10 text-white shadow-sm ring-1 ring-white/10":"text-zinc-500 hover:text-zinc-200 hover:bg-white/5"}`,title:i,children:[t(e,{className:`w-5 h-5 ${l?"stroke-2":"stroke-[1.5]"}`}),t("span",{className:"text-[9px] font-bold uppercase tracking-wider",children:i})]}),ya=()=>{const[e,l]=o.useState({brushType:"flat",size:60,opacity:.9,color:"#caa24f",wetMode:!1,blendMode:"source-over",pressureSensitivity:!0,useTexture:!0,isEraser:!1,colorVariation:.1,hueVariation:.05,isTapeMode:!1,tapeWidth:30,isLassoMode:!1,isLassoFill:!1,isRectLassoFill:!1,isStippleFill:!1,lassoMode:"add",isGradientMode:!1,isGradBlend:!1,gradColor2:"#000000",isPatternLasso:!1,isPatternLine:!1,patternTexture:null,patternScale:1,patternAngle:0,patternStampRotation:0,patternJitterScale:0,patternJitterRotation:0,patternJitterHue:0,patternJitterSaturation:0,patternJitterValue:0,gradientTime:.3,gradientHumidity:.1,sunIntensity:.5,sunDiffusion:.6,skyEnabled:!1,sunEnabled:!0,skyTime:.2,sunElevation:.2,skyHorizon:.6,sunAzimuth:.5,skyScale:1,atmosphereDensity:.5,waterEnabled:!1,waterLayerReflections:!0,waterOpacity:.85,waterTurbulenceX:.3,waterTurbulenceY:.4,waterFractal:.5,lensFlareEnabled:!1,lensFlareIntensity:.6,lensFlareScale:1,lensFlareHandleEnabled:!0,flareTipPos:null,filmEnabled:!0,filmDensity:0,filmHalation:0,filmBloom:0,filmGrain:0,filmStock:"Standard",autoClean:!0,pictorialismEnabled:!1,pictorialismNoise:.5,pictorialismSoftness:.5,risoEnabled:!1,risoGrainScale:1,risoColor1:"#1a1a2e",risoColor2:"#f0f0e0",chromaticAberrationEnabled:!1,chromaticAberrationIntensity:.5}),[w,i]=o.useState(0),[h,a]=o.useState(0),[$,j]=o.useState(0),[Y,R]=o.useState(0),[B,U]=o.useState(0),[te,Q]=o.useState(.5),[F,ee]=o.useState(.2),[D,O]=o.useState(null),[ge,v]=o.useState(.85),[m,L]=o.useState({x:0,y:0}),[he,oe]=o.useState(!1),[Ee,Fe]=o.useState(!1),[ze,Ce]=o.useState(!0),[qe,ie]=o.useState(!0),[Qe,V]=o.useState(!0),[z,X]=o.useState(!0),[Pe,Ae]=o.useState(!1),[be,Ze]=o.useState(null),pt=o.useRef(null),kt=o.useRef(null),Lt=o.useRef(ge);o.useEffect(()=>{Lt.current=ge},[ge]),o.useEffect(()=>{const ne=()=>{const Ie=window.innerWidth<1024||"ontouchstart"in window;Ae(Ie),Ie?(Ce(!1),V(!1),X(!1)):(Ce(!0),X(!0),ie(!0),V(!0))};return ne(),window.addEventListener("resize",ne),()=>window.removeEventListener("resize",ne)},[]);const dt=o.useCallback((ne,Ie)=>{L(xe=>({x:xe.x+ne,y:xe.y+Ie}))},[]);o.useEffect(()=>{const ne=kt.current;if(!ne)return;const Ie=xe=>{if(xe.target.closest(".overflow-y-auto"))return;xe.preventDefault();const Ve=-xe.deltaY,De=xe.ctrlKey?.01:.0015;v(vt=>Math.min(Math.max(.1,vt+Ve*De),4))};return ne.addEventListener("wheel",Ie,{passive:!1}),()=>ne.removeEventListener("wheel",Ie)},[]),o.useEffect(()=>{const ne=kt.current;if(!ne)return;let Ie=0,xe=0,Ve={x:0,y:0};const De=$e=>{$e.touches.length===2?($e.preventDefault(),Ie=Math.hypot($e.touches[0].clientX-$e.touches[1].clientX,$e.touches[0].clientY-$e.touches[1].clientY),xe=Lt.current):$e.touches.length===1&&Ee&&(Ve={x:$e.touches[0].clientX,y:$e.touches[0].clientY})},vt=$e=>{if($e.touches.length===2){$e.preventDefault();const Et=Math.hypot($e.touches[0].clientX-$e.touches[1].clientX,$e.touches[0].clientY-$e.touches[1].clientY);if(Ie>0){const gt=Et/Ie;v(Math.min(Math.max(.1,xe*gt),4))}}else if($e.touches.length===1&&Ee){$e.preventDefault();const Et=$e.touches[0].clientX-Ve.x,gt=$e.touches[0].clientY-Ve.y;L(It=>({x:It.x+Et,y:It.y+gt})),Ve={x:$e.touches[0].clientX,y:$e.touches[0].clientY}}};return ne.addEventListener("touchstart",De,{passive:!1}),ne.addEventListener("touchmove",vt,{passive:!1}),()=>{ne.removeEventListener("touchstart",De),ne.removeEventListener("touchmove",vt)}},[Ee]),o.useEffect(()=>{const ne=xe=>{if(xe.target instanceof HTMLInputElement||xe.target instanceof HTMLTextAreaElement||xe.target instanceof HTMLSelectElement)return;if(xe.code==="Space"){Fe(!0);return}const Ve=xe.ctrlKey||xe.metaKey;if(Ve&&xe.key.toLowerCase()==="z"){xe.preventDefault(),xe.shiftKey?U(De=>De+1):R(De=>De+1);return}if(Ve&&xe.key.toLowerCase()==="y"){xe.preventDefault(),U(De=>De+1);return}if(Ve&&xe.key.toLowerCase()==="s"){xe.preventDefault(),pt.current&&pt.current.downloadImage();return}if(!Ve&&!xe.altKey&&!xe.shiftKey)switch(xe.key.toLowerCase()){case"w":l(De=>({...De,wetMode:!De.wetMode}));break;case"e":l(De=>({...De,isEraser:!De.isEraser}));break;case"[":l(De=>({...De,size:Math.max(1,De.size-5)}));break;case"]":l(De=>({...De,size:Math.min(200,De.size+5)}));break}},Ie=xe=>{xe.code==="Space"&&Fe(!1)};return window.addEventListener("keydown",ne),window.addEventListener("keyup",Ie),()=>{window.removeEventListener("keydown",ne),window.removeEventListener("keyup",Ie)}},[]);const Ft=ne=>{pt.current&&pt.current.downloadImage({width:ne?3840:void 0,height:ne?2160:void 0})},St=()=>{if(pt.current){const ne=pt.current.capturePattern();ne&&l(Ie=>({...Ie,patternTexture:ne}))}},Rt=ne=>{if(ne.target.files&&ne.target.files[0]){const Ie=URL.createObjectURL(ne.target.files[0]);O(Ie),l(xe=>({...xe,useTexture:!0,skyEnabled:!1}))}},ut=ne=>{Ce(ne==="controls"?!ze:!1),ie(ne==="picker"?!qe:!1),V(ne==="palette"?!Qe:!1),X(ne==="toolbar"?!z:!1)};return u("div",{ref:kt,className:"relative w-full h-full bg-zinc-950 overflow-hidden overscroll-none touch-none",children:[t(on,{ref:pt,settings:e,onChange:l,canvasColor:"#f0f0f0",triggerClear:w,triggerClearTape:h,triggerInvertMask:$,triggerUndo:Y,triggerRedo:B,onPickColor:ne=>l(Ie=>({...Ie,color:ne})),zoom:ge,pan:m,onPan:dt,isSpacePressed:Ee,customTextureUrl:D,grayscaleMode:he,onLayerMethodsReady:Ze,washTemp:te,washIntensity:F,width:1080,height:1080,isMobile:Pe}),!Pe&&u("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 flex items-center gap-2 p-2 bg-zinc-900/80 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl z-50",children:[t(pr,{icon:er,active:qe,onClick:()=>ie(!qe),label:"Brush"}),t(pr,{icon:$r,active:z,onClick:()=>X(!z),label:"Tools"}),t(pr,{icon:Lr,active:Qe,onClick:()=>V(!Qe),label:"Colors"}),t(pr,{icon:Nr,active:ze,onClick:()=>Ce(!ze),label:"Settings"})]}),Pe&&u("div",{className:"fixed bottom-0 left-0 w-full h-[72px] bg-zinc-950/80 backdrop-blur-2xl border-t border-white/5 z-[60] flex items-center justify-between px-6 pb-safe safe-area-bottom shadow-[0_-10px_40px_rgba(0,0,0,0.5)]",children:[u("button",{onClick:()=>ut("picker"),className:`flex flex-col items-center gap-1 p-2 rounded-xl transition-all active:scale-95 ${qe?"text-indigo-400":"text-zinc-500"}`,children:[t(er,{className:`w-6 h-6 ${qe?"stroke-2":"stroke-[1.5]"}`}),t("span",{className:"text-[9px] font-bold uppercase tracking-wider",children:"Brush"})]}),u("button",{onClick:()=>ut("toolbar"),className:`flex flex-col items-center gap-1 p-2 rounded-xl transition-all active:scale-95 ${z?"text-indigo-400":"text-zinc-500"}`,children:[t($r,{className:`w-6 h-6 ${z?"stroke-2":"stroke-[1.5]"}`}),t("span",{className:"text-[9px] font-bold uppercase tracking-wider",children:"Tools"})]}),u("button",{onClick:()=>ut("palette"),className:`flex flex-col items-center gap-1 p-2 rounded-xl transition-all active:scale-95 ${Qe?"text-indigo-400":"text-zinc-500"}`,children:[t(Lr,{className:`w-6 h-6 ${Qe?"stroke-2":"stroke-[1.5]"}`}),t("span",{className:"text-[9px] font-bold uppercase tracking-wider",children:"Color"})]}),u("button",{onClick:()=>ut("controls"),className:`flex flex-col items-center gap-1 p-2 rounded-xl transition-all active:scale-95 ${ze?"text-indigo-400":"text-zinc-500"}`,children:[t(Nr,{className:`w-6 h-6 ${ze?"stroke-2":"stroke-[1.5]"}`}),t("span",{className:"text-[9px] font-bold uppercase tracking-wider",children:"Settings"})]})]}),t(aa,{settings:e,onChange:l,washTemp:te,onWashChange:Q,washIntensity:F,onWashIntensityChange:ee,onUploadTexture:Rt,isOpen:ze,onClose:()=>Ce(!1),isMobile:Pe,onExport:Ft}),t(ba,{settings:e,onChange:l,onClearMasks:()=>a(ne=>ne+1),onInvertMask:()=>j(ne=>ne+1),visible:qe,onClose:()=>ie(!1),grayscaleMode:he,onToggleGrayscale:()=>oe(!he),isMobile:Pe}),t(ga,{settings:e,onChange:l,visible:Qe,onClose:()=>V(!1),isMobile:Pe}),t(xa,{settings:e,onChange:l,onClear:()=>i(ne=>ne+1),onDownload:()=>Ft(!1),onUndo:()=>R(ne=>ne+1),onRedo:()=>U(ne=>ne+1),visible:z,onClose:()=>X(!1),isMobile:Pe,layers:be==null?void 0:be.layers,activeLayerId:be==null?void 0:be.activeLayerId,onSetActiveLayer:be==null?void 0:be.setActiveLayerId,onAddLayer:be==null?void 0:be.addLayer,onRemoveLayer:be==null?void 0:be.removeLayer,onToggleLayerVisibility:be==null?void 0:be.toggleLayerVisibility,onToggleLayerGlow:be==null?void 0:be.toggleLayerGlow,onCapturePattern:St})]})},wa=()=>{const[e,l]=o.useState([]);return o.useEffect(()=>{const w=setInterval(()=>{l(i=>{const h=i.map(a=>({...a,y:a.y-a.speed})).filter(a=>a.y>-20);return Math.random()>.7&&h.push({id:Date.now(),x:Math.random()*100,y:110,size:4+Math.random()*12,speed:.5+Math.random()*1.5}),h})},50);return()=>clearInterval(w)},[]),u("div",{className:"w-full h-full bg-zinc-950 text-indigo-100 font-sans flex flex-col items-center justify-center relative overflow-hidden select-none",children:[t("div",{className:"absolute inset-0 opacity-30 bg-[radial-gradient(circle_at_center,_#312e81_0%,_transparent_70%)]"}),u("div",{className:"relative z-10 flex flex-col items-center gap-10",children:[u("div",{className:"relative group cursor-pointer",children:[t("div",{className:"absolute inset-0 bg-indigo-500 blur-[80px] opacity-20 group-hover:opacity-40 transition-opacity duration-500"}),u("div",{className:"relative w-48 h-48 rounded-full border border-white/10 flex items-center justify-center bg-zinc-900/50 backdrop-blur-md shadow-2xl shadow-indigo-500/20",children:[t(en,{className:"w-20 h-20 text-indigo-300 drop-shadow-[0_0_15px_rgba(165,180,252,0.5)]",strokeWidth:1.5}),t("div",{className:"absolute inset-0 overflow-hidden rounded-full mask-image-b",children:e.map(w=>t("div",{className:"absolute rounded-full bg-indigo-400/30 blur-[1px] border border-white/10",style:{left:`${w.x}%`,top:`${w.y}%`,width:w.size,height:w.size}},w.id))})]})]}),u("div",{className:"text-center space-y-3",children:[t("h1",{className:"text-5xl font-black tracking-[0.2em] text-transparent bg-clip-text bg-gradient-to-r from-indigo-200 to-white drop-shadow-lg",children:"ALCHEMY"}),u("div",{className:"flex items-center justify-center gap-3",children:[t("div",{className:"h-px w-8 bg-white/10"}),t("p",{className:"text-zinc-500 text-xs font-bold uppercase tracking-[0.3em]",children:"Lab v0.1  Experimental"}),t("div",{className:"h-px w-8 bg-white/10"})]})]}),t("div",{className:"grid grid-cols-4 gap-4 mt-8",children:[qr,Vr,xr,Wn].map((w,i)=>t("button",{className:"p-5 rounded-2xl bg-zinc-900/40 border border-white/5 hover:bg-indigo-500/10 hover:border-indigo-500/30 transition-all group backdrop-blur-sm",children:t(w,{className:"w-6 h-6 text-zinc-500 group-hover:text-indigo-300 group-hover:scale-110 transition-transform duration-300",strokeWidth:1.5})},i))})]}),t("div",{className:"absolute bottom-10 text-[10px] font-bold uppercase tracking-widest text-zinc-700",children:"Awaiting Ingredients..."})]})},va=()=>{const[e,l]=o.useState("gouache");return u("div",{className:"relative w-screen h-screen overflow-hidden bg-zinc-950 font-sans selection:bg-indigo-500/30",children:[t("div",{className:"w-full h-full",children:e==="gouache"?t(ya,{}):t(wa,{})}),t("div",{className:"fixed top-6 left-6 z-[100] group pointer-events-none",children:u("div",{className:"pointer-events-auto bg-zinc-900/80 backdrop-blur-md border border-white/10 rounded-full p-1 shadow-xl flex items-center gap-1 transition-all duration-300 hover:border-white/20 hover:scale-105",children:[t("button",{onClick:()=>l("gouache"),className:`p-2 rounded-full transition-all duration-200 ${e==="gouache"?"bg-zinc-100 text-zinc-950 shadow-sm":"text-zinc-500 hover:text-zinc-200 hover:bg-white/5"}`,title:"Gouache Studio",children:t(er,{className:"w-4 h-4",strokeWidth:2.5})}),t("button",{onClick:()=>l("alchemy"),className:`p-2 rounded-full transition-all duration-200 ${e==="alchemy"?"bg-indigo-600 text-white shadow-[0_0_15px_rgba(79,70,229,0.4)]":"text-zinc-500 hover:text-indigo-300 hover:bg-indigo-500/10"}`,title:"Alchemy Lab",children:t(en,{className:"w-4 h-4",strokeWidth:2.5})})]})})]})},ln=document.getElementById("root");if(!ln)throw new Error("Could not find root element to mount to");const Ma=zr.createRoot(ln);Ma.render(t(un.StrictMode,{children:t(va,{})}));
